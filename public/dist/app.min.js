(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var CorpusModule=require("./modules/corpus"),app=angular.module("context-app",["ngRoute","ngAnimate","mgcrea.ngStrap","CorpusModule"]);require("./routes")(app),require("./services")(app),require("./controllers")(app),require("./directives")(app),require("./filters")(app);
},{"./controllers":2,"./directives":15,"./filters":16,"./modules/corpus":20,"./routes":21,"./services":22}],2:[function(require,module,exports){
module.exports=function(app){app.controller("HomeController",["$scope",require("./controllers/home.js")]),app.controller("RegisterController",["$scope",require("./controllers/register.js")]),app.controller("ProfileController",["$scope",require("./controllers/profile.js")]),app.controller("CreateCorpusController",["$scope",require("./controllers/createcorpus.js")])};
},{"./controllers/createcorpus.js":8,"./controllers/home.js":9,"./controllers/profile.js":10,"./controllers/register.js":11}],3:[function(require,module,exports){
var CoocProcesser=require("../../modules/CoocProcesser"),d3=window.d3||null,matrix_mouseover=function(p){var g=d3.select(this).node();$("#"+g.id).css("cursor","pointer"),d3.selectAll(".row text").classed("active",function(d,i){return i===p.y}),d3.selectAll(".column text").classed("active",function(d,i){return i===p.x})},matrix_mouseout=function(){d3.selectAll("text").classed("active",!1)},matrix_order=function(svg,orders,x,value){x.domain(orders[value]);var t=svg.transition().duration(1500);t.selectAll(".row").delay(function(d,i){return 4*x(i)}).attr("transform",function(d,i){return"translate(0,"+x(i)+")"}).selectAll(".cell").delay(function(d){return 4*x(d.x)}).attr("x",function(d){return x(d.x)}),t.selectAll(".column").delay(function(d,i){return 4*x(i)}).attr("transform",function(d,i){return"translate("+x(i)+")rotate(-90)"})},createCoocMatrix=function(miserables,container){var margin={top:80,right:0,bottom:10,left:80},width=1e3,height=1e3,x=d3.scale.ordinal().rangeBands([0,width]),z=d3.scale.linear().domain([0,4]).clamp(!0),c=d3.scale.category20().domain(d3.range(20)),svg=d3.select(container).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).style("margin-left",-margin.left+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),matrix=[],nodes=miserables.nodes,n=nodes.length;nodes.forEach(function(node,i){node.index=i,node.count=0,matrix[i]=d3.range(n).map(function(j){return{x:j,y:i,z:0}})}),miserables.links.forEach(function(link){matrix[link.source][link.target].z+=link.value,matrix[link.target][link.source].z+=link.value,matrix[link.source][link.source].z+=link.value,matrix[link.target][link.target].z+=link.value,nodes[link.source].count+=link.value,nodes[link.target].count+=link.value});var orders={name:d3.range(n).sort(function(a,b){return d3.ascending(nodes[a].name,nodes[b].name)}),count:d3.range(n).sort(function(a,b){return nodes[b].count-nodes[a].count}),group:d3.range(n).sort(function(a,b){return nodes[b].group-nodes[a].group})};x.domain(orders.name),svg.append("rect").attr("class","cell-background").attr("width",width).attr("height",height);var processRow=function(row){d3.select(this).selectAll(".cell").data(row.filter(function(d){return d.z})).enter().append("rect").attr("class","cell").attr("x",function(d){return x(d.x)}).attr("width",x.rangeBand()).attr("height",x.rangeBand()).attr("id",function(d){return"rel_"+nodes[d.x].index+"_"+nodes[d.y].index}).style("fill-opacity",function(d){return z(d.z)}).style("fill",function(d){return nodes[d.x].group===nodes[d.y].group?c(nodes[d.x].group):null}).on("mouseover",matrix_mouseover).on("mouseout",function(d){matrix_mouseout(d)})},row=svg.selectAll(".row").data(matrix).enter().append("g").attr("class","row").attr("transform",function(d,i){return"translate(0,"+x(i)+")"}).each(processRow);row.append("line").attr("x2",width),row.append("text").attr("x",-6).attr("y",x.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").attr("id",function(d,i){return"node_"+nodes[i].index}).attr("title",function(d,i){return nodes[i].uri}).text(function(d,i){return nodes[i].name});var column=svg.selectAll(".column").data(matrix).enter().append("g").attr("class","column").attr("transform",function(d,i){return"translate("+x(i)+")rotate(-90)"});column.append("line").attr("x1",-width),column.append("text").attr("x",6).attr("y",x.rangeBand()/2).attr("dy",".32em").attr("id",function(d,i){return"node_"+nodes[i].index}).attr("title",function(d,i){return nodes[i].uri}).attr("text-anchor","start").text(function(d,i){return nodes[i].name}),$(container).append('<div class="matrix-color-legend"><table cellpadding="5" cellspacing="3"></table></div>');var not_repeat=[];$.each(miserables.nodes,function(i,v){-1===not_repeat.indexOf(v.group)&&(not_repeat.push(v.group),$(container+" .matrix-color-legend table").append('<tr style="color:#FFF;background-color:'+c(v.group)+'"><td>'+miserables.groups[v.group]+"</td></tr>"))}),$(container+" .matrix-color-legend").attr("style","position:absolute;top:300px;right:10px;overflow:hidden;");setTimeout(function(){matrix_order(svg,orders,x,"group")},500)};module.exports=function($scope){$.getJSON("/api/corpus/"+$scope.currentCorpus._id+"/cooc",function(data){var processedData=CoocProcesser.processData(data);createCoocMatrix(processedData,"#coocContainer")})};
},{"../../modules/CoocProcesser":17}],4:[function(require,module,exports){
var FacetsProcesser=require("../../modules/FacetsProcesser"),facetsData,types,entities,articles;module.exports=function($scope,$state,$sce){$scope.typeFilter=void 0,$scope.entityFilter=void 0,$scope.articleFilter=void 0,$scope.setFilter=function(item){switch(item.type){case"article":$scope.articleFilter=$scope.articleFilter===item.id?void 0:item.id;break;case"entity":$scope.entityFilter=$scope.entityFilter===item.id?void 0:item.id;break;case"type":$scope.typeFilter=$scope.typeFilter===item.id?void 0:item.id}},$scope.itemActive=function(item){switch(item.type){case"article":return $scope.articleFilter===item.id;case"entity":return $scope.entityFilter===item.id;case"type":return $scope.typeFilter===item.id}},$scope.facetFilter=function(item){var filterArticle=!1,filterEntity=!1,filterType=!1;switch(item.type){case"article":return filterEntity=void 0!==$scope.entityFilter?-1!==item.entities.indexOf($scope.entityFilter):!0,filterType=void 0!==$scope.typeFilter?-1!==item.types.indexOf($scope.typeFilter):!0,filterEntity&&filterType;case"entity":return filterArticle=void 0!==$scope.articleFilter?-1!==item.articles.indexOf($scope.articleFilter):!0,filterType=void 0!==$scope.typeFilter?-1!==item.types.indexOf($scope.typeFilter):!0,filterArticle&&filterType;case"type":return filterArticle=void 0!==$scope.articleFilter?-1!==item.articles.indexOf($scope.articleFilter):!0,filterEntity=void 0!==$scope.entityFilter?-1!==item.entities.indexOf($scope.entityFilter):!0,filterArticle&&filterEntity}},$.getJSON("/api/corpus/"+$scope.currentCorpus._id+"/facets",function(data){facetsData=FacetsProcesser.processData(data),types=facetsData.types,entities=facetsData.entities,articles=facetsData.articles;for(var i=0;i<articles.length;i++)articles[i].sourceSafe=$sce.trustAsHtml(articles[i].source);$scope.data=[{name:"Articles",values:articles},{name:"Types",values:types},{name:"Entities",values:entities}],$state.reload()})};
},{"../../modules/FacetsProcesser":18}],5:[function(require,module,exports){
var extentions=require("../../data/corpusextentions"),defaultPort="8081",currentCorpus={uri:function(){var it=this.input_type;return"twitter"===it?"http://twitter.com/"+this.input:"direct"===it?"-":this.input}},initProgressWebsocket=function($scope){var location=document.location.hostname+":"+defaultPort+document.location.pathname.replace("/overview","");console.log("connecting to socket",location);var socket=new WebSocket("ws://"+location);socket.onerror=function(err){console.log(err)},socket.onopen=function(){$scope.$apply(function(){$scope.progress.show=!0})},socket.onmessage=function(event){var data=JSON.parse(event.data);$scope.$apply(function(){$scope.progress.type=data.type,$scope.progress.progress=data.progress})},socket.onclose=function(){$scope.$apply(function(){$scope.progress.show=!1})}};module.exports=function($scope,$location,$state,corpus){currentCorpus=_.extend(currentCorpus,corpus.data),$scope.currentCorpus=currentCorpus,$scope.Math=Math,$scope.progress={show:!1,progress:0,type:""},$scope.extentions=extentions,$scope.$state=$state,$scope.$on("$viewContentLoaded",function(){currentCorpus.processed||initProgressWebsocket($scope);var len=$location.path().split("/").length;3===len&&$state.go("corpus."+extentions[0].name)})};
},{"../../data/corpusextentions":13}],6:[function(require,module,exports){
module.exports=function(){};
},{}],7:[function(require,module,exports){
var RelationsProcesser=require("../../modules/RelationsProcesser"),d3=window.d3||null,fade=function(opacity,svg){return function(d,i){svg.selectAll("path.chord").filter(function(d){return d.source.index!==i&&d.target.index!==i}).transition().style("stroke-opacity",opacity).style("fill-opacity",opacity)}},createRelChart=function(data,container){var matrix=data.relations,entityNames=(data.scores,data.entityNames),w=(data.entityURIs,1e3),h=900,r1=h/2,r0=r1-80,fill=d3.scale.category20c(),chord=d3.layout.chord().padding(.04).sortSubgroups(d3.descending).sortChords(d3.descending),arc=d3.svg.arc().innerRadius(r0).outerRadius(r0+20),svg=d3.select(container).append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+w/2+","+h/2+")");chord.matrix(matrix);var g=svg.selectAll("g.group").data(chord.groups).enter().append("svg:g").attr("class","group").on("mouseover",fade(.02,svg)).on("mouseout",fade(.8,svg));g.append("svg:path").style("stroke",function(d){return fill(d.index)}).style("fill",function(d){return fill(d.index)}).attr("id",function(d){return"path_"+d.index}).attr("d",arc),g.append("svg:text").each(function(d){d.angle=(d.startAngle+d.endAngle)/2}).attr("dy",".35em").attr("id",function(d){return"label_"+d.index}).attr("text-anchor",function(d){return d.angle>Math.PI?"end":null}).attr("transform",function(d){return"rotate("+(180*d.angle/Math.PI-90)+")translate("+(r0+26)+")"+(d.angle>Math.PI?"rotate(180)":"")}).text(function(d){return entityNames[d.index]}),svg.selectAll("path.chord").data(chord.chords).enter().append("svg:path").attr("class","chord").style("stroke",function(d){return d3.rgb(fill(d.source.index)).darker()}).style("fill",function(d){return fill(d.source.index)}).attr("d",d3.svg.chord().radius(r0)),$.each(entityNames,function(i,v){$("#label_"+i).mouseover(function(){var position=$("#label_"+i).position();$("#relations").append('<div class="d3-rel-tooltip" style="top:'+(position.top+30)+"px;left:"+position.left+'px">'+v+"</div>"),$("#label_"+i).css("fill",d3.select("#path_"+i).style("fill")),$("#label_"+i).css("cursor","pointer")}),$("#label_"+i).mouseout(function(){$("#label_"+i).css("fill","#000"),$("#relations .d3-rel-tooltip").remove()})})};module.exports=function($scope){$.getJSON("/api/corpus/"+$scope.currentCorpus._id+"/relations",function(data){var processedData=RelationsProcesser.processData(data);createRelChart(processedData,"#relationsContainer")})};
},{"../../modules/RelationsProcesser":19}],8:[function(require,module,exports){
var corpusTypes=require("../data/corpusTypes.js"),nlpApis=require("../data/nlpApis.js");module.exports=function($scope){$scope.corpusTypes=corpusTypes,$scope.nlpApis=nlpApis,$scope.corpusSelection={index:0},$scope.currentCorpus=$scope.corpusTypes[0];var $inputCount,$sliderContainer,updateView=function(){$scope.currentCorpus=$scope.corpusTypes[$scope.corpusSelection.index],$scope.currentCorpus.haveItems?($inputCount?$inputCount.slider("destroy"):($sliderContainer=$("#slider_container"),$inputCount=$("#input_count")),$sliderContainer.show(),$inputCount.slider({min:$scope.currentCorpus.itemsMin,max:$scope.currentCorpus.itemsMax,step:50,value:$scope.currentCorpus.itemsDefault,tooltip:"always"})):$sliderContainer.hide()};$scope.$watch("corpusSelection",updateView,!0),$scope.$on("$viewContentLoaded",updateView),$scope.startAnalysis=function(e){e.preventDefault();var $inputItem=$("#input_item"),$inputItemArea=$("#input_item_area"),$inputItemFile=$("#input_item_file"),$inputCountField=$("input#input_count"),$newCorpusForm=$("#newcorpus_form"),$inputType=$("input[name=input_type]:checked");$inputItem.parent().removeClass("has-warning");var input=null,corpusType=$scope.currentCorpus.name,inputType=$scope.currentCorpus.inputType;switch(inputType){case"text":input=$inputItem.val().trim();break;case"textarea":input=$inputItemArea.val().trim();break;case"file":input=$inputItemFile.val()}if(!input)return void $inputItem.parent().addClass("has-warning");$newCorpusForm.attr("action","/api/corpus?_csrf="+encodeURIComponent($scope.csrf));var itemCount=$inputCount.slider("getValue");switch($inputCountField.val(itemCount),inputType){case"text":$inputItem.attr("name","input"),$inputItemArea.remove(),$inputItemFile.remove();break;case"textarea":$inputItem.remove(),$inputItemArea.attr("name","input"),$inputItemFile.remove();break;case"file":$inputItem.remove(),$inputItemArea.remove(),$inputCountField.remove(),$inputItemFile.attr("name","input")}$inputType.val(corpusType),$newCorpusForm.submit()}};
},{"../data/corpusTypes.js":12,"../data/nlpApis.js":14}],9:[function(require,module,exports){
module.exports=function($scope){$scope.corpus="0",$scope.corpusSelect=function(){"0"!==$scope.corpus&&(window.location="/corpus/"+$scope.corpus)}};
},{}],10:[function(require,module,exports){
module.exports=require(6)
},{}],11:[function(require,module,exports){
module.exports=require(6)
},{}],12:[function(require,module,exports){
var collection=[];collection.push({name:"feed",description:"RSS/RDF/ATOM Feed",inputType:"text",inputDescription:"URL of the RSS/RDF/ATOM feed",inputPlaceholder:"URL of your feed",haveItems:!0,itemsMin:50,itemsMax:600,itemsDefault:50}),collection.push({name:"wordpress",description:"WordPress Blog",inputType:"text",inputDescription:"Weblog URL",inputPlaceholder:"URL of the blog",haveItems:!0,itemsMin:50,itemsMax:400,itemsDefault:400}),collection.push({name:"blogger",description:"Blogger Blog",inputType:"text",inputDescription:"Weblog URL",inputPlaceholder:"URL of the blog",haveItems:!0,itemsMin:50,itemsMax:400,itemsDefault:400}),collection.push({name:"twitter",description:"Public Twitter account",inputType:"text",inputDescription:"Twitter username",inputPlaceholder:"Username",haveItems:!0,itemsMin:200,itemsMax:1500,itemsDefault:1e3}),collection.push({name:"slidewiki",description:"SlideWiki Deck",inputType:"text",inputDescription:"Deck ID",inputPlaceholder:"Deck ID",haveItems:!0,itemsMin:50,itemsMax:1e3,itemsDefault:400}),collection.push({name:"webpage",description:"Web page",inputType:"text",inputDescription:"WebPage URL",inputPlaceholder:"URL",haveItems:!1}),collection.push({name:"directinput",description:"Direct input",inputType:"textarea",inputDescription:"Your text/html",haveItems:!1}),collection.push({name:"doc",description:"Upload a document(s)",inputType:"file",inputDescription:"Document",haveItems:!1}),module.exports=collection;
},{}],13:[function(require,module,exports){
var collection=[];collection.push({name:"Overview",path:"/overview",controller:"CorpusOverviewController",template:"/templates/corpusOverview.html",js:require("../controllers/corpus/overview.js")}),collection.push({name:"Facets",path:"/facets",controller:"CorpusFacetsController",template:"/templates/corpusFacets.html",js:require("../controllers/corpus/facets.js")}),collection.push({name:"Entity relations",path:"/relations",controller:"CorpusRelationsController",template:"/templates/corpusEntityRelations.html",js:require("../controllers/corpus/relations.js")}),collection.push({name:"Co-occurrence matrix",path:"/cooc",controller:"CorpusCoocController",template:"/templates/corpusCooc.html",js:require("../controllers/corpus/cooc.js")}),module.exports=collection;
},{"../controllers/corpus/cooc.js":3,"../controllers/corpus/facets.js":4,"../controllers/corpus/overview.js":6,"../controllers/corpus/relations.js":7}],14:[function(require,module,exports){
var collection=[];collection.push({id:"DBpedia-Spotlight",name:"DBpedia Spotlight"}),collection.push({id:"FOX",name:"FOX"}),collection.push({id:"DBpedia-Spotlight-DE",name:"DBpedia Spotlight (German)"}),module.exports=collection;
},{}],15:[function(require,module,exports){
module.exports=require(6)
},{}],16:[function(require,module,exports){
module.exports=require(6)
},{}],17:[function(require,module,exports){
var diceMetric=function(x,y,xy){return 2*xy/(x+y)},getCommonArticles=function(entity,entityDouble){return _.intersection(entity.articles,entityDouble.articles)},processData=function(corpus){var entitiesMin,entitiesMax,entitiesAvg,entities={},types=[],entitiesTotal=0;corpus.articles.forEach(function(article){var count=article.entities.length;entitiesTotal+=count,entitiesMin=_.min([entitiesMin,count]),entitiesMax=_.max([entitiesMin,count]),article.entities.forEach(function(entity){entities[entity.uri]?(entities[entity.uri].count++,entities[entity.uri].articles.push(article._id)):(entities[entity.uri]=entity,entities[entity.uri].count=1,entities[entity.uri].articles=[article._id]),entity.types.forEach(function(type){-1===types.indexOf(type)&&types.push(type)})})}),entitiesAvg=Math.floor(entitiesTotal/corpus.articles.length);var ekey,entity,nodes=[],links=[],groups=[],scores=[],entityNames=[],entityURIs=[],index=0,tmp=[];for(ekey in entities){entity=entities[ekey],entityURIs.push(entity.uri);var type=entity.types[0],typeId=types.indexOf(type);groups[typeId]=type,-1===entityNames.indexOf(entity.name)?(entityNames.push(entity.name),nodes.push({name:entity.name,uri:entity.uri,group:typeId})):(index++,entityNames.push(entity.name+"#"+index),nodes.push({name:entity.name+"#"+index,uri:entity.uri,group:typeId}))}for(ekey in entities){entity=entities[ekey];var score=[];for(var ekey2 in entities){var entityDouble=entities[ekey2];if(entity.uri!==entityDouble.uri){var key=entity._id+"-"+entityDouble._id,reverseKey=entityDouble._id+"-"+entity._id;if(-1===tmp.indexOf(key)&&-1===tmp.indexOf(reverseKey)){var common=getCommonArticles(entity,entityDouble),scoreValue=[diceMetric(entity.articles.length,entityDouble.articles.length,common.length)];score.push(scoreValue),links.push({source:entityURIs.indexOf(entity.uri),target:entityURIs.indexOf(entityDouble.uri),value:common?common.length:0,articles:common})}}}scores.push(score)}var sortedScores=[];scores.forEach(function(score){score.forEach(function(num){num>0&&(sortedScores.push(num[0]),threshold+=num)})}),sortedScores=sortedScores.sort();var center=Math.floor(sortedScores.length/2),threshold=sortedScores[center];return scores.forEach(function(row,index){threshold>score&&(links[index].value=0,links[index].articles="")}),{nodes:nodes,links:links,groups:groups}};exports.processData=processData;
},{}],18:[function(require,module,exports){
var escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},processData=function(data){var articles=[],types=[],typeNames=[],entities=[],entityNames=[];data.articles.forEach(function(item){var title="";try{var dom=$(item.source);title=item.title||dom.text()}catch(e){title=item.source}title=title.slice(0,30)+"...";for(var article={id:item._id,name:title,type:"article",count:0,entities:[],types:[],source:item.source},sourceText=S(item.source).stripTags().s,srcText=sourceText.split(/\s/),src=item.source.split(/\s/),i=0;i<srcText.length;i++){var it=srcText[i];it=it.split("/"),srcText[i]=it}srcText=_.flatten(srcText);var findSourceIndex=function(word,cleanWord,entityName,startIndex){startIndex=startIndex||-1;var sourceIndex=src.indexOf(word,startIndex);if(-1===sourceIndex)for(var i=0;i<src.length;i++){var srcWord=src[i],srcWordClean=srcWord.replace(/href="(.+?)"(.*?>?)/,"").replace(/src="(.+?)"(.*?>?)/,"").replace(/alt="(.+?)"(.*?>?)/,"");if(-1===srcWordClean.indexOf("span%marked%")&&srcWordClean.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg))&&i>=startIndex){sourceIndex=i;break}}return sourceIndex},cleanReg=/(^[\W]+)|([\W]+$)/g,matchRegStart="",matchReg="(\\W?)";item.entities.forEach(function(entity){var entityParts=entity.name.split(" ");if(1===entityParts.length)srcText.forEach(function(word){{var cleanWord=word.replace(cleanReg,"");entity.name.replace(cleanReg,"")}if(cleanWord!==entity.name&&word!==entity.name);else{var sourceIndex=findSourceIndex(word,cleanWord,entity.name);if(-1!==sourceIndex){var origSrc=src[sourceIndex],link=origSrc.match(/href="(.+?)"/),img=origSrc.match(/src="(.+?)"/),alt=origSrc.match(/alt="(.+?)"/);link&&(link=link[1],origSrc=origSrc.replace(link,"%link%")),img&&(img=img[1],origSrc=origSrc.replace(img,"%img%")),alt&&(alt=alt[1],origSrc=origSrc.replace(alt,"%alt%")),src[sourceIndex]=origSrc.replace(entity.name,'<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="'+entity.types.join(" ")+'">'+entity.name+"</span%marked%>"),link&&(src[sourceIndex]=src[sourceIndex].replace("%link%",link)),img&&(src[sourceIndex]=src[sourceIndex].replace("%img%",img)),alt&&(src[sourceIndex]=src[sourceIndex].replace("%alt%",alt))}}});else{var firstWord=entityParts[0],lastWord=entityParts[entityParts.length-1];srcText.forEach(function(word,index){var cleanWord=word.replace(cleanReg,"");if(-1===cleanWord.indexOf("span%marked%")){var match=null!==firstWord.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg));if(match){var i=0;for(i=1;i<entityParts.length;i++)if(!(index+i>=srcText.length)){var nextCleanWord=srcText[index+i].replace(cleanReg,"");-1===nextCleanWord.indexOf("span%marked%")&&(match=match&&null!==entityParts[i].match(new RegExp(matchRegStart+escapeRegExp(nextCleanWord)+matchReg)))}if(match){var sourceStartIndex=findSourceIndex(word,cleanWord,firstWord,index),endIndex=index+entityParts.length-1;if(endIndex>=srcText.length)return;var endWord=srcText[endIndex],endCleanWord=endWord.replace(/[^\w]/,""),sourceEndIndex=findSourceIndex(endWord,endCleanWord,lastWord,endIndex);-1!==sourceStartIndex&&-1!==sourceEndIndex&&Math.abs(sourceStartIndex-sourceEndIndex)<5&&(src[sourceStartIndex]=src[sourceStartIndex].replace(new RegExp(escapeRegExp(firstWord)+"$"),'<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="'+entity.types.join(" ")+'">'+firstWord),src[sourceEndIndex]=src[sourceEndIndex].replace(lastWord,lastWord+"</span%marked%>"))}}else;}})}var newEntity,ind=entityNames.indexOf(entity.name);-1!==ind?(newEntity=entities[ind],entities[ind].count+=1,-1===entities[ind].articles.indexOf(article.id)&&entities[ind].articles.push(article.id),-1===article.entities.indexOf(newEntity.id)&&article.entities.push(newEntity.id)):(newEntity={id:entity._id,name:entity.name,type:"entity",count:1,articles:[article.id],types:[]},article.entities.push(newEntity.id)),entity.types.forEach(function(type){var name=type.split(":")[1],tid="type_"+name,ind=typeNames.indexOf(name);-1!==ind?(types[ind].count+=1,types[ind].entities.push(newEntity.id),types[ind].articles.push(article.id),-1===newEntity.types.indexOf(tid)&&newEntity.types.push(tid),-1===article.types.indexOf(tid)&&article.types.push(tid)):(types.push({id:tid,name:name,type:"type",count:1,entities:[newEntity.id],articles:[article.id]}),-1===newEntity.types.indexOf(tid)&&newEntity.types.push("type_"+name),-1===article.types.indexOf(tid)&&article.types.push("type_"+name),typeNames.push(name))}),-1===ind&&(entities.push(newEntity),entityNames.push(newEntity.name))}),item.source=src.join(" ").replace(/span%marked%/g,"span"),article.source=item.source,articles.push(article)});var sortFunction=function(a,b){return b.count-a.count};return entities=entities.sort(sortFunction),types=types.sort(sortFunction),{articles:articles,types:types,entities:entities}};exports.processData=processData;
},{}],19:[function(require,module,exports){
var diceMetric=function(x,y,xy){return 2*xy/(x+y)},getCommonArticles=function(entity,entityDouble){var common=_.intersection(entity.articles,entityDouble.articles);return common?common.length:0},processData=function(corpus){var entitiesMin,entitiesMax,entitiesAvg,entities={},entitiesTotal=0;corpus.articles.forEach(function(article){var count=article.entities.length;entitiesTotal+=count,entitiesMin=_.min([entitiesMin,count]),entitiesMax=_.max([entitiesMin,count]),article.entities.forEach(function(entity){entities[entity.uri]?(entities[entity.uri].count++,entities[entity.uri].articles.push(article._id)):(entities[entity.uri]=entity,entities[entity.uri].count=1,entities[entity.uri].articles=[article._id])})}),entitiesAvg=Math.floor(entitiesTotal/corpus.articles.length);var relations=[],scores=[],entityNames=[],entityURIs=[],index=0,tmp=[],tmp4=[];for(var ekey in entities){var entity=entities[ekey],row=[],score=[];for(var ekey2 in entities){var entityDouble=entities[ekey2];if(entity.uri===entityDouble.uri)row.push(0),score.push(0);else{var key=entity._id+"-"+entityDouble._id,reverseKey=entityDouble._id+"-"+entity._id;if(-1!==tmp.indexOf(key))row.push(tmp[key]),score.push(tmp4[key]);else if(-1!==tmp.indexOf(reverseKey))row.push(tmp[reverseKey]),score.push(tmp4[reverseKey]);else{var commonCount=getCommonArticles(entity,entityDouble);tmp[key]=commonCount,row.push(tmp[key]),tmp4[key]=[diceMetric(entity.articles.length,entityDouble.articles.length,commonCount)],score.push(tmp4[key])}}}-1===entityNames.indexOf(entity.name)?entityNames.push(entity.name):(index++,entityNames.push(entity.name+"#"+index)),entityURIs.push(entity.uri),relations.push(row),scores.push(score)}var sortedScores=[];scores.forEach(function(score){score.forEach(function(num){num>0&&(sortedScores.push(num[0]),threshold+=num)})}),sortedScores=sortedScores.sort();var center=Math.floor(sortedScores.length/2),threshold=sortedScores[center];return scores.forEach(function(row,index){row.forEach(function(score,subindex){threshold>score&&(relations[index][subindex]=0)})}),{relations:relations,scores:scores,entityNames:entityNames,entityURIs:entityURIs}};exports.processData=processData;
},{}],20:[function(require,module,exports){
var extentions=require("../data/corpusextentions"),corpusModule=angular.module("CorpusModule",["ui.router"]);corpusModule.config(function($stateProvider){$stateProvider.state("corpus",{url:"/corpus/:id",controller:require("../controllers/corpus/main"),templateUrl:"/templates/corpusView.html",resolve:{corpus:["$http","$stateParams",function($http,$stateParams){return $http({method:"GET",url:"/api/corpus/"+$stateParams.id})}]}}),extentions.forEach(function(ex){$stateProvider.state("corpus."+ex.name,{url:ex.path,templateUrl:ex.template,controller:ex.controller})})}),extentions.forEach(function(ex){corpusModule.controller(ex.controller,["$scope","$state","$sce",ex.js])}),module.exports=corpusModule;
},{"../controllers/corpus/main":5,"../data/corpusextentions":13}],21:[function(require,module,exports){
module.exports=function(app){app.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{controller:"HomeController",template:""}),$routeProvider.when("/auth",{controller:"LoginController",template:""}),$routeProvider.when("/register",{controller:"RegisterController",template:""}),$routeProvider.when("/createCorpus",{controller:"CreateCorpusController",templateUrl:"/templates/createCorpus.html"}),$locationProvider.html5Mode(!0)}])};
},{}],22:[function(require,module,exports){
module.exports=require(6)
},{}]},{},[1]);
