(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function applyControllers (app) {
    app.controller('HomeController', ['$scope', require('./controllers/home.js')]);
    app.controller('RegisterController', ['$scope', require('./controllers/register.js')]);
    app.controller('ProfileController', ['$scope', require('./controllers/profile.js')]);
    app.controller('CreateCorpusController', ['$scope', require('./controllers/createcorpus.js')]);
};
},{"./controllers/createcorpus.js":5,"./controllers/home.js":6,"./controllers/profile.js":7,"./controllers/register.js":8}],2:[function(require,module,exports){
// includes
var FacetsProcesser = require('../../modules/FacetsProcesser');

// data
var facetsData;
var types, entities, articles;

module.exports = function CorpusFacetsController($scope, $state, $sce) {
    // init empty facet filters
    $scope.typeFilter = undefined;
    $scope.entityFilter = undefined;
    $scope.articleFilter = undefined;

    $scope.setFilter = function(item) {
        switch(item.type) {
            case 'article':
                if($scope.articleFilter === item.id) {
                    $scope.articleFilter = undefined;
                } else {
                    $scope.articleFilter = item.id;
                }
                break;
            case 'entity':
                if($scope.entityFilter === item.id) {
                    $scope.entityFilter = undefined;
                } else {
                    $scope.entityFilter = item.id;
                }
                break;
            case 'type':
                if($scope.typeFilter === item.id) {
                    $scope.typeFilter = undefined;
                } else {
                    $scope.typeFilter = item.id;
                }
                break;
        }
    };

    $scope.itemActive = function(item) {
        switch(item.type) {
            case 'article':
                return $scope.articleFilter === item.id;
            case 'entity':
                return $scope.entityFilter === item.id;
            case 'type':
                return $scope.typeFilter === item.id;
        }
    };

    $scope.facetFilter = function (item) {
        var filterArticle = false;
        var filterEntity = false;
        var filterType = false;

        switch(item.type) {
            case 'article':
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterEntity && filterType;
            case 'entity':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterArticle && filterType;
            case 'type':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                return filterArticle && filterEntity;
        }
    };

    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/facets', function(data) {
        facetsData = FacetsProcesser.processData(data);

        // types
        types = facetsData.types;
        // entities
        entities = facetsData.entities;
        // articles
        articles = facetsData.articles;
        for(var i = 0; i < articles.length; i++) {
            articles[i].sourceSafe = $sce.trustAsHtml(articles[i].source);
        }
        // update data in scope
        $scope.data = [
            {name: 'Articles', values: articles},
            {name: 'Types', values: types},
            {name: 'Entities', values: entities},
        ];

        // redraw
        $state.reload();
    });
};

},{"../../modules/FacetsProcesser":15}],3:[function(require,module,exports){
// extentions
var extentions = require('../../data/corpusextentions');

// corpus object
var currentCorpus = {
    uri: function() {
        var it = this.input_type;
        if(it === 'twitter') {
            return 'http://twitter.com/' + this.input;
        } else if(it === 'direct') {
            return '-';
        } else {
            return this.input;
        }
    }
};

module.exports = function MainCorpusController($scope, $location, $state, corpus) {
    // set current corpus data
    currentCorpus = _.extend(currentCorpus, corpus.data);
    // expose corpus to scope
    $scope.currentCorpus = currentCorpus;

    // init extentions
    $scope.extentions = extentions;
    // expose state
    $scope.$state = $state;

    // render first view if needed
    $scope.$on('$viewContentLoaded', function onRender() {
        var len = $location.path().split('/').length;
        // if page is just loaded
        if(len === 3) {
            // redirect to first subview
            $state.go('corpus.'+extentions[0].name);
        }
    });
};

},{"../../data/corpusextentions":10}],4:[function(require,module,exports){
module.exports = function CorpusOverviewController($scope, $routeParams, $location) {
    console.log('corpus overview');
};

},{}],5:[function(require,module,exports){
var corpusTypes = require('../data/corpusTypes.js');
var nlpApis = require('../data/nlpApis.js');

module.exports = function CreateCorpusController($scope) {
    // collection of corpus types
    $scope.corpusTypes = corpusTypes;
    // collection of nlp apis
    $scope.nlpApis = nlpApis;

    // current corpus
    $scope.corpusSelection = {index: 0};
    $scope.currentCorpus = $scope.corpusTypes[0];

    // input slider reference
    var $inputCount, $sliderContainer;
    // update view slider
    var updateView = function() {
        console.log('view loaded!');
        $scope.currentCorpus = $scope.corpusTypes[$scope.corpusSelection.index];
        if($scope.currentCorpus.haveItems) {
            if(!$inputCount) {
                $sliderContainer = $('#slider_container');
                $inputCount = $('#input_count');
            } else {
                $inputCount.slider('destroy');
            }
            $sliderContainer.show();
            $inputCount.slider({
                min: $scope.currentCorpus.itemsMin,
                max: $scope.currentCorpus.itemsMax,
                step: 50,
                value: $scope.currentCorpus.itemsDefault,
                tooltip: 'always'
            });
        } else {
            $sliderContainer.hide();
        }
    };

    // update view on model change
    $scope.$watch('corpusSelection', updateView, true);

    // update slider
    $scope.$on('$viewContentLoaded', updateView);

    // analysis start function
    $scope.startAnalysis = function () {
        // get fields
        var $inputItem = $('#input_item');
        var $inputItemArea = $('#input_item_area');
        var $inputItemFile = $('#input_item_file');
        var $inputCountField = $('input#input_count');
        var $newCorpusForm = $('#newcorpus_form');
        var $inputType = $('input[name=input_type]:checked');

        // remove old warning
        $inputItem.parent().removeClass('has-warning');

        // validate input
        var input = null;
        var corpusType = $scope.currentCorpus.name;
        var inputType = $scope.currentCorpus.inputType;
        switch(inputType) {
            case 'text':
                input = $inputItem.val().trim();
                break;
            case 'textarea':
                input = $inputItemArea.val().trim();
                break;
            case 'file':
                input = $inputItemFile.val();
                break;
        }

        if (!input) {
            $inputItem.parent().addClass('has-warning');
            return;
        }

        // assign count to input field
        var itemCount = $inputCount.slider('getValue');
        $inputCountField.val(itemCount);

        // remove unneeded inputs & rename last one
        switch(inputType) {
            case 'text':
                $inputItem.attr('name', 'input');
                $inputItemArea.remove();
                $inputItemFile.remove();
                break;
            case 'textarea':
                $inputItem.remove();
                $inputItemArea.attr('name', 'input');
                $inputItemFile.remove();
                break;
            case 'file':
                $inputItem.remove();
                $inputItemArea.remove();
                $inputItemFile.attr('name', 'input');
                break;
        }

        // swap input type value
        $inputType.val(corpusType);

        // send to server
        $newCorpusForm.submit();
    };
};

},{"../data/corpusTypes.js":9,"../data/nlpApis.js":11}],6:[function(require,module,exports){
module.exports = function HomeController($scope) {
    // corpus model
    $scope.corpus = '0';
    // on corpus select event
    $scope.corpusSelect = function() {
        // do not do anything if it's dummy entry
        if($scope.corpus === '0') {
            return;
        }
        // redirect to corpus
        window.location = '/corpus/' + $scope.corpus;
    };
};

},{}],7:[function(require,module,exports){
module.exports = function ProfileController($scope) {
    //
};

},{}],8:[function(require,module,exports){
module.exports = function RegisterController($scope) {
    //
};

},{}],9:[function(require,module,exports){
// build collection of items
var collection = [];
// rss
collection.push({
    name: 'feed',
    description: 'RSS/RDF/ATOM Feed',
    inputType: 'text',
    inputDescription: 'URL of the RSS/RDF/ATOM feed',
    inputPlaceholder: 'URL of your feed',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 600,
    itemsDefault: 50,
});
// wordpress
collection.push({
    name: 'wordpress',
    description: 'WordPress Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// blogger
collection.push({
    name: 'blogger',
    description: 'Blogger Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// public twitter
collection.push({
    name: 'twitter',
    description: 'Public Twitter account',
    inputType: 'text',
    inputDescription: 'Twitter username',
    inputPlaceholder: 'Username',
    haveItems: true,
    itemsMin: 200,
    itemsMax: 1500,
    itemsDefault: 1000,
});
// slidewiki
collection.push({
    name: 'slidewiki',
    description: 'SlideWiki Deck',
    inputType: 'text',
    inputDescription: 'Deck ID',
    inputPlaceholder: 'Deck ID',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 1000,
    itemsDefault: 400,
});
// webpage
collection.push({
    name: 'webpage',
    description: 'Web page',
    inputType: 'text',
    inputDescription: 'WebPage URL',
    inputPlaceholder: 'URL',
    haveItems: false,
});
// direct input
collection.push({
    name: 'directinput',
    description: 'Direct input',
    inputType: 'textarea',
    inputDescription: 'Your text/html',
    haveItems: false,
});
// upload a doc
// TODO: implement, then re-enable
collection.push({
    name: 'doc',
    description: 'Upload a document',
    inputType: 'file',
    inputDescription: 'Document',
    haveItems: false,
});

// Our module now returns our view
module.exports = collection;

},{}],10:[function(require,module,exports){
var collection = [];
// overview
collection.push({
    name: 'Overview',
    path: '/overview',
    controller: 'CorpusOverviewController',
    template: '/templates/corpusOverview.html',
    js: require('../controllers/corpus/overview.js'),
});
// facets
collection.push({
    name: 'Facets',
    path: '/facets',
    controller: 'CorpusFacetsController',
    template: '/templates/corpusFacets.html',
    js: require('../controllers/corpus/facets.js'),
});

// Our module now returns our view
module.exports = collection;
},{"../controllers/corpus/facets.js":2,"../controllers/corpus/overview.js":4}],11:[function(require,module,exports){
// build collection of items
var collection = [];
// spotlight
collection.push({
    id: 'DBpedia-Spotlight',
    name: 'DBpedia Spotlight',
});
// fox
collection.push({
    id: 'FOX',
    name: 'FOX',
});

// Our module now returns our view
module.exports = collection;

},{}],12:[function(require,module,exports){
module.exports = function applyDirectives (app) {
};
},{}],13:[function(require,module,exports){
// init app
var app = angular.module('context-app', ['ngRoute', 'mgcrea.ngStrap', 'CorpusModule']);

// load modules
var CorpusModule = require('./modules/corpus');

// config app routes
require('./routes')(app);

// config app services
require('./services')(app);

// init controllers
require('./controllers')(app);

// config app directives
require('./directives')(app);

// config app filters
require('./filters')(app);

},{"./controllers":1,"./directives":12,"./filters":14,"./modules/corpus":16,"./routes":17,"./services":18}],14:[function(require,module,exports){
module.exports = function applyFilters (app) {
};
},{}],15:[function(require,module,exports){
var escapeRegExp = function(str) {
    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
};

var processData = function(data) {
    // articles
    var articles = [];
    // types
    var types = [];
    var typeNames = [];
    // entities
    var entities = [];
    var entityNames = [];

    // extract data
    data.articles.forEach(function(item) {
        // get article data
        var title = '';
        try {
            var dom = $(item.source);
            title = $('extracted-title', dom).text() || dom.text();
        } catch(e) {
            title = item.source;
        }
        title = title.slice(0, 30) + '...';
        var article = {
            id: item._id,
            name: title,
            type: 'article',
            count: 0,
            entities: [],
            types: [],
            source: item.source,
        };

        // get article plain text
        var sourceText = S(item.source).stripTags().s;
        // split plain text and full source into words
        var srcText = sourceText.split(/\s/);
        var src = item.source.split(/\s/);
        // split using additional characters for better processing
        for(var i = 0; i < srcText.length; i++) {
            var it = srcText[i];
            it = it.split('/');
            srcText[i] = it;
        }
        // flatten arrays
        srcText = _.flatten(srcText);

        var findSourceIndex = function(word, cleanWord, entityName, startIndex) {
            startIndex = startIndex || -1;
            // try to get plain match from original source
            var sourceIndex = src.indexOf(word, startIndex);
            // if not found, find by string
            if(sourceIndex === -1) {
                //if(entityName === testEntity) console.log('searching index in array');
                for(var i = 0; i < src.length; i++){
                    var srcWord = src[i];
                    // clean from hrefs
                    var srcWordClean = srcWord.replace(/href="(.+?)"(.*?>?)/, '').replace(/src="(.+?)"(.*?>?)/, '').replace(/alt="(.+?)"(.*?>?)/, '');
                    // skip if containes marking parts
                    if(srcWordClean.indexOf('span%marked%') !== -1) {
                        continue;
                    }

                    // check for match
                    if(srcWordClean.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) && i >= startIndex) {
                        sourceIndex = i;
                        break;
                    }
                }
            }

            return sourceIndex;
        };

        var cleanReg = /(^[\W]+)|([\W]+$)/g;
        var matchRegStart = '';
        var matchReg = '(\\W?)';

        // get entities
        item.entities.forEach(function(entity){
            var entityParts = entity.name.split(' ');

            // if only one word
            if(entityParts.length === 1) {
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    var entityClean = entity.name.replace(cleanReg, '');

                    // cehck match
                    if(cleanWord === entity.name || word === entity.name) {
                        // get match from original source
                        var sourceIndex = findSourceIndex(word, cleanWord, entity.name);
                        // if word was found
                        if(sourceIndex !== -1) {
                            var origSrc = src[sourceIndex];
                            var link = origSrc.match(/href="(.+?)"/);
                            var img = origSrc.match(/src="(.+?)"/);
                            var alt = origSrc.match(/alt="(.+?)"/);
                            if(link) {
                                link = link[1];
                                origSrc = origSrc.replace(link, '%link%');
                            }
                            if(img) {
                                img = img[1];
                                origSrc = origSrc.replace(img, '%img%');
                            }
                            if(alt) {
                                alt = alt[1];
                                origSrc = origSrc.replace(alt, '%alt%');
                            }

                            // enrich source
                            src[sourceIndex] = origSrc.replace(
                                entity.name,
                                '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                entity.types.join(' ') + '">' + entity.name + '</span%marked%>'
                            );

                            if(link) {
                                src[sourceIndex] = src[sourceIndex].replace('%link%', link);
                            }
                            if(img) {
                                src[sourceIndex] = src[sourceIndex].replace('%img%', img);
                            }
                            if(alt) {
                                src[sourceIndex] = src[sourceIndex].replace('%alt%', alt);
                            }
                        }

                        return;
                    }
                });
            } else {
                // check match
                var firstWord = entityParts[0];
                var lastWord = entityParts[entityParts.length-1];
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    if(cleanWord.indexOf('span%marked%') !== -1) {
                        return;
                    }
                    // test match
                    var match = firstWord.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) !== null;
                    if(match) {
                        var i = 0;
                        for(i = 1; i < entityParts.length; i++) {
                            if(index+i >= srcText.length) {
                                continue;
                            }

                            var nextCleanWord = srcText[index+i].replace(cleanReg, '');
                            if(nextCleanWord.indexOf('span%marked%') !== -1) {
                                continue;
                            }
                            match = match && entityParts[i].match(new RegExp(matchRegStart+escapeRegExp(nextCleanWord)+matchReg)) !== null;
                        }

                        // check complete match
                        if(match) {
                            // Replace first part
                            // get match from original source
                            var sourceStartIndex = findSourceIndex(word, cleanWord, firstWord, index);

                            // Replace end part
                            var endIndex = index+entityParts.length-1;
                            if(endIndex >= srcText.length) {
                                return;
                            }
                            var endWord = srcText[endIndex];
                            var endCleanWord = endWord.replace(/[^\w]/, '');
                            // try to get plain match from original source for start
                            var sourceEndIndex = findSourceIndex(endWord, endCleanWord, lastWord, endIndex);

                            // if word was found
                            if(sourceStartIndex !== -1 && sourceEndIndex !== -1 && Math.abs(sourceStartIndex - sourceEndIndex) < 5) {
                                // enrich source
                                src[sourceStartIndex] = src[sourceStartIndex].replace(
                                    new RegExp(escapeRegExp(firstWord)+'$'),
                                    '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                    entity.types.join(' ') + '">' + firstWord
                                );

                                // enrich source
                                src[sourceEndIndex] = src[sourceEndIndex].replace(lastWord, lastWord + '</span%marked%>');
                            }
                        }
                        return;
                    }
                });
            }

            // get entity data
            var ind = entityNames.indexOf(entity.name);
            var newEntity;
            if(ind !== -1) {
                newEntity = entities[ind];
                entities[ind].count += 1;
                if(entities[ind].articles.indexOf(article.id) === -1) {
                    entities[ind].articles.push(article.id);
                }
                if(article.entities.indexOf(newEntity.id) === -1) {
                    article.entities.push(newEntity.id);
                }
            } else {
                newEntity = {
                    id: entity._id,
                    name: entity.name,
                    type: 'entity',
                    count: 1,
                    articles: [article.id],
                    types: []
                };
                article.entities.push(newEntity.id);
            }

            // get types
            entity.types.forEach(function(type){
                // get type data
                var name = type.split(':')[1];
                var tid = 'type_'+name;
                var ind = typeNames.indexOf(name);
                if(ind !== -1) {
                    types[ind].count += 1;
                    types[ind].entities.push(newEntity.id);
                    types[ind].articles.push(article.id);
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push(tid);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push(tid);
                    }
                } else {
                    types.push({
                        id: tid,
                        name: name,
                        type: 'type',
                        count: 1,
                        entities: [newEntity.id],
                        articles: [article.id],
                    });
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push('type_'+name);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push('type_'+name);
                    }
                    typeNames.push(name);
                }
            });

            if(ind === -1) {
                entities.push(newEntity);
                entityNames.push(newEntity.name);
            }
        });

        // join source back
        item.source = src.join(' ').replace(/span%marked%/g, 'span');
        article.source = item.source;

        // push to array
        articles.push(article);
    });

    // sort arrays by count
    var sortFunction = function(a, b) {
        return b.count - a.count;
    };
    entities = entities.sort(sortFunction);
    types = types.sort(sortFunction);

    return {
        articles: articles,
        types: types,
        entities: entities
    };
};

// expose
exports.processData = processData;

},{}],16:[function(require,module,exports){
// get extentions
var extentions = require('../data/corpusextentions');

// init module
var corpusModule = angular.module('CorpusModule', ['ui.router']);

// config routes
corpusModule.config(function ($stateProvider, $urlRouterProvider) {
    // main view
    $stateProvider.state('corpus', {
        url: '/corpus/:id',
        controller: require('../controllers/corpus/main'),
        templateUrl: '/templates/corpusView.html',
        resolve: {
            corpus: ['$http', '$stateParams', function($http, $stateParams) {
                return $http({method: 'GET', url: '/api/corpus/' + $stateParams.id});
            }]
        }
    });

    // make view routes for extentions
    extentions.forEach(function(ex) {
        $stateProvider.state('corpus.' + ex.name, {
            url: ex.path,
            templateUrl: ex.template,
            controller: ex.controller,
        });
    });
});

// register controllers
extentions.forEach(function(ex) {
    corpusModule.controller(ex.controller, ['$scope', '$state', '$sce', ex.js]);
});

// export
module.exports = corpusModule;

},{"../controllers/corpus/main":3,"../data/corpusextentions":10}],17:[function(require,module,exports){
module.exports = function applyRoutes (app) {
    app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
        $routeProvider.when('/', { controller: 'HomeController', template: '' });
        $routeProvider.when('/auth', { controller: 'LoginController', template: '' });
        $routeProvider.when('/register', { controller: 'RegisterController', template: '' });
        $routeProvider.when('/createCorpus', { controller: 'CreateCorpusController', templateUrl: '/templates/createCorpus.html' });

        $locationProvider.html5Mode(true);
    }]);
};
},{}],18:[function(require,module,exports){
module.exports = function applyServices (app) {
};

},{}]},{},[13])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL2NvcnB1cy9mYWNldHMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvbWFpbi5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL2NvcnB1cy9vdmVydmlldy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL2NyZWF0ZWNvcnB1cy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL2hvbWUuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9wcm9maWxlLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvcmVnaXN0ZXIuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kYXRhL2NvcnB1c1R5cGVzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvZGF0YS9jb3JwdXNleHRlbnRpb25zLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvZGF0YS9ubHBBcGlzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvZGlyZWN0aXZlcy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2Zha2VfNTViNGZmMjMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9maWx0ZXJzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvbW9kdWxlcy9GYWNldHNQcm9jZXNzZXIuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9tb2R1bGVzL2NvcnB1cy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL3JvdXRlcy5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL3NlcnZpY2VzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseUNvbnRyb2xsZXJzIChhcHApIHtcbiAgICBhcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBbJyRzY29wZScsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvaG9tZS5qcycpXSk7XG4gICAgYXBwLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ29udHJvbGxlcicsIFsnJHNjb3BlJywgcmVxdWlyZSgnLi9jb250cm9sbGVycy9yZWdpc3Rlci5qcycpXSk7XG4gICAgYXBwLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgWyckc2NvcGUnLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL3Byb2ZpbGUuanMnKV0pO1xuICAgIGFwcC5jb250cm9sbGVyKCdDcmVhdGVDb3JwdXNDb250cm9sbGVyJywgWyckc2NvcGUnLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL2NyZWF0ZWNvcnB1cy5qcycpXSk7XG59OyIsIi8vIGluY2x1ZGVzXG52YXIgRmFjZXRzUHJvY2Vzc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9GYWNldHNQcm9jZXNzZXInKTtcblxuLy8gZGF0YVxudmFyIGZhY2V0c0RhdGE7XG52YXIgdHlwZXMsIGVudGl0aWVzLCBhcnRpY2xlcztcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBDb3JwdXNGYWNldHNDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc2NlKSB7XG4gICAgLy8gaW5pdCBlbXB0eSBmYWNldCBmaWx0ZXJzXG4gICAgJHNjb3BlLnR5cGVGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgJHNjb3BlLmVudGl0eUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAkc2NvcGUuYXJ0aWNsZUZpbHRlciA9IHVuZGVmaW5lZDtcblxuICAgICRzY29wZS5zZXRGaWx0ZXIgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIHN3aXRjaChpdGVtLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FydGljbGUnOlxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5hcnRpY2xlRmlsdGVyID09PSBpdGVtLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnRpY2xlRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnRpY2xlRmlsdGVyID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdlbnRpdHknOlxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5lbnRpdHlGaWx0ZXIgPT09IGl0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVudGl0eUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZW50aXR5RmlsdGVyID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0eXBlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUudHlwZUZpbHRlciA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHlwZUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHlwZUZpbHRlciA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5pdGVtQWN0aXZlID0gZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBzd2l0Y2goaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmFydGljbGVGaWx0ZXIgPT09IGl0ZW0uaWQ7XG4gICAgICAgICAgICBjYXNlICdlbnRpdHknOlxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZW50aXR5RmlsdGVyID09PSBpdGVtLmlkO1xuICAgICAgICAgICAgY2FzZSAndHlwZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS50eXBlRmlsdGVyID09PSBpdGVtLmlkO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5mYWNldEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciBmaWx0ZXJBcnRpY2xlID0gZmFsc2U7XG4gICAgICAgIHZhciBmaWx0ZXJFbnRpdHkgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpbHRlclR5cGUgPSBmYWxzZTtcblxuICAgICAgICBzd2l0Y2goaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuZW50aXR5RmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyRW50aXR5ID0gaXRlbS5lbnRpdGllcy5pbmRleE9mKCRzY29wZS5lbnRpdHlGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJFbnRpdHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZigkc2NvcGUudHlwZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGUgPSBpdGVtLnR5cGVzLmluZGV4T2YoJHNjb3BlLnR5cGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckVudGl0eSAmJiBmaWx0ZXJUeXBlO1xuICAgICAgICAgICAgY2FzZSAnZW50aXR5JzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuYXJ0aWNsZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFydGljbGUgPSBpdGVtLmFydGljbGVzLmluZGV4T2YoJHNjb3BlLmFydGljbGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGVGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlID0gaXRlbS50eXBlcy5pbmRleE9mKCRzY29wZS50eXBlRmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJBcnRpY2xlICYmIGZpbHRlclR5cGU7XG4gICAgICAgICAgICBjYXNlICd0eXBlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuYXJ0aWNsZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFydGljbGUgPSBpdGVtLmFydGljbGVzLmluZGV4T2YoJHNjb3BlLmFydGljbGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmVudGl0eUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckVudGl0eSA9IGl0ZW0uZW50aXRpZXMuaW5kZXhPZigkc2NvcGUuZW50aXR5RmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyRW50aXR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckFydGljbGUgJiYgZmlsdGVyRW50aXR5O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIGdldCBkYXRhXG4gICAgJC5nZXRKU09OKCcvYXBpL2NvcnB1cy8nICsgJHNjb3BlLmN1cnJlbnRDb3JwdXMuX2lkICsgJy9mYWNldHMnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGZhY2V0c0RhdGEgPSBGYWNldHNQcm9jZXNzZXIucHJvY2Vzc0RhdGEoZGF0YSk7XG5cbiAgICAgICAgLy8gdHlwZXNcbiAgICAgICAgdHlwZXMgPSBmYWNldHNEYXRhLnR5cGVzO1xuICAgICAgICAvLyBlbnRpdGllc1xuICAgICAgICBlbnRpdGllcyA9IGZhY2V0c0RhdGEuZW50aXRpZXM7XG4gICAgICAgIC8vIGFydGljbGVzXG4gICAgICAgIGFydGljbGVzID0gZmFjZXRzRGF0YS5hcnRpY2xlcztcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGFydGljbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcnRpY2xlc1tpXS5zb3VyY2VTYWZlID0gJHNjZS50cnVzdEFzSHRtbChhcnRpY2xlc1tpXS5zb3VyY2UpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBkYXRhIGluIHNjb3BlXG4gICAgICAgICRzY29wZS5kYXRhID0gW1xuICAgICAgICAgICAge25hbWU6ICdBcnRpY2xlcycsIHZhbHVlczogYXJ0aWNsZXN9LFxuICAgICAgICAgICAge25hbWU6ICdUeXBlcycsIHZhbHVlczogdHlwZXN9LFxuICAgICAgICAgICAge25hbWU6ICdFbnRpdGllcycsIHZhbHVlczogZW50aXRpZXN9LFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIHJlZHJhd1xuICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgfSk7XG59O1xuIiwiLy8gZXh0ZW50aW9uc1xudmFyIGV4dGVudGlvbnMgPSByZXF1aXJlKCcuLi8uLi9kYXRhL2NvcnB1c2V4dGVudGlvbnMnKTtcblxuLy8gY29ycHVzIG9iamVjdFxudmFyIGN1cnJlbnRDb3JwdXMgPSB7XG4gICAgdXJpOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGl0ID0gdGhpcy5pbnB1dF90eXBlO1xuICAgICAgICBpZihpdCA9PT0gJ3R3aXR0ZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2h0dHA6Ly90d2l0dGVyLmNvbS8nICsgdGhpcy5pbnB1dDtcbiAgICAgICAgfSBlbHNlIGlmKGl0ID09PSAnZGlyZWN0Jykge1xuICAgICAgICAgICAgcmV0dXJuICctJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0O1xuICAgICAgICB9XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBNYWluQ29ycHVzQ29udHJvbGxlcigkc2NvcGUsICRsb2NhdGlvbiwgJHN0YXRlLCBjb3JwdXMpIHtcbiAgICAvLyBzZXQgY3VycmVudCBjb3JwdXMgZGF0YVxuICAgIGN1cnJlbnRDb3JwdXMgPSBfLmV4dGVuZChjdXJyZW50Q29ycHVzLCBjb3JwdXMuZGF0YSk7XG4gICAgLy8gZXhwb3NlIGNvcnB1cyB0byBzY29wZVxuICAgICRzY29wZS5jdXJyZW50Q29ycHVzID0gY3VycmVudENvcnB1cztcblxuICAgIC8vIGluaXQgZXh0ZW50aW9uc1xuICAgICRzY29wZS5leHRlbnRpb25zID0gZXh0ZW50aW9ucztcbiAgICAvLyBleHBvc2Ugc3RhdGVcbiAgICAkc2NvcGUuJHN0YXRlID0gJHN0YXRlO1xuXG4gICAgLy8gcmVuZGVyIGZpcnN0IHZpZXcgaWYgbmVlZGVkXG4gICAgJHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgZnVuY3Rpb24gb25SZW5kZXIoKSB7XG4gICAgICAgIHZhciBsZW4gPSAkbG9jYXRpb24ucGF0aCgpLnNwbGl0KCcvJykubGVuZ3RoO1xuICAgICAgICAvLyBpZiBwYWdlIGlzIGp1c3QgbG9hZGVkXG4gICAgICAgIGlmKGxlbiA9PT0gMykge1xuICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gZmlyc3Qgc3Vidmlld1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdjb3JwdXMuJytleHRlbnRpb25zWzBdLm5hbWUpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBDb3JwdXNPdmVydmlld0NvbnRyb2xsZXIoJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbikge1xuICAgIGNvbnNvbGUubG9nKCdjb3JwdXMgb3ZlcnZpZXcnKTtcbn07XG4iLCJ2YXIgY29ycHVzVHlwZXMgPSByZXF1aXJlKCcuLi9kYXRhL2NvcnB1c1R5cGVzLmpzJyk7XG52YXIgbmxwQXBpcyA9IHJlcXVpcmUoJy4uL2RhdGEvbmxwQXBpcy5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIENyZWF0ZUNvcnB1c0NvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy8gY29sbGVjdGlvbiBvZiBjb3JwdXMgdHlwZXNcbiAgICAkc2NvcGUuY29ycHVzVHlwZXMgPSBjb3JwdXNUeXBlcztcbiAgICAvLyBjb2xsZWN0aW9uIG9mIG5scCBhcGlzXG4gICAgJHNjb3BlLm5scEFwaXMgPSBubHBBcGlzO1xuXG4gICAgLy8gY3VycmVudCBjb3JwdXNcbiAgICAkc2NvcGUuY29ycHVzU2VsZWN0aW9uID0ge2luZGV4OiAwfTtcbiAgICAkc2NvcGUuY3VycmVudENvcnB1cyA9ICRzY29wZS5jb3JwdXNUeXBlc1swXTtcblxuICAgIC8vIGlucHV0IHNsaWRlciByZWZlcmVuY2VcbiAgICB2YXIgJGlucHV0Q291bnQsICRzbGlkZXJDb250YWluZXI7XG4gICAgLy8gdXBkYXRlIHZpZXcgc2xpZGVyXG4gICAgdmFyIHVwZGF0ZVZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3ZpZXcgbG9hZGVkIScpO1xuICAgICAgICAkc2NvcGUuY3VycmVudENvcnB1cyA9ICRzY29wZS5jb3JwdXNUeXBlc1skc2NvcGUuY29ycHVzU2VsZWN0aW9uLmluZGV4XTtcbiAgICAgICAgaWYoJHNjb3BlLmN1cnJlbnRDb3JwdXMuaGF2ZUl0ZW1zKSB7XG4gICAgICAgICAgICBpZighJGlucHV0Q291bnQpIHtcbiAgICAgICAgICAgICAgICAkc2xpZGVyQ29udGFpbmVyID0gJCgnI3NsaWRlcl9jb250YWluZXInKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRDb3VudCA9ICQoJyNpbnB1dF9jb3VudCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaW5wdXRDb3VudC5zbGlkZXIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzbGlkZXJDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgJGlucHV0Q291bnQuc2xpZGVyKHtcbiAgICAgICAgICAgICAgICBtaW46ICRzY29wZS5jdXJyZW50Q29ycHVzLml0ZW1zTWluLFxuICAgICAgICAgICAgICAgIG1heDogJHNjb3BlLmN1cnJlbnRDb3JwdXMuaXRlbXNNYXgsXG4gICAgICAgICAgICAgICAgc3RlcDogNTAsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICRzY29wZS5jdXJyZW50Q29ycHVzLml0ZW1zRGVmYXVsdCxcbiAgICAgICAgICAgICAgICB0b29sdGlwOiAnYWx3YXlzJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2xpZGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyB1cGRhdGUgdmlldyBvbiBtb2RlbCBjaGFuZ2VcbiAgICAkc2NvcGUuJHdhdGNoKCdjb3JwdXNTZWxlY3Rpb24nLCB1cGRhdGVWaWV3LCB0cnVlKTtcblxuICAgIC8vIHVwZGF0ZSBzbGlkZXJcbiAgICAkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCB1cGRhdGVWaWV3KTtcblxuICAgIC8vIGFuYWx5c2lzIHN0YXJ0IGZ1bmN0aW9uXG4gICAgJHNjb3BlLnN0YXJ0QW5hbHlzaXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGdldCBmaWVsZHNcbiAgICAgICAgdmFyICRpbnB1dEl0ZW0gPSAkKCcjaW5wdXRfaXRlbScpO1xuICAgICAgICB2YXIgJGlucHV0SXRlbUFyZWEgPSAkKCcjaW5wdXRfaXRlbV9hcmVhJyk7XG4gICAgICAgIHZhciAkaW5wdXRJdGVtRmlsZSA9ICQoJyNpbnB1dF9pdGVtX2ZpbGUnKTtcbiAgICAgICAgdmFyICRpbnB1dENvdW50RmllbGQgPSAkKCdpbnB1dCNpbnB1dF9jb3VudCcpO1xuICAgICAgICB2YXIgJG5ld0NvcnB1c0Zvcm0gPSAkKCcjbmV3Y29ycHVzX2Zvcm0nKTtcbiAgICAgICAgdmFyICRpbnB1dFR5cGUgPSAkKCdpbnB1dFtuYW1lPWlucHV0X3R5cGVdOmNoZWNrZWQnKTtcblxuICAgICAgICAvLyByZW1vdmUgb2xkIHdhcm5pbmdcbiAgICAgICAgJGlucHV0SXRlbS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLXdhcm5pbmcnKTtcblxuICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dFxuICAgICAgICB2YXIgaW5wdXQgPSBudWxsO1xuICAgICAgICB2YXIgY29ycHVzVHlwZSA9ICRzY29wZS5jdXJyZW50Q29ycHVzLm5hbWU7XG4gICAgICAgIHZhciBpbnB1dFR5cGUgPSAkc2NvcGUuY3VycmVudENvcnB1cy5pbnB1dFR5cGU7XG4gICAgICAgIHN3aXRjaChpbnB1dFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgICAgIGlucHV0ID0gJGlucHV0SXRlbS52YWwoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAkaW5wdXRJdGVtQXJlYS52YWwoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICAgICAgICBpbnB1dCA9ICRpbnB1dEl0ZW1GaWxlLnZhbCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnB1dCkge1xuICAgICAgICAgICAgJGlucHV0SXRlbS5wYXJlbnQoKS5hZGRDbGFzcygnaGFzLXdhcm5pbmcnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFzc2lnbiBjb3VudCB0byBpbnB1dCBmaWVsZFxuICAgICAgICB2YXIgaXRlbUNvdW50ID0gJGlucHV0Q291bnQuc2xpZGVyKCdnZXRWYWx1ZScpO1xuICAgICAgICAkaW5wdXRDb3VudEZpZWxkLnZhbChpdGVtQ291bnQpO1xuXG4gICAgICAgIC8vIHJlbW92ZSB1bm5lZWRlZCBpbnB1dHMgJiByZW5hbWUgbGFzdCBvbmVcbiAgICAgICAgc3dpdGNoKGlucHV0VHlwZSkge1xuICAgICAgICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbS5hdHRyKCduYW1lJywgJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbUFyZWEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbUZpbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtQXJlYS5hdHRyKCduYW1lJywgJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbUZpbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1BcmVhLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1GaWxlLmF0dHIoJ25hbWUnLCAnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHN3YXAgaW5wdXQgdHlwZSB2YWx1ZVxuICAgICAgICAkaW5wdXRUeXBlLnZhbChjb3JwdXNUeXBlKTtcblxuICAgICAgICAvLyBzZW5kIHRvIHNlcnZlclxuICAgICAgICAkbmV3Q29ycHVzRm9ybS5zdWJtaXQoKTtcbiAgICB9O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy8gY29ycHVzIG1vZGVsXG4gICAgJHNjb3BlLmNvcnB1cyA9ICcwJztcbiAgICAvLyBvbiBjb3JwdXMgc2VsZWN0IGV2ZW50XG4gICAgJHNjb3BlLmNvcnB1c1NlbGVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBkbyBub3QgZG8gYW55dGhpbmcgaWYgaXQncyBkdW1teSBlbnRyeVxuICAgICAgICBpZigkc2NvcGUuY29ycHVzID09PSAnMCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyByZWRpcmVjdCB0byBjb3JwdXNcbiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9jb3JwdXMvJyArICRzY29wZS5jb3JwdXM7XG4gICAgfTtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSkge1xuICAgIC8vXG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBSZWdpc3RlckNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy9cbn07XG4iLCIvLyBidWlsZCBjb2xsZWN0aW9uIG9mIGl0ZW1zXG52YXIgY29sbGVjdGlvbiA9IFtdO1xuLy8gcnNzXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdmZWVkJyxcbiAgICBkZXNjcmlwdGlvbjogJ1JTUy9SREYvQVRPTSBGZWVkJyxcbiAgICBpbnB1dFR5cGU6ICd0ZXh0JyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnVVJMIG9mIHRoZSBSU1MvUkRGL0FUT00gZmVlZCcsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ1VSTCBvZiB5b3VyIGZlZWQnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogNTAsXG4gICAgaXRlbXNNYXg6IDYwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDUwLFxufSk7XG4vLyB3b3JkcHJlc3NcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ3dvcmRwcmVzcycsXG4gICAgZGVzY3JpcHRpb246ICdXb3JkUHJlc3MgQmxvZycsXG4gICAgaW5wdXRUeXBlOiAndGV4dCcsXG4gICAgaW5wdXREZXNjcmlwdGlvbjogJ1dlYmxvZyBVUkwnLFxuICAgIGlucHV0UGxhY2Vob2xkZXI6ICdVUkwgb2YgdGhlIGJsb2cnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogNTAsXG4gICAgaXRlbXNNYXg6IDQwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDQwMCxcbn0pO1xuLy8gYmxvZ2dlclxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnYmxvZ2dlcicsXG4gICAgZGVzY3JpcHRpb246ICdCbG9nZ2VyIEJsb2cnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdXZWJsb2cgVVJMJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVVJMIG9mIHRoZSBibG9nJyxcbiAgICBoYXZlSXRlbXM6IHRydWUsXG4gICAgaXRlbXNNaW46IDUwLFxuICAgIGl0ZW1zTWF4OiA0MDAsXG4gICAgaXRlbXNEZWZhdWx0OiA0MDAsXG59KTtcbi8vIHB1YmxpYyB0d2l0dGVyXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICd0d2l0dGVyJyxcbiAgICBkZXNjcmlwdGlvbjogJ1B1YmxpYyBUd2l0dGVyIGFjY291bnQnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdUd2l0dGVyIHVzZXJuYW1lJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVXNlcm5hbWUnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogMjAwLFxuICAgIGl0ZW1zTWF4OiAxNTAwLFxuICAgIGl0ZW1zRGVmYXVsdDogMTAwMCxcbn0pO1xuLy8gc2xpZGV3aWtpXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdzbGlkZXdpa2knLFxuICAgIGRlc2NyaXB0aW9uOiAnU2xpZGVXaWtpIERlY2snLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdEZWNrIElEJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnRGVjayBJRCcsXG4gICAgaGF2ZUl0ZW1zOiB0cnVlLFxuICAgIGl0ZW1zTWluOiA1MCxcbiAgICBpdGVtc01heDogMTAwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDQwMCxcbn0pO1xuLy8gd2VicGFnZVxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnd2VicGFnZScsXG4gICAgZGVzY3JpcHRpb246ICdXZWIgcGFnZScsXG4gICAgaW5wdXRUeXBlOiAndGV4dCcsXG4gICAgaW5wdXREZXNjcmlwdGlvbjogJ1dlYlBhZ2UgVVJMJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVVJMJyxcbiAgICBoYXZlSXRlbXM6IGZhbHNlLFxufSk7XG4vLyBkaXJlY3QgaW5wdXRcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ2RpcmVjdGlucHV0JyxcbiAgICBkZXNjcmlwdGlvbjogJ0RpcmVjdCBpbnB1dCcsXG4gICAgaW5wdXRUeXBlOiAndGV4dGFyZWEnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdZb3VyIHRleHQvaHRtbCcsXG4gICAgaGF2ZUl0ZW1zOiBmYWxzZSxcbn0pO1xuLy8gdXBsb2FkIGEgZG9jXG4vLyBUT0RPOiBpbXBsZW1lbnQsIHRoZW4gcmUtZW5hYmxlXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdkb2MnLFxuICAgIGRlc2NyaXB0aW9uOiAnVXBsb2FkIGEgZG9jdW1lbnQnLFxuICAgIGlucHV0VHlwZTogJ2ZpbGUnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdEb2N1bWVudCcsXG4gICAgaGF2ZUl0ZW1zOiBmYWxzZSxcbn0pO1xuXG4vLyBPdXIgbW9kdWxlIG5vdyByZXR1cm5zIG91ciB2aWV3XG5tb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb247XG4iLCJ2YXIgY29sbGVjdGlvbiA9IFtdO1xuLy8gb3ZlcnZpZXdcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ092ZXJ2aWV3JyxcbiAgICBwYXRoOiAnL292ZXJ2aWV3JyxcbiAgICBjb250cm9sbGVyOiAnQ29ycHVzT3ZlcnZpZXdDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzT3ZlcnZpZXcuaHRtbCcsXG4gICAganM6IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL2NvcnB1cy9vdmVydmlldy5qcycpLFxufSk7XG4vLyBmYWNldHNcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ0ZhY2V0cycsXG4gICAgcGF0aDogJy9mYWNldHMnLFxuICAgIGNvbnRyb2xsZXI6ICdDb3JwdXNGYWNldHNDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzRmFjZXRzLmh0bWwnLFxuICAgIGpzOiByZXF1aXJlKCcuLi9jb250cm9sbGVycy9jb3JwdXMvZmFjZXRzLmpzJyksXG59KTtcblxuLy8gT3VyIG1vZHVsZSBub3cgcmV0dXJucyBvdXIgdmlld1xubW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uOyIsIi8vIGJ1aWxkIGNvbGxlY3Rpb24gb2YgaXRlbXNcbnZhciBjb2xsZWN0aW9uID0gW107XG4vLyBzcG90bGlnaHRcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgaWQ6ICdEQnBlZGlhLVNwb3RsaWdodCcsXG4gICAgbmFtZTogJ0RCcGVkaWEgU3BvdGxpZ2h0Jyxcbn0pO1xuLy8gZm94XG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIGlkOiAnRk9YJyxcbiAgICBuYW1lOiAnRk9YJyxcbn0pO1xuXG4vLyBPdXIgbW9kdWxlIG5vdyByZXR1cm5zIG91ciB2aWV3XG5tb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb247XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFwcGx5RGlyZWN0aXZlcyAoYXBwKSB7XG59OyIsIi8vIGluaXQgYXBwXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NvbnRleHQtYXBwJywgWyduZ1JvdXRlJywgJ21nY3JlYS5uZ1N0cmFwJywgJ0NvcnB1c01vZHVsZSddKTtcblxuLy8gbG9hZCBtb2R1bGVzXG52YXIgQ29ycHVzTW9kdWxlID0gcmVxdWlyZSgnLi9tb2R1bGVzL2NvcnB1cycpO1xuXG4vLyBjb25maWcgYXBwIHJvdXRlc1xucmVxdWlyZSgnLi9yb3V0ZXMnKShhcHApO1xuXG4vLyBjb25maWcgYXBwIHNlcnZpY2VzXG5yZXF1aXJlKCcuL3NlcnZpY2VzJykoYXBwKTtcblxuLy8gaW5pdCBjb250cm9sbGVyc1xucmVxdWlyZSgnLi9jb250cm9sbGVycycpKGFwcCk7XG5cbi8vIGNvbmZpZyBhcHAgZGlyZWN0aXZlc1xucmVxdWlyZSgnLi9kaXJlY3RpdmVzJykoYXBwKTtcblxuLy8gY29uZmlnIGFwcCBmaWx0ZXJzXG5yZXF1aXJlKCcuL2ZpbHRlcnMnKShhcHApO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseUZpbHRlcnMgKGFwcCkge1xufTsiLCJ2YXIgZXNjYXBlUmVnRXhwID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXFwtXFxbXFxdXFwvXFx7XFx9XFwoXFwpXFwqXFwrXFw/XFwuXFxcXFxcXlxcJFxcfF0vZywgJ1xcXFwkJicpO1xufTtcblxudmFyIHByb2Nlc3NEYXRhID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIC8vIGFydGljbGVzXG4gICAgdmFyIGFydGljbGVzID0gW107XG4gICAgLy8gdHlwZXNcbiAgICB2YXIgdHlwZXMgPSBbXTtcbiAgICB2YXIgdHlwZU5hbWVzID0gW107XG4gICAgLy8gZW50aXRpZXNcbiAgICB2YXIgZW50aXRpZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5TmFtZXMgPSBbXTtcblxuICAgIC8vIGV4dHJhY3QgZGF0YVxuICAgIGRhdGEuYXJ0aWNsZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIC8vIGdldCBhcnRpY2xlIGRhdGFcbiAgICAgICAgdmFyIHRpdGxlID0gJyc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgZG9tID0gJChpdGVtLnNvdXJjZSk7XG4gICAgICAgICAgICB0aXRsZSA9ICQoJ2V4dHJhY3RlZC10aXRsZScsIGRvbSkudGV4dCgpIHx8IGRvbS50ZXh0KCk7XG4gICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgdGl0bGUgPSBpdGVtLnNvdXJjZTtcbiAgICAgICAgfVxuICAgICAgICB0aXRsZSA9IHRpdGxlLnNsaWNlKDAsIDMwKSArICcuLi4nO1xuICAgICAgICB2YXIgYXJ0aWNsZSA9IHtcbiAgICAgICAgICAgIGlkOiBpdGVtLl9pZCxcbiAgICAgICAgICAgIG5hbWU6IHRpdGxlLFxuICAgICAgICAgICAgdHlwZTogJ2FydGljbGUnLFxuICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICBlbnRpdGllczogW10sXG4gICAgICAgICAgICB0eXBlczogW10sXG4gICAgICAgICAgICBzb3VyY2U6IGl0ZW0uc291cmNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGdldCBhcnRpY2xlIHBsYWluIHRleHRcbiAgICAgICAgdmFyIHNvdXJjZVRleHQgPSBTKGl0ZW0uc291cmNlKS5zdHJpcFRhZ3MoKS5zO1xuICAgICAgICAvLyBzcGxpdCBwbGFpbiB0ZXh0IGFuZCBmdWxsIHNvdXJjZSBpbnRvIHdvcmRzXG4gICAgICAgIHZhciBzcmNUZXh0ID0gc291cmNlVGV4dC5zcGxpdCgvXFxzLyk7XG4gICAgICAgIHZhciBzcmMgPSBpdGVtLnNvdXJjZS5zcGxpdCgvXFxzLyk7XG4gICAgICAgIC8vIHNwbGl0IHVzaW5nIGFkZGl0aW9uYWwgY2hhcmFjdGVycyBmb3IgYmV0dGVyIHByb2Nlc3NpbmdcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNyY1RleHQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdCA9IHNyY1RleHRbaV07XG4gICAgICAgICAgICBpdCA9IGl0LnNwbGl0KCcvJyk7XG4gICAgICAgICAgICBzcmNUZXh0W2ldID0gaXQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZmxhdHRlbiBhcnJheXNcbiAgICAgICAgc3JjVGV4dCA9IF8uZmxhdHRlbihzcmNUZXh0KTtcblxuICAgICAgICB2YXIgZmluZFNvdXJjZUluZGV4ID0gZnVuY3Rpb24od29yZCwgY2xlYW5Xb3JkLCBlbnRpdHlOYW1lLCBzdGFydEluZGV4KSB7XG4gICAgICAgICAgICBzdGFydEluZGV4ID0gc3RhcnRJbmRleCB8fCAtMTtcbiAgICAgICAgICAgIC8vIHRyeSB0byBnZXQgcGxhaW4gbWF0Y2ggZnJvbSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgICAgICAgIHZhciBzb3VyY2VJbmRleCA9IHNyYy5pbmRleE9mKHdvcmQsIHN0YXJ0SW5kZXgpO1xuICAgICAgICAgICAgLy8gaWYgbm90IGZvdW5kLCBmaW5kIGJ5IHN0cmluZ1xuICAgICAgICAgICAgaWYoc291cmNlSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy9pZihlbnRpdHlOYW1lID09PSB0ZXN0RW50aXR5KSBjb25zb2xlLmxvZygnc2VhcmNoaW5nIGluZGV4IGluIGFycmF5Jyk7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNyYy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzcmNXb3JkID0gc3JjW2ldO1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhbiBmcm9tIGhyZWZzXG4gICAgICAgICAgICAgICAgICAgIHZhciBzcmNXb3JkQ2xlYW4gPSBzcmNXb3JkLnJlcGxhY2UoL2hyZWY9XCIoLis/KVwiKC4qPz4/KS8sICcnKS5yZXBsYWNlKC9zcmM9XCIoLis/KVwiKC4qPz4/KS8sICcnKS5yZXBsYWNlKC9hbHQ9XCIoLis/KVwiKC4qPz4/KS8sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2tpcCBpZiBjb250YWluZXMgbWFya2luZyBwYXJ0c1xuICAgICAgICAgICAgICAgICAgICBpZihzcmNXb3JkQ2xlYW4uaW5kZXhPZignc3BhbiVtYXJrZWQlJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBtYXRjaFxuICAgICAgICAgICAgICAgICAgICBpZihzcmNXb3JkQ2xlYW4ubWF0Y2gobmV3IFJlZ0V4cChtYXRjaFJlZ1N0YXJ0K2VzY2FwZVJlZ0V4cChjbGVhbldvcmQpK21hdGNoUmVnKSkgJiYgaSA+PSBzdGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZUluZGV4O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjbGVhblJlZyA9IC8oXltcXFddKyl8KFtcXFddKyQpL2c7XG4gICAgICAgIHZhciBtYXRjaFJlZ1N0YXJ0ID0gJyc7XG4gICAgICAgIHZhciBtYXRjaFJlZyA9ICcoXFxcXFc/KSc7XG5cbiAgICAgICAgLy8gZ2V0IGVudGl0aWVzXG4gICAgICAgIGl0ZW0uZW50aXRpZXMuZm9yRWFjaChmdW5jdGlvbihlbnRpdHkpe1xuICAgICAgICAgICAgdmFyIGVudGl0eVBhcnRzID0gZW50aXR5Lm5hbWUuc3BsaXQoJyAnKTtcblxuICAgICAgICAgICAgLy8gaWYgb25seSBvbmUgd29yZFxuICAgICAgICAgICAgaWYoZW50aXR5UGFydHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gZmluZCB3b3JkIHRoYXQgbWF0Y2hlcyBjdXJyZW50IGVudGl0eVxuICAgICAgICAgICAgICAgIHNyY1RleHQuZm9yRWFjaChmdW5jdGlvbih3b3JkLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhbiB3b3JkIGZyb20gY29tbWFzLCBkb3RzIGFuZCBvdGhlciBzdXBsZW1lbnRhcnkgc3R1ZmZcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNsZWFuV29yZCA9IHdvcmQucmVwbGFjZShjbGVhblJlZywgJycpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW50aXR5Q2xlYW4gPSBlbnRpdHkubmFtZS5yZXBsYWNlKGNsZWFuUmVnLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2VoY2sgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgaWYoY2xlYW5Xb3JkID09PSBlbnRpdHkubmFtZSB8fCB3b3JkID09PSBlbnRpdHkubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IG1hdGNoIGZyb20gb3JpZ2luYWwgc291cmNlXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlSW5kZXggPSBmaW5kU291cmNlSW5kZXgod29yZCwgY2xlYW5Xb3JkLCBlbnRpdHkubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3b3JkIHdhcyBmb3VuZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc291cmNlSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdTcmMgPSBzcmNbc291cmNlSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5rID0gb3JpZ1NyYy5tYXRjaCgvaHJlZj1cIiguKz8pXCIvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gb3JpZ1NyYy5tYXRjaCgvc3JjPVwiKC4rPylcIi8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHQgPSBvcmlnU3JjLm1hdGNoKC9hbHQ9XCIoLis/KVwiLyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobGluaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rID0gbGlua1sxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NyYyA9IG9yaWdTcmMucmVwbGFjZShsaW5rLCAnJWxpbmslJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSBpbWdbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdTcmMgPSBvcmlnU3JjLnJlcGxhY2UoaW1nLCAnJWltZyUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCA9IGFsdFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NyYyA9IG9yaWdTcmMucmVwbGFjZShhbHQsICclYWx0JScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVucmljaCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gb3JpZ1NyYy5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuJW1hcmtlZCUgY2xhc3M9XCJsYWJlbCBsYWJlbC13YXJuaW5nIGhhc1Rvb2x0aXBcIiBkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIiB0aXRsZT1cIicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkudHlwZXMuam9pbignICcpICsgJ1wiPicgKyBlbnRpdHkubmFtZSArICc8L3NwYW4lbWFya2VkJT4nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjW3NvdXJjZUluZGV4XSA9IHNyY1tzb3VyY2VJbmRleF0ucmVwbGFjZSgnJWxpbmslJywgbGluayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gc3JjW3NvdXJjZUluZGV4XS5yZXBsYWNlKCclaW1nJScsIGltZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gc3JjW3NvdXJjZUluZGV4XS5yZXBsYWNlKCclYWx0JScsIGFsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgbWF0Y2hcbiAgICAgICAgICAgICAgICB2YXIgZmlyc3RXb3JkID0gZW50aXR5UGFydHNbMF07XG4gICAgICAgICAgICAgICAgdmFyIGxhc3RXb3JkID0gZW50aXR5UGFydHNbZW50aXR5UGFydHMubGVuZ3RoLTFdO1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgd29yZCB0aGF0IG1hdGNoZXMgY3VycmVudCBlbnRpdHlcbiAgICAgICAgICAgICAgICBzcmNUZXh0LmZvckVhY2goZnVuY3Rpb24od29yZCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYW4gd29yZCBmcm9tIGNvbW1hcywgZG90cyBhbmQgb3RoZXIgc3VwbGVtZW50YXJ5IHN0dWZmXG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGVhbldvcmQgPSB3b3JkLnJlcGxhY2UoY2xlYW5SZWcsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoY2xlYW5Xb3JkLmluZGV4T2YoJ3NwYW4lbWFya2VkJScpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gZmlyc3RXb3JkLm1hdGNoKG5ldyBSZWdFeHAobWF0Y2hSZWdTdGFydCtlc2NhcGVSZWdFeHAoY2xlYW5Xb3JkKSttYXRjaFJlZykpICE9PSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZihtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAxOyBpIDwgZW50aXR5UGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCtpID49IHNyY1RleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXh0Q2xlYW5Xb3JkID0gc3JjVGV4dFtpbmRleCtpXS5yZXBsYWNlKGNsZWFuUmVnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobmV4dENsZWFuV29yZC5pbmRleE9mKCdzcGFuJW1hcmtlZCUnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gbWF0Y2ggJiYgZW50aXR5UGFydHNbaV0ubWF0Y2gobmV3IFJlZ0V4cChtYXRjaFJlZ1N0YXJ0K2VzY2FwZVJlZ0V4cChuZXh0Q2xlYW5Xb3JkKSttYXRjaFJlZykpICE9PSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBjb21wbGV0ZSBtYXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGZpcnN0IHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbWF0Y2ggZnJvbSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlU3RhcnRJbmRleCA9IGZpbmRTb3VyY2VJbmRleCh3b3JkLCBjbGVhbldvcmQsIGZpcnN0V29yZCwgaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBlbmQgcGFydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmRJbmRleCA9IGluZGV4K2VudGl0eVBhcnRzLmxlbmd0aC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVuZEluZGV4ID49IHNyY1RleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFdvcmQgPSBzcmNUZXh0W2VuZEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5kQ2xlYW5Xb3JkID0gZW5kV29yZC5yZXBsYWNlKC9bXlxcd10vLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRvIGdldCBwbGFpbiBtYXRjaCBmcm9tIG9yaWdpbmFsIHNvdXJjZSBmb3Igc3RhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kSW5kZXggPSBmaW5kU291cmNlSW5kZXgoZW5kV29yZCwgZW5kQ2xlYW5Xb3JkLCBsYXN0V29yZCwgZW5kSW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd29yZCB3YXMgZm91bmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2VTdGFydEluZGV4ICE9PSAtMSAmJiBzb3VyY2VFbmRJbmRleCAhPT0gLTEgJiYgTWF0aC5hYnMoc291cmNlU3RhcnRJbmRleCAtIHNvdXJjZUVuZEluZGV4KSA8IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5yaWNoIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlU3RhcnRJbmRleF0gPSBzcmNbc291cmNlU3RhcnRJbmRleF0ucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKGZpcnN0V29yZCkrJyQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiVtYXJrZWQlIGNsYXNzPVwibGFiZWwgbGFiZWwtd2FybmluZyBoYXNUb29sdGlwXCIgZGF0YS10b2dnbGU9XCJ0b29sdGlwXCIgdGl0bGU9XCInICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS50eXBlcy5qb2luKCcgJykgKyAnXCI+JyArIGZpcnN0V29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVucmljaCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjW3NvdXJjZUVuZEluZGV4XSA9IHNyY1tzb3VyY2VFbmRJbmRleF0ucmVwbGFjZShsYXN0V29yZCwgbGFzdFdvcmQgKyAnPC9zcGFuJW1hcmtlZCU+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGdldCBlbnRpdHkgZGF0YVxuICAgICAgICAgICAgdmFyIGluZCA9IGVudGl0eU5hbWVzLmluZGV4T2YoZW50aXR5Lm5hbWUpO1xuICAgICAgICAgICAgdmFyIG5ld0VudGl0eTtcbiAgICAgICAgICAgIGlmKGluZCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBuZXdFbnRpdHkgPSBlbnRpdGllc1tpbmRdO1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2luZF0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICBpZihlbnRpdGllc1tpbmRdLmFydGljbGVzLmluZGV4T2YoYXJ0aWNsZS5pZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGVudGl0aWVzW2luZF0uYXJ0aWNsZXMucHVzaChhcnRpY2xlLmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoYXJ0aWNsZS5lbnRpdGllcy5pbmRleE9mKG5ld0VudGl0eS5pZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGFydGljbGUuZW50aXRpZXMucHVzaChuZXdFbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3RW50aXR5ID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogZW50aXR5Ll9pZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZW50aXR5Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbnRpdHknLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZXM6IFthcnRpY2xlLmlkXSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhcnRpY2xlLmVudGl0aWVzLnB1c2gobmV3RW50aXR5LmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2V0IHR5cGVzXG4gICAgICAgICAgICBlbnRpdHkudHlwZXMuZm9yRWFjaChmdW5jdGlvbih0eXBlKXtcbiAgICAgICAgICAgICAgICAvLyBnZXQgdHlwZSBkYXRhXG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0eXBlLnNwbGl0KCc6JylbMV07XG4gICAgICAgICAgICAgICAgdmFyIHRpZCA9ICd0eXBlXycrbmFtZTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kID0gdHlwZU5hbWVzLmluZGV4T2YobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYoaW5kICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0eXBlc1tpbmRdLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzW2luZF0uZW50aXRpZXMucHVzaChuZXdFbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgICAgICB0eXBlc1tpbmRdLmFydGljbGVzLnB1c2goYXJ0aWNsZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKG5ld0VudGl0eS50eXBlcy5pbmRleE9mKHRpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdFbnRpdHkudHlwZXMucHVzaCh0aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKGFydGljbGUudHlwZXMuaW5kZXhPZih0aWQpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZS50eXBlcy5wdXNoKHRpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0eXBlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3R5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdGllczogW25ld0VudGl0eS5pZF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlczogW2FydGljbGUuaWRdLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYobmV3RW50aXR5LnR5cGVzLmluZGV4T2YodGlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VudGl0eS50eXBlcy5wdXNoKCd0eXBlXycrbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoYXJ0aWNsZS50eXBlcy5pbmRleE9mKHRpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlLnR5cGVzLnB1c2goJ3R5cGVfJytuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYoaW5kID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGVudGl0aWVzLnB1c2gobmV3RW50aXR5KTtcbiAgICAgICAgICAgICAgICBlbnRpdHlOYW1lcy5wdXNoKG5ld0VudGl0eS5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gam9pbiBzb3VyY2UgYmFja1xuICAgICAgICBpdGVtLnNvdXJjZSA9IHNyYy5qb2luKCcgJykucmVwbGFjZSgvc3BhbiVtYXJrZWQlL2csICdzcGFuJyk7XG4gICAgICAgIGFydGljbGUuc291cmNlID0gaXRlbS5zb3VyY2U7XG5cbiAgICAgICAgLy8gcHVzaCB0byBhcnJheVxuICAgICAgICBhcnRpY2xlcy5wdXNoKGFydGljbGUpO1xuICAgIH0pO1xuXG4gICAgLy8gc29ydCBhcnJheXMgYnkgY291bnRcbiAgICB2YXIgc29ydEZ1bmN0aW9uID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICByZXR1cm4gYi5jb3VudCAtIGEuY291bnQ7XG4gICAgfTtcbiAgICBlbnRpdGllcyA9IGVudGl0aWVzLnNvcnQoc29ydEZ1bmN0aW9uKTtcbiAgICB0eXBlcyA9IHR5cGVzLnNvcnQoc29ydEZ1bmN0aW9uKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGFydGljbGVzOiBhcnRpY2xlcyxcbiAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICBlbnRpdGllczogZW50aXRpZXNcbiAgICB9O1xufTtcblxuLy8gZXhwb3NlXG5leHBvcnRzLnByb2Nlc3NEYXRhID0gcHJvY2Vzc0RhdGE7XG4iLCIvLyBnZXQgZXh0ZW50aW9uc1xudmFyIGV4dGVudGlvbnMgPSByZXF1aXJlKCcuLi9kYXRhL2NvcnB1c2V4dGVudGlvbnMnKTtcblxuLy8gaW5pdCBtb2R1bGVcbnZhciBjb3JwdXNNb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnQ29ycHVzTW9kdWxlJywgWyd1aS5yb3V0ZXInXSk7XG5cbi8vIGNvbmZpZyByb3V0ZXNcbmNvcnB1c01vZHVsZS5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAvLyBtYWluIHZpZXdcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29ycHVzJywge1xuICAgICAgICB1cmw6ICcvY29ycHVzLzppZCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL2NvcnB1cy9tYWluJyksXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3RlbXBsYXRlcy9jb3JwdXNWaWV3Lmh0bWwnLFxuICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICBjb3JwdXM6IFsnJGh0dHAnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oJGh0dHAsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cCh7bWV0aG9kOiAnR0VUJywgdXJsOiAnL2FwaS9jb3JwdXMvJyArICRzdGF0ZVBhcmFtcy5pZH0pO1xuICAgICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gbWFrZSB2aWV3IHJvdXRlcyBmb3IgZXh0ZW50aW9uc1xuICAgIGV4dGVudGlvbnMuZm9yRWFjaChmdW5jdGlvbihleCkge1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29ycHVzLicgKyBleC5uYW1lLCB7XG4gICAgICAgICAgICB1cmw6IGV4LnBhdGgsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZXgudGVtcGxhdGUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBleC5jb250cm9sbGVyLFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vLyByZWdpc3RlciBjb250cm9sbGVyc1xuZXh0ZW50aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGV4KSB7XG4gICAgY29ycHVzTW9kdWxlLmNvbnRyb2xsZXIoZXguY29udHJvbGxlciwgWyckc2NvcGUnLCAnJHN0YXRlJywgJyRzY2UnLCBleC5qc10pO1xufSk7XG5cbi8vIGV4cG9ydFxubW9kdWxlLmV4cG9ydHMgPSBjb3JwdXNNb2R1bGU7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFwcGx5Um91dGVzIChhcHApIHtcbiAgICBhcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHsgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJywgdGVtcGxhdGU6ICcnIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvYXV0aCcsIHsgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsIHRlbXBsYXRlOiAnJyB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3JlZ2lzdGVyJywgeyBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJywgdGVtcGxhdGU6ICcnIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvY3JlYXRlQ29ycHVzJywgeyBjb250cm9sbGVyOiAnQ3JlYXRlQ29ycHVzQ29udHJvbGxlcicsIHRlbXBsYXRlVXJsOiAnL3RlbXBsYXRlcy9jcmVhdGVDb3JwdXMuaHRtbCcgfSk7XG5cbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuICAgIH1dKTtcbn07IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseVNlcnZpY2VzIChhcHApIHtcbn07XG4iXX0=
