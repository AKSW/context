(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function applyControllers (app) {
    app.controller('HomeController', ['$scope', require('./controllers/home.js')]);
    app.controller('RegisterController', ['$scope', require('./controllers/register.js')]);
    app.controller('ProfileController', ['$scope', require('./controllers/profile.js')]);
    app.controller('CreateCorpusController', ['$scope', require('./controllers/createcorpus.js')]);
};
},{"./controllers/createcorpus.js":7,"./controllers/home.js":8,"./controllers/profile.js":9,"./controllers/register.js":10}],2:[function(require,module,exports){
// includes
var CoocProcesser = require('../../modules/CoocProcesser');
var d3 = window.d3 || null;

var matrix_mouseover = function (p) {
    var g = d3.select(this).node();
    $('#'+g.id).css('cursor','pointer');
    d3.selectAll('.row text').classed('active', function(d, i) { return i === p.y; });
    d3.selectAll('.column text').classed('active', function(d, i) { return i === p.x; });
};

var matrix_mouseout = function () {
    d3.selectAll('text').classed('active', false);
};

var matrix_order = function (svg,orders,x,value) {
    x.domain(orders[value]);

    var t = svg.transition().duration(1500);
    t.selectAll('.row')
        .delay(function(d, i) { return x(i) * 4; })
        .attr('transform', function(d, i) { return 'translate(0,' + x(i) + ')'; })
        .selectAll('.cell')
        .delay(function(d) { return x(d.x) * 4; })
        .attr('x', function(d) { return x(d.x); });

    t.selectAll('.column')
        .delay(function(d, i) { return x(i) * 4; })
        .attr('transform', function(d, i) { return 'translate(' + x(i) + ')rotate(-90)'; });
};

 //renders the d3 graph
var createCoocMatrix = function (miserables, container) {
    var margin = {top: 80, right: 0, bottom: 10, left: 80};
    var width = 1000;
    var height = 1000;

    var x = d3.scale.ordinal().rangeBands([0, width]);
    var z = d3.scale.linear().domain([0, 4]).clamp(true);
    var c = d3.scale.category20().domain(d3.range(20));

    var svg = d3.select(container).append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .style('margin-left', -margin.left + 'px')
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    var matrix = [];
    var nodes = miserables.nodes;
    var n = nodes.length;

    // Compute index per node.
    nodes.forEach(function(node, i) {
        node.index = i;
        node.count = 0;
        matrix[i] = d3.range(n).map(function(j) { return {x: j, y: i, z: 0}; });
    });

    // Convert links to matrix; count character occurrences.
    miserables.links.forEach(function(link) {
        matrix[link.source][link.target].z += link.value;
        matrix[link.target][link.source].z += link.value;
        matrix[link.source][link.source].z += link.value;
        matrix[link.target][link.target].z += link.value;
        nodes[link.source].count += link.value;
        nodes[link.target].count += link.value;
    });
    // Precompute the orders.
    var orders = {
        name: d3.range(n).sort(function(a, b) { return d3.ascending(nodes[a].name, nodes[b].name); }),
        count: d3.range(n).sort(function(a, b) { return nodes[b].count - nodes[a].count; }),
        group: d3.range(n).sort(function(a, b) { return nodes[b].group - nodes[a].group; })
    };
    // The default sort order.
    x.domain(orders.name);
    svg.append('rect')
        .attr('class', 'cell-background')
        .attr('width', width)
        .attr('height', height);

    var processRow = function (row) {
        var cell = d3.select(this).selectAll('.cell')
            .data(row.filter(function(d) { return d.z; }))
            .enter().append('rect')
            .attr('class', 'cell')
            .attr('x', function(d) { return x(d.x); })
            .attr('width', x.rangeBand())
            .attr('height', x.rangeBand())
            .attr('id', function(d) { return 'rel_'+nodes[d.x].index+'_'+nodes[d.y].index; })
            .style('fill-opacity', function(d) { return z(d.z); })
            .style('fill', function(d) { return nodes[d.x].group === nodes[d.y].group ? c(nodes[d.x].group) : null; })
            .on('mouseover', matrix_mouseover)
            .on('mouseout', function(d) { matrix_mouseout(d); });
    };

    var row = svg.selectAll('.row')
        .data(matrix)
        .enter().append('g')
        .attr('class', 'row')
        .attr('transform', function(d, i) { return 'translate(0,' + x(i) + ')'; })
        .each(processRow);

    row.append('line').attr('x2', width);

    row.append('text')
        .attr('x', -6)
        .attr('y', x.rangeBand() / 2)
        .attr('dy', '.32em')
        .attr('text-anchor', 'end')
        .attr('id', function(d, i) { return 'node_'+nodes[i].index; })
        .attr('title', function(d, i) { return nodes[i].uri; })
        .text(function(d, i) { return nodes[i].name; });

    var column = svg.selectAll('.column')
        .data(matrix)
        .enter().append('g')
        .attr('class', 'column')
        .attr('transform', function(d, i) { return 'translate(' + x(i) + ')rotate(-90)'; });

    column.append('line')
        .attr('x1', -width);

    column.append('text')
        .attr('x', 6)
        .attr('y', x.rangeBand() / 2)
        .attr('dy', '.32em')
        .attr('id', function(d, i) { return 'node_'+nodes[i].index; })
        .attr('title', function(d, i) { return nodes[i].uri; })
        .attr('text-anchor', 'start')
        .text(function(d, i) { return nodes[i].name; });

    $(container).append('<div class="matrix-color-legend"><table cellpadding="5" cellspacing="3"></table></div>');
    var not_repeat=[];
    $.each(miserables.nodes,function(i,v){
        if(not_repeat.indexOf(v.group) === -1){
            not_repeat.push(v.group);
            $(container+' .matrix-color-legend table').append('<tr style="color:#FFF;background-color:'+c(v.group)+'"><td>'+miserables.groups[v.group]+'</td></tr>');
        }
    });
    $(container+' .matrix-color-legend').attr('style','position:absolute;top:300px;right:10px;overflow:hidden;');

    var timeout = setTimeout(function() {
        matrix_order(svg,orders,x,'group');
    }, 500);
};

module.exports = function CorpusCoocController($scope, $state, $sce) {
    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/cooc', function(data) {
        var processedData = CoocProcesser.processData(data);
        createCoocMatrix(processedData,'#coocContainer');
    });
};

},{"../../modules/CoocProcesser":17}],3:[function(require,module,exports){
// includes
var FacetsProcesser = require('../../modules/FacetsProcesser');

// data
var facetsData;
var types, entities, articles;

module.exports = function CorpusFacetsController($scope, $state, $sce) {
    // init empty facet filters
    $scope.typeFilter = undefined;
    $scope.entityFilter = undefined;
    $scope.articleFilter = undefined;

    $scope.setFilter = function(item) {
        switch(item.type) {
            case 'article':
                if($scope.articleFilter === item.id) {
                    $scope.articleFilter = undefined;
                } else {
                    $scope.articleFilter = item.id;
                }
                break;
            case 'entity':
                if($scope.entityFilter === item.id) {
                    $scope.entityFilter = undefined;
                } else {
                    $scope.entityFilter = item.id;
                }
                break;
            case 'type':
                if($scope.typeFilter === item.id) {
                    $scope.typeFilter = undefined;
                } else {
                    $scope.typeFilter = item.id;
                }
                break;
        }
    };

    $scope.itemActive = function(item) {
        switch(item.type) {
            case 'article':
                return $scope.articleFilter === item.id;
            case 'entity':
                return $scope.entityFilter === item.id;
            case 'type':
                return $scope.typeFilter === item.id;
        }
    };

    $scope.facetFilter = function (item) {
        var filterArticle = false;
        var filterEntity = false;
        var filterType = false;

        switch(item.type) {
            case 'article':
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterEntity && filterType;
            case 'entity':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterArticle && filterType;
            case 'type':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                return filterArticle && filterEntity;
        }
    };

    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/facets', function(data) {
        facetsData = FacetsProcesser.processData(data);

        // types
        types = facetsData.types;
        // entities
        entities = facetsData.entities;
        // articles
        articles = facetsData.articles;
        for(var i = 0; i < articles.length; i++) {
            articles[i].sourceSafe = $sce.trustAsHtml(articles[i].source);
        }
        // update data in scope
        $scope.data = [
            {name: 'Articles', values: articles},
            {name: 'Types', values: types},
            {name: 'Entities', values: entities},
        ];

        // redraw
        $state.reload();
    });
};

},{"../../modules/FacetsProcesser":18}],4:[function(require,module,exports){
// extentions
var extentions = require('../../data/corpusextentions');

// corpus object
var currentCorpus = {
    uri: function() {
        var it = this.input_type;
        if(it === 'twitter') {
            return 'http://twitter.com/' + this.input;
        } else if(it === 'direct') {
            return '-';
        } else {
            return this.input;
        }
    }
};

// progress websocket
var initProgressWebsocket = function($scope) {
    var location = document.URL.split('://')[1].replace('/overview', '');
    var socket = new WebSocket('ws://' + location);
    socket.onerror = function(err) {
        console.log(err);
    };
    socket.onopen = function () {
        $scope.$apply(function() {
            $scope.progress.show = true;
        });
    };
    socket.onmessage = function (event) {
        var data = JSON.parse(event.data);
        $scope.$apply(function() {
            $scope.progress.type = data.type;
            $scope.progress.progress = data.progress;
        });
    };
    socket.onclose = function () {
        $scope.$apply(function() {
            $scope.progress.show = false;
        });
    };
};

module.exports = function MainCorpusController($scope, $location, $state, corpus) {
    // set current corpus data
    currentCorpus = _.extend(currentCorpus, corpus.data);
    // expose corpus to scope
    $scope.currentCorpus = currentCorpus;

    // expose math
    $scope.Math = Math;
    // should show progress bar
    $scope.progress = {
        show: false,
        progress: 0,
        type: ''
    };

    // init extentions
    $scope.extentions = extentions;
    // expose state
    $scope.$state = $state;

    // render first view if needed
    $scope.$on('$viewContentLoaded', function onRender() {
        // init progress websocket if corpus is not processed yet
        if(!currentCorpus.processed) {
            initProgressWebsocket($scope);
        }

        // see if we need to change path
        var len = $location.path().split('/').length;
        // if page is just loaded
        if(len === 3) {
            // redirect to first subview
            $state.go('corpus.'+extentions[0].name);
        }
    });
};

},{"../../data/corpusextentions":12}],5:[function(require,module,exports){
module.exports = function CorpusOverviewController($scope, $state, $sce) {
    //console.log('corpus overview');
};

},{}],6:[function(require,module,exports){
// includes
var RelationsProcesser = require('../../modules/RelationsProcesser');
var d3 = window.d3 || null;

// fade for d3
var fade = function (opacity, svg) {
    return function(d, i) {
        svg.selectAll('path.chord')
            .filter(function(d) { return d.source.index !== i && d.target.index !== i; })
            .transition().style('stroke-opacity', opacity)
            .style('fill-opacity', opacity);
    };
};

//renders the d3 graph
var createRelChart = function (data, container){
    var matrix=data.relations;
    var scores=data.scores;
    var entityNames=data.entityNames;
    var entityURIs=data.entityURIs;
    //start d3
    var w = 1000,
    h = 900,
    r1 = h / 2,
    r0 = r1 - 80;
    var fill = d3.scale.category20c();

    var chord = d3.layout.chord()
        .padding(0.04)
        .sortSubgroups(d3.descending)
        .sortChords(d3.descending);

    var arc = d3.svg.arc()
        .innerRadius(r0)
        .outerRadius(r0 + 20);

    var svg = d3.select(container).append('svg:svg')
        .attr('width', w)
        .attr('height', h)
        .append('svg:g')
        .attr('transform', 'translate(' + w / 2 + ',' + h / 2 + ')');

    chord.matrix(matrix);

    var g = svg.selectAll('g.group')
        .data(chord.groups)
        .enter().append('svg:g')
        .attr('class', 'group')
        .on('mouseover', fade(0.02, svg))
        .on('mouseout', fade(0.80, svg));
    g.append('svg:path')
        .style('stroke', function(d) { return fill(d.index); })
        .style('fill', function(d) { return fill(d.index); })
        .attr('id',function(d) { return 'path_'+d.index; })
        .attr('d', arc);

    g.append('svg:text')
        .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
        .attr('dy', '.35em')
        .attr('id',function(d) { return 'label_'+d.index; })
        .attr('text-anchor', function(d) { return d.angle > Math.PI ? 'end' : null; })
        .attr('transform', function(d) {
            return 'rotate(' + (d.angle * 180 / Math.PI - 90) + ')' +
                'translate(' + (r0 + 26) + ')' +
                (d.angle > Math.PI ? 'rotate(180)' : '');
        })
        .text(function(d) { return entityNames[d.index]; });

    svg.selectAll('path.chord')
        .data(chord.chords)
        .enter().append('svg:path')
        .attr('class', 'chord')
        .style('stroke', function(d) { return d3.rgb(fill(d.source.index)).darker(); })
        .style('fill', function(d) { return fill(d.source.index); })
        .attr('d', d3.svg.chord().radius(r0));

    $.each(entityNames,function(i,v){
        $('#label_'+i).mouseover(function() {
            var position = $('#label_'+i).position();
            //console.log(v);
            $('#relations').append('<div class="d3-rel-tooltip" style="top:'+(position.top+30)+'px;left:'+position.left+'px">'+v+'</div>');
            $('#label_'+i).css('fill',d3.select('#path_'+i).style('fill'));
            $('#label_'+i).css('cursor','pointer');
        });
        $('#label_'+i).mouseout(function() {
            $('#label_'+i).css('fill','#000');
            $('#relations .d3-rel-tooltip').remove();
        });
    });
};

module.exports = function CorpusRelationsController($scope, $state, $sce) {
    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/relations', function(data) {
        var processedData = RelationsProcesser.processData(data);
        createRelChart(processedData, '#relationsContainer');
    });
};

},{"../../modules/RelationsProcesser":19}],7:[function(require,module,exports){
var corpusTypes = require('../data/corpusTypes.js');
var nlpApis = require('../data/nlpApis.js');

module.exports = function CreateCorpusController($scope) {
    // collection of corpus types
    $scope.corpusTypes = corpusTypes;
    // collection of nlp apis
    $scope.nlpApis = nlpApis;

    // current corpus
    $scope.corpusSelection = {index: 0};
    $scope.currentCorpus = $scope.corpusTypes[0];

    // input slider reference
    var $inputCount, $sliderContainer;
    // update view slider
    var updateView = function() {
        $scope.currentCorpus = $scope.corpusTypes[$scope.corpusSelection.index];
        if($scope.currentCorpus.haveItems) {
            if(!$inputCount) {
                $sliderContainer = $('#slider_container');
                $inputCount = $('#input_count');
            } else {
                $inputCount.slider('destroy');
            }
            $sliderContainer.show();
            $inputCount.slider({
                min: $scope.currentCorpus.itemsMin,
                max: $scope.currentCorpus.itemsMax,
                step: 50,
                value: $scope.currentCorpus.itemsDefault,
                tooltip: 'always'
            });
        } else {
            $sliderContainer.hide();
        }
    };

    // update view on model change
    $scope.$watch('corpusSelection', updateView, true);

    // update slider
    $scope.$on('$viewContentLoaded', updateView);

    // analysis start function
    $scope.startAnalysis = function (e) {
        // prevent event
        e.preventDefault();
        // get fields
        var $inputItem = $('#input_item');
        var $inputItemArea = $('#input_item_area');
        var $inputItemFile = $('#input_item_file');
        var $inputCountField = $('input#input_count');
        var $newCorpusForm = $('#newcorpus_form');
        var $inputType = $('input[name=input_type]:checked');

        // remove old warning
        $inputItem.parent().removeClass('has-warning');

        // validate input
        var input = null;
        var corpusType = $scope.currentCorpus.name;
        var inputType = $scope.currentCorpus.inputType;
        switch(inputType) {
            case 'text':
                input = $inputItem.val().trim();
                break;
            case 'textarea':
                input = $inputItemArea.val().trim();
                break;
            case 'file':
                input = $inputItemFile.val();
                break;
        }

        if (!input) {
            $inputItem.parent().addClass('has-warning');
            return;
        }

        // append csrf token to form url
        $newCorpusForm.attr('action', '/api/corpus?_csrf=' + encodeURIComponent($scope.csrf));

        // assign count to input field
        var itemCount = $inputCount.slider('getValue');
        $inputCountField.val(itemCount);

        // remove unneeded inputs & rename last one
        switch(inputType) {
            case 'text':
                $inputItem.attr('name', 'input');
                $inputItemArea.remove();
                $inputItemFile.remove();
                break;
            case 'textarea':
                $inputItem.remove();
                $inputItemArea.attr('name', 'input');
                $inputItemFile.remove();
                break;
            case 'file':
                $inputItem.remove();
                $inputItemArea.remove();
                $inputCountField.remove();
                $inputItemFile.attr('name', 'input');
                break;
        }

        // swap input type value
        $inputType.val(corpusType);

        // send to server
        $newCorpusForm.submit();
    };
};

},{"../data/corpusTypes.js":11,"../data/nlpApis.js":13}],8:[function(require,module,exports){
module.exports = function HomeController($scope) {
    // corpus model
    $scope.corpus = '0';
    // on corpus select event
    $scope.corpusSelect = function() {
        // do not do anything if it's dummy entry
        if($scope.corpus === '0') {
            return;
        }
        // redirect to corpus
        window.location = '/corpus/' + $scope.corpus;
    };
};

},{}],9:[function(require,module,exports){
module.exports = function ProfileController($scope) {
    //
};

},{}],10:[function(require,module,exports){
module.exports = function RegisterController($scope) {
    //
};

},{}],11:[function(require,module,exports){
// build collection of items
var collection = [];
// rss
collection.push({
    name: 'feed',
    description: 'RSS/RDF/ATOM Feed',
    inputType: 'text',
    inputDescription: 'URL of the RSS/RDF/ATOM feed',
    inputPlaceholder: 'URL of your feed',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 600,
    itemsDefault: 50,
});
// wordpress
collection.push({
    name: 'wordpress',
    description: 'WordPress Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// blogger
collection.push({
    name: 'blogger',
    description: 'Blogger Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// public twitter
collection.push({
    name: 'twitter',
    description: 'Public Twitter account',
    inputType: 'text',
    inputDescription: 'Twitter username',
    inputPlaceholder: 'Username',
    haveItems: true,
    itemsMin: 200,
    itemsMax: 1500,
    itemsDefault: 1000,
});
// slidewiki
collection.push({
    name: 'slidewiki',
    description: 'SlideWiki Deck',
    inputType: 'text',
    inputDescription: 'Deck ID',
    inputPlaceholder: 'Deck ID',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 1000,
    itemsDefault: 400,
});
// webpage
collection.push({
    name: 'webpage',
    description: 'Web page',
    inputType: 'text',
    inputDescription: 'WebPage URL',
    inputPlaceholder: 'URL',
    haveItems: false,
});
// direct input
collection.push({
    name: 'directinput',
    description: 'Direct input',
    inputType: 'textarea',
    inputDescription: 'Your text/html',
    haveItems: false,
});
// upload a doc
collection.push({
    name: 'doc',
    description: 'Upload a document(s)',
    inputType: 'file',
    inputDescription: 'Document',
    haveItems: false,
});

// Our module now returns our view
module.exports = collection;

},{}],12:[function(require,module,exports){
var collection = [];
// overview
collection.push({
    name: 'Overview',
    path: '/overview',
    controller: 'CorpusOverviewController',
    template: '/templates/corpusOverview.html',
    js: require('../controllers/corpus/overview.js'),
});
// facets
collection.push({
    name: 'Facets',
    path: '/facets',
    controller: 'CorpusFacetsController',
    template: '/templates/corpusFacets.html',
    js: require('../controllers/corpus/facets.js'),
});
// relations
collection.push({
    name: 'Entity relations',
    path: '/relations',
    controller: 'CorpusRelationsController',
    template: '/templates/corpusEntityRelations.html',
    js: require('../controllers/corpus/relations.js'),
});
// co-occurance
collection.push({
    name: 'Co-occurrence matrix',
    path: '/cooc',
    controller: 'CorpusCoocController',
    template: '/templates/corpusCooc.html',
    js: require('../controllers/corpus/cooc.js'),
});

// Our module now returns our view
module.exports = collection;
},{"../controllers/corpus/cooc.js":2,"../controllers/corpus/facets.js":3,"../controllers/corpus/overview.js":5,"../controllers/corpus/relations.js":6}],13:[function(require,module,exports){
// build collection of items
var collection = [];
// spotlight
collection.push({
    id: 'DBpedia-Spotlight',
    name: 'DBpedia Spotlight',
});
// fox
collection.push({
    id: 'FOX',
    name: 'FOX',
});
// german spotlight
collection.push({
    id: 'DBpedia-Spotlight-DE',
    name: 'DBpedia Spotlight (German)',
});

// Our module now returns our view
module.exports = collection;

},{}],14:[function(require,module,exports){
module.exports = function applyDirectives (app) {
};
},{}],15:[function(require,module,exports){
// load modules
var CorpusModule = require('./modules/corpus');

// init app
var app = angular.module('context-app', ['ngRoute', 'ngAnimate', 'mgcrea.ngStrap', 'CorpusModule']);

// config app routes
require('./routes')(app);

// config app services
require('./services')(app);

// init controllers
require('./controllers')(app);

// config app directives
require('./directives')(app);

// config app filters
require('./filters')(app);

},{"./controllers":1,"./directives":14,"./filters":16,"./modules/corpus":20,"./routes":21,"./services":22}],16:[function(require,module,exports){
module.exports = function applyFilters (app) {
};
},{}],17:[function(require,module,exports){
var diceMetric = function (x, y, xy) {
    return 2 * xy / (x + y);
};

var getCommonArticles = function(entity, entityDouble) {
    return _.intersection(entity.articles, entityDouble.articles);
};

var processData = function(corpus) {
    // entities array
    var entities = {};
    var types = [];
    // find min, max, avg of entities
    var entitiesMin, entitiesMax, entitiesAvg;
    var entitiesTotal = 0;
    // go through all articles
    corpus.articles.forEach(function(article) {
        // calculate stuff
        var count = article.entities.length;
        entitiesTotal += count;
        entitiesMin = _.min([entitiesMin, count]);
        entitiesMax = _.max([entitiesMin, count]);
        // add entities to all array
        article.entities.forEach(function(entity) {
            if(entities[entity.uri]) {
                entities[entity.uri].count++;
                entities[entity.uri].articles.push(article._id);
            } else {
                entities[entity.uri] = entity;
                entities[entity.uri].count = 1;
                entities[entity.uri].articles = [article._id];
            }
            // fill types
            entity.types.forEach(function(type) {
                if(types.indexOf(type) === -1) {
                    types.push(type);
                }
            });
        });
    });
    // count average
    entitiesAvg = Math.floor(entitiesTotal / corpus.articles.length);

    // prepare vars for final data
    var nodes = [];
    var links = [];
    var groups = [];
    var scores = [];
    var entityNames = [];
    var entityURIs = [];
    var index = 0;
    // temp arrays
    var tmp = [];

    // process
    var ekey, entity;
    for(ekey in entities) {
        entity = entities[ekey];
        // push uri
        entityURIs.push(entity.uri);
        // get type
        var type = entity.types[0];
        var typeId = types.indexOf(type);
        groups[typeId] = type;
        // push data
        if (entityNames.indexOf(entity.name) === -1) {
            entityNames.push(entity.name);
            nodes.push({name: entity.name, uri: entity.uri, group: typeId});
        } else {
            index++;
            entityNames.push(entity.name + '#' + index);
            nodes.push({name: entity.name + '#' + index, uri: entity.uri, group: typeId});
        }
    }

    // process
    for(ekey in entities) {
        entity = entities[ekey];
        // prepare row data
        var score = [];

        // go through entities again
        for(var ekey2 in entities) {
            var entityDouble = entities[ekey2];
            if (entity.uri !== entityDouble.uri) {
                var key = entity._id + '-' + entityDouble._id;
                var reverseKey = entityDouble._id + '-' + entity._id;
                if (tmp.indexOf(key) === -1 && tmp.indexOf(reverseKey) === -1) {
                    //give me the number of articles that have both  $i ['uri'] and $j ['uri'] entities
                    var common = getCommonArticles(entity, entityDouble);
                    var scoreValue = [diceMetric(entity.articles.length, entityDouble.articles.length, common.length)];
                    score.push(scoreValue);
                    links.push({
                        source: entityURIs.indexOf(entity.uri),
                        target: entityURIs.indexOf(entityDouble.uri),
                        value: common ? common.length : 0,
                        articles: common
                    });
                }
            }
        }

        // push scores
        scores.push(score);
    }

    // get threshold from middle of scores
    var sortedScores = [];
    // get scores
    scores.forEach(function(score) {
        score.forEach(function(num) {
            if(num > 0) {
                sortedScores.push(num[0]);
                threshold += num;
            }
        });
    });
    // sort
    sortedScores = sortedScores.sort();
    // get threshold
    var center = Math.floor(sortedScores.length / 2);
    var threshold = sortedScores[center];

    //remove noises
    scores.forEach(function(row, index){
        if(score < threshold) {
            links[index].value=0;
            links[index].articles='';
        }
    });

    return {
        nodes: nodes,
        links: links,
        groups: groups
    };
};

exports.processData = processData;
},{}],18:[function(require,module,exports){
var escapeRegExp = function(str) {
    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
};

var processData = function(data) {
    // articles
    var articles = [];
    // types
    var types = [];
    var typeNames = [];
    // entities
    var entities = [];
    var entityNames = [];

    // extract data
    data.articles.forEach(function(item) {
        // get article data
        var title = '';
        try {
            var dom = $(item.source);
            title = $('extracted-title', dom).text() || dom.text();
        } catch(e) {
            title = item.source;
        }
        title = title.slice(0, 30) + '...';
        var article = {
            id: item._id,
            name: title,
            type: 'article',
            count: 0,
            entities: [],
            types: [],
            source: item.source,
        };

        // get article plain text
        var sourceText = S(item.source).stripTags().s;
        // split plain text and full source into words
        var srcText = sourceText.split(/\s/);
        var src = item.source.split(/\s/);
        // split using additional characters for better processing
        for(var i = 0; i < srcText.length; i++) {
            var it = srcText[i];
            it = it.split('/');
            srcText[i] = it;
        }
        // flatten arrays
        srcText = _.flatten(srcText);

        var findSourceIndex = function(word, cleanWord, entityName, startIndex) {
            startIndex = startIndex || -1;
            // try to get plain match from original source
            var sourceIndex = src.indexOf(word, startIndex);
            // if not found, find by string
            if(sourceIndex === -1) {
                //if(entityName === testEntity) console.log('searching index in array');
                for(var i = 0; i < src.length; i++){
                    var srcWord = src[i];
                    // clean from hrefs
                    var srcWordClean = srcWord.replace(/href="(.+?)"(.*?>?)/, '').replace(/src="(.+?)"(.*?>?)/, '').replace(/alt="(.+?)"(.*?>?)/, '');
                    // skip if containes marking parts
                    if(srcWordClean.indexOf('span%marked%') !== -1) {
                        continue;
                    }

                    // check for match
                    if(srcWordClean.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) && i >= startIndex) {
                        sourceIndex = i;
                        break;
                    }
                }
            }

            return sourceIndex;
        };

        var cleanReg = /(^[\W]+)|([\W]+$)/g;
        var matchRegStart = '';
        var matchReg = '(\\W?)';

        // get entities
        item.entities.forEach(function(entity){
            var entityParts = entity.name.split(' ');

            // if only one word
            if(entityParts.length === 1) {
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    var entityClean = entity.name.replace(cleanReg, '');

                    // cehck match
                    if(cleanWord === entity.name || word === entity.name) {
                        // get match from original source
                        var sourceIndex = findSourceIndex(word, cleanWord, entity.name);
                        // if word was found
                        if(sourceIndex !== -1) {
                            var origSrc = src[sourceIndex];
                            var link = origSrc.match(/href="(.+?)"/);
                            var img = origSrc.match(/src="(.+?)"/);
                            var alt = origSrc.match(/alt="(.+?)"/);
                            if(link) {
                                link = link[1];
                                origSrc = origSrc.replace(link, '%link%');
                            }
                            if(img) {
                                img = img[1];
                                origSrc = origSrc.replace(img, '%img%');
                            }
                            if(alt) {
                                alt = alt[1];
                                origSrc = origSrc.replace(alt, '%alt%');
                            }

                            // enrich source
                            src[sourceIndex] = origSrc.replace(
                                entity.name,
                                '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                entity.types.join(' ') + '">' + entity.name + '</span%marked%>'
                            );

                            if(link) {
                                src[sourceIndex] = src[sourceIndex].replace('%link%', link);
                            }
                            if(img) {
                                src[sourceIndex] = src[sourceIndex].replace('%img%', img);
                            }
                            if(alt) {
                                src[sourceIndex] = src[sourceIndex].replace('%alt%', alt);
                            }
                        }

                        return;
                    }
                });
            } else {
                // check match
                var firstWord = entityParts[0];
                var lastWord = entityParts[entityParts.length-1];
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    if(cleanWord.indexOf('span%marked%') !== -1) {
                        return;
                    }
                    // test match
                    var match = firstWord.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) !== null;
                    if(match) {
                        var i = 0;
                        for(i = 1; i < entityParts.length; i++) {
                            if(index+i >= srcText.length) {
                                continue;
                            }

                            var nextCleanWord = srcText[index+i].replace(cleanReg, '');
                            if(nextCleanWord.indexOf('span%marked%') !== -1) {
                                continue;
                            }
                            match = match && entityParts[i].match(new RegExp(matchRegStart+escapeRegExp(nextCleanWord)+matchReg)) !== null;
                        }

                        // check complete match
                        if(match) {
                            // Replace first part
                            // get match from original source
                            var sourceStartIndex = findSourceIndex(word, cleanWord, firstWord, index);

                            // Replace end part
                            var endIndex = index+entityParts.length-1;
                            if(endIndex >= srcText.length) {
                                return;
                            }
                            var endWord = srcText[endIndex];
                            var endCleanWord = endWord.replace(/[^\w]/, '');
                            // try to get plain match from original source for start
                            var sourceEndIndex = findSourceIndex(endWord, endCleanWord, lastWord, endIndex);

                            // if word was found
                            if(sourceStartIndex !== -1 && sourceEndIndex !== -1 && Math.abs(sourceStartIndex - sourceEndIndex) < 5) {
                                // enrich source
                                src[sourceStartIndex] = src[sourceStartIndex].replace(
                                    new RegExp(escapeRegExp(firstWord)+'$'),
                                    '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                    entity.types.join(' ') + '">' + firstWord
                                );

                                // enrich source
                                src[sourceEndIndex] = src[sourceEndIndex].replace(lastWord, lastWord + '</span%marked%>');
                            }
                        }
                        return;
                    }
                });
            }

            // get entity data
            var ind = entityNames.indexOf(entity.name);
            var newEntity;
            if(ind !== -1) {
                newEntity = entities[ind];
                entities[ind].count += 1;
                if(entities[ind].articles.indexOf(article.id) === -1) {
                    entities[ind].articles.push(article.id);
                }
                if(article.entities.indexOf(newEntity.id) === -1) {
                    article.entities.push(newEntity.id);
                }
            } else {
                newEntity = {
                    id: entity._id,
                    name: entity.name,
                    type: 'entity',
                    count: 1,
                    articles: [article.id],
                    types: []
                };
                article.entities.push(newEntity.id);
            }

            // get types
            entity.types.forEach(function(type){
                // get type data
                var name = type.split(':')[1];
                var tid = 'type_'+name;
                var ind = typeNames.indexOf(name);
                if(ind !== -1) {
                    types[ind].count += 1;
                    types[ind].entities.push(newEntity.id);
                    types[ind].articles.push(article.id);
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push(tid);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push(tid);
                    }
                } else {
                    types.push({
                        id: tid,
                        name: name,
                        type: 'type',
                        count: 1,
                        entities: [newEntity.id],
                        articles: [article.id],
                    });
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push('type_'+name);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push('type_'+name);
                    }
                    typeNames.push(name);
                }
            });

            if(ind === -1) {
                entities.push(newEntity);
                entityNames.push(newEntity.name);
            }
        });

        // join source back
        item.source = src.join(' ').replace(/span%marked%/g, 'span');
        article.source = item.source;

        // push to array
        articles.push(article);
    });

    // sort arrays by count
    var sortFunction = function(a, b) {
        return b.count - a.count;
    };
    entities = entities.sort(sortFunction);
    types = types.sort(sortFunction);

    return {
        articles: articles,
        types: types,
        entities: entities
    };
};

// expose
exports.processData = processData;

},{}],19:[function(require,module,exports){
var diceMetric = function (x, y, xy) {
    return 2 * xy / (x + y);
};

var getCommonArticles = function(entity, entityDouble) {
    var common = _.intersection(entity.articles, entityDouble.articles);
    return common ? common.length : 0;
};

var processData = function(corpus) {
    // entities array
    var entities = {};
    // find min, max, avg of entities
    var entitiesMin, entitiesMax, entitiesAvg;
    var entitiesTotal = 0;
    // go through all articles
    corpus.articles.forEach(function(article) {
        // calculate stuff
        var count = article.entities.length;
        entitiesTotal += count;
        entitiesMin = _.min([entitiesMin, count]);
        entitiesMax = _.max([entitiesMin, count]);
        // add entities to all array
        article.entities.forEach(function(entity) {
            if(entities[entity.uri]) {
                entities[entity.uri].count++;
                entities[entity.uri].articles.push(article._id);
            } else {
                entities[entity.uri] = entity;
                entities[entity.uri].count = 1;
                entities[entity.uri].articles = [article._id];
            }
        });
    });
    // count average
    entitiesAvg = Math.floor(entitiesTotal / corpus.articles.length);

    // prepare vars for final data
    var relations = [];
    var scores = [];
    var entityNames = [];
    var entityURIs = [];
    var index = 0;
    // temp arrays
    var tmp = [];
    var tmp4 = [];

    // process
    for(var ekey in entities) {
        var entity = entities[ekey];
        // prepare row data
        var row = [];
        var score = [];

        // go through entities again
        for(var ekey2 in entities) {
            var entityDouble = entities[ekey2];
            if (entity.uri === entityDouble.uri) {
                row.push(0);
                score.push(0);
            } else {
                var key = entity._id + '-' + entityDouble._id;
                var reverseKey = entityDouble._id + '-' + entity._id;
                if (tmp.indexOf(key) !== -1) {
                    row.push(tmp[key]);
                    score.push(tmp4[key]);
                } else if (tmp.indexOf(reverseKey) !== -1) {
                    row.push(tmp[reverseKey]);
                    score.push(tmp4[reverseKey]);
                } else {
                    //give me the number of articles that have both  $i ['uri'] and $j ['uri'] entities
                    var commonCount = getCommonArticles(entity, entityDouble);
                    tmp[key] = commonCount;
                    row.push(tmp[key]);
                    tmp4[key] = [diceMetric(entity.articles.length, entityDouble.articles.length, commonCount)];
                    score.push(tmp4[key]);
                }
            }
        }

        // push data if needed
        // push name
        if (entityNames.indexOf(entity.name) === -1) {
            entityNames.push(entity.name);
        } else {
            index++;
            entityNames.push(entity.name + '#' + index);
        }
        // push uri
        entityURIs.push(entity.uri);
        // relations
        relations.push(row);
        // scores
        scores.push(score);
    }

    // get threshold from middle of scores
    var sortedScores = [];
    // get scores
    scores.forEach(function(score) {
        score.forEach(function(num) {
            if(num > 0) {
                sortedScores.push(num[0]);
                threshold += num;
            }
        });
    });
    // sort
    sortedScores = sortedScores.sort();
    // get threshold
    var center = Math.floor(sortedScores.length / 2);
    var threshold = sortedScores[center];

    //remove noises
    scores.forEach(function(row, index){
        row.forEach(function(score, subindex){
            if(score < threshold) {
                relations[index][subindex] = 0;
            }
        });
    });

    return {
        relations: relations,
        scores: scores,
        entityNames: entityNames,
        entityURIs: entityURIs
    };
};

exports.processData = processData;
},{}],20:[function(require,module,exports){
// get extentions
var extentions = require('../data/corpusextentions');

// init module
var corpusModule = angular.module('CorpusModule', ['ui.router']);

// config routes
corpusModule.config(function ($stateProvider, $urlRouterProvider) {
    // main view
    $stateProvider.state('corpus', {
        url: '/corpus/:id',
        controller: require('../controllers/corpus/main'),
        templateUrl: '/templates/corpusView.html',
        resolve: {
            corpus: ['$http', '$stateParams', function($http, $stateParams) {
                return $http({method: 'GET', url: '/api/corpus/' + $stateParams.id});
            }]
        }
    });

    // make view routes for extentions
    extentions.forEach(function(ex) {
        $stateProvider.state('corpus.' + ex.name, {
            url: ex.path,
            templateUrl: ex.template,
            controller: ex.controller,
        });
    });
});

// register controllers
extentions.forEach(function(ex) {
    corpusModule.controller(ex.controller, ['$scope', '$state', '$sce', ex.js]);
});

// export
module.exports = corpusModule;

},{"../controllers/corpus/main":4,"../data/corpusextentions":12}],21:[function(require,module,exports){
module.exports = function applyRoutes (app) {
    app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
        $routeProvider.when('/', { controller: 'HomeController', template: '' });
        $routeProvider.when('/auth', { controller: 'LoginController', template: '' });
        $routeProvider.when('/register', { controller: 'RegisterController', template: '' });
        $routeProvider.when('/createCorpus', { controller: 'CreateCorpusController', templateUrl: '/templates/createCorpus.html' });

        $locationProvider.html5Mode(true);
    }]);
};
},{}],22:[function(require,module,exports){
module.exports = function applyServices (app) {
};

},{}]},{},[15])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY29ycHVzL2Nvb2MuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvZmFjZXRzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY29ycHVzL21haW4uanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvb3ZlcnZpZXcuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvcmVsYXRpb25zLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY3JlYXRlY29ycHVzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvaG9tZS5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL3Byb2ZpbGUuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9yZWdpc3Rlci5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2RhdGEvY29ycHVzVHlwZXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kYXRhL2NvcnB1c2V4dGVudGlvbnMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kYXRhL25scEFwaXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kaXJlY3RpdmVzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvZmFrZV9lNzQ2ZTMwNC5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2ZpbHRlcnMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9tb2R1bGVzL0Nvb2NQcm9jZXNzZXIuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9tb2R1bGVzL0ZhY2V0c1Byb2Nlc3Nlci5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL21vZHVsZXMvUmVsYXRpb25zUHJvY2Vzc2VyLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvbW9kdWxlcy9jb3JwdXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9yb3V0ZXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7O0FDSEE7QUFDQTtBQUNBO0FBQ0E7O0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5UkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFwcGx5Q29udHJvbGxlcnMgKGFwcCkge1xuICAgIGFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIFsnJHNjb3BlJywgcmVxdWlyZSgnLi9jb250cm9sbGVycy9ob21lLmpzJyldKTtcbiAgICBhcHAuY29udHJvbGxlcignUmVnaXN0ZXJDb250cm9sbGVyJywgWyckc2NvcGUnLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL3JlZ2lzdGVyLmpzJyldKTtcbiAgICBhcHAuY29udHJvbGxlcignUHJvZmlsZUNvbnRyb2xsZXInLCBbJyRzY29wZScsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvcHJvZmlsZS5qcycpXSk7XG4gICAgYXBwLmNvbnRyb2xsZXIoJ0NyZWF0ZUNvcnB1c0NvbnRyb2xsZXInLCBbJyRzY29wZScsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvY3JlYXRlY29ycHVzLmpzJyldKTtcbn07IiwiLy8gaW5jbHVkZXNcbnZhciBDb29jUHJvY2Vzc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9Db29jUHJvY2Vzc2VyJyk7XG52YXIgZDMgPSB3aW5kb3cuZDMgfHwgbnVsbDtcblxudmFyIG1hdHJpeF9tb3VzZW92ZXIgPSBmdW5jdGlvbiAocCkge1xuICAgIHZhciBnID0gZDMuc2VsZWN0KHRoaXMpLm5vZGUoKTtcbiAgICAkKCcjJytnLmlkKS5jc3MoJ2N1cnNvcicsJ3BvaW50ZXInKTtcbiAgICBkMy5zZWxlY3RBbGwoJy5yb3cgdGV4dCcpLmNsYXNzZWQoJ2FjdGl2ZScsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIGkgPT09IHAueTsgfSk7XG4gICAgZDMuc2VsZWN0QWxsKCcuY29sdW1uIHRleHQnKS5jbGFzc2VkKCdhY3RpdmUnLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBpID09PSBwLng7IH0pO1xufTtcblxudmFyIG1hdHJpeF9tb3VzZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICBkMy5zZWxlY3RBbGwoJ3RleHQnKS5jbGFzc2VkKCdhY3RpdmUnLCBmYWxzZSk7XG59O1xuXG52YXIgbWF0cml4X29yZGVyID0gZnVuY3Rpb24gKHN2ZyxvcmRlcnMseCx2YWx1ZSkge1xuICAgIHguZG9tYWluKG9yZGVyc1t2YWx1ZV0pO1xuXG4gICAgdmFyIHQgPSBzdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKDE1MDApO1xuICAgIHQuc2VsZWN0QWxsKCcucm93JylcbiAgICAgICAgLmRlbGF5KGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIHgoaSkgKiA0OyB9KVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgwLCcgKyB4KGkpICsgJyknOyB9KVxuICAgICAgICAuc2VsZWN0QWxsKCcuY2VsbCcpXG4gICAgICAgIC5kZWxheShmdW5jdGlvbihkKSB7IHJldHVybiB4KGQueCkgKiA0OyB9KVxuICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgoZC54KTsgfSk7XG5cbiAgICB0LnNlbGVjdEFsbCgnLmNvbHVtbicpXG4gICAgICAgIC5kZWxheShmdW5jdGlvbihkLCBpKSB7IHJldHVybiB4KGkpICogNDsgfSlcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuICd0cmFuc2xhdGUoJyArIHgoaSkgKyAnKXJvdGF0ZSgtOTApJzsgfSk7XG59O1xuXG4gLy9yZW5kZXJzIHRoZSBkMyBncmFwaFxudmFyIGNyZWF0ZUNvb2NNYXRyaXggPSBmdW5jdGlvbiAobWlzZXJhYmxlcywgY29udGFpbmVyKSB7XG4gICAgdmFyIG1hcmdpbiA9IHt0b3A6IDgwLCByaWdodDogMCwgYm90dG9tOiAxMCwgbGVmdDogODB9O1xuICAgIHZhciB3aWR0aCA9IDEwMDA7XG4gICAgdmFyIGhlaWdodCA9IDEwMDA7XG5cbiAgICB2YXIgeCA9IGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZUJhbmRzKFswLCB3aWR0aF0pO1xuICAgIHZhciB6ID0gZDMuc2NhbGUubGluZWFyKCkuZG9tYWluKFswLCA0XSkuY2xhbXAodHJ1ZSk7XG4gICAgdmFyIGMgPSBkMy5zY2FsZS5jYXRlZ29yeTIwKCkuZG9tYWluKGQzLnJhbmdlKDIwKSk7XG5cbiAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGNvbnRhaW5lcikuYXBwZW5kKCdzdmcnKVxuICAgICAgICAuYXR0cignd2lkdGgnLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgICAgIC5zdHlsZSgnbWFyZ2luLWxlZnQnLCAtbWFyZ2luLmxlZnQgKyAncHgnKVxuICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIG1hcmdpbi5sZWZ0ICsgJywnICsgbWFyZ2luLnRvcCArICcpJyk7XG5cbiAgICB2YXIgbWF0cml4ID0gW107XG4gICAgdmFyIG5vZGVzID0gbWlzZXJhYmxlcy5ub2RlcztcbiAgICB2YXIgbiA9IG5vZGVzLmxlbmd0aDtcblxuICAgIC8vIENvbXB1dGUgaW5kZXggcGVyIG5vZGUuXG4gICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpKSB7XG4gICAgICAgIG5vZGUuaW5kZXggPSBpO1xuICAgICAgICBub2RlLmNvdW50ID0gMDtcbiAgICAgICAgbWF0cml4W2ldID0gZDMucmFuZ2UobikubWFwKGZ1bmN0aW9uKGopIHsgcmV0dXJuIHt4OiBqLCB5OiBpLCB6OiAwfTsgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBDb252ZXJ0IGxpbmtzIHRvIG1hdHJpeDsgY291bnQgY2hhcmFjdGVyIG9jY3VycmVuY2VzLlxuICAgIG1pc2VyYWJsZXMubGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7XG4gICAgICAgIG1hdHJpeFtsaW5rLnNvdXJjZV1bbGluay50YXJnZXRdLnogKz0gbGluay52YWx1ZTtcbiAgICAgICAgbWF0cml4W2xpbmsudGFyZ2V0XVtsaW5rLnNvdXJjZV0ueiArPSBsaW5rLnZhbHVlO1xuICAgICAgICBtYXRyaXhbbGluay5zb3VyY2VdW2xpbmsuc291cmNlXS56ICs9IGxpbmsudmFsdWU7XG4gICAgICAgIG1hdHJpeFtsaW5rLnRhcmdldF1bbGluay50YXJnZXRdLnogKz0gbGluay52YWx1ZTtcbiAgICAgICAgbm9kZXNbbGluay5zb3VyY2VdLmNvdW50ICs9IGxpbmsudmFsdWU7XG4gICAgICAgIG5vZGVzW2xpbmsudGFyZ2V0XS5jb3VudCArPSBsaW5rLnZhbHVlO1xuICAgIH0pO1xuICAgIC8vIFByZWNvbXB1dGUgdGhlIG9yZGVycy5cbiAgICB2YXIgb3JkZXJzID0ge1xuICAgICAgICBuYW1lOiBkMy5yYW5nZShuKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGQzLmFzY2VuZGluZyhub2Rlc1thXS5uYW1lLCBub2Rlc1tiXS5uYW1lKTsgfSksXG4gICAgICAgIGNvdW50OiBkMy5yYW5nZShuKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIG5vZGVzW2JdLmNvdW50IC0gbm9kZXNbYV0uY291bnQ7IH0pLFxuICAgICAgICBncm91cDogZDMucmFuZ2Uobikuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBub2Rlc1tiXS5ncm91cCAtIG5vZGVzW2FdLmdyb3VwOyB9KVxuICAgIH07XG4gICAgLy8gVGhlIGRlZmF1bHQgc29ydCBvcmRlci5cbiAgICB4LmRvbWFpbihvcmRlcnMubmFtZSk7XG4gICAgc3ZnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWJhY2tncm91bmQnKVxuICAgICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodCk7XG5cbiAgICB2YXIgcHJvY2Vzc1JvdyA9IGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgdmFyIGNlbGwgPSBkMy5zZWxlY3QodGhpcykuc2VsZWN0QWxsKCcuY2VsbCcpXG4gICAgICAgICAgICAuZGF0YShyb3cuZmlsdGVyKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuejsgfSkpXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwnKVxuICAgICAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbihkKSB7IHJldHVybiB4KGQueCk7IH0pXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCB4LnJhbmdlQmFuZCgpKVxuICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIHgucmFuZ2VCYW5kKCkpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbihkKSB7IHJldHVybiAncmVsXycrbm9kZXNbZC54XS5pbmRleCsnXycrbm9kZXNbZC55XS5pbmRleDsgfSlcbiAgICAgICAgICAgIC5zdHlsZSgnZmlsbC1vcGFjaXR5JywgZnVuY3Rpb24oZCkgeyByZXR1cm4geihkLnopOyB9KVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gbm9kZXNbZC54XS5ncm91cCA9PT0gbm9kZXNbZC55XS5ncm91cCA/IGMobm9kZXNbZC54XS5ncm91cCkgOiBudWxsOyB9KVxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBtYXRyaXhfbW91c2VvdmVyKVxuICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKGQpIHsgbWF0cml4X21vdXNlb3V0KGQpOyB9KTtcbiAgICB9O1xuXG4gICAgdmFyIHJvdyA9IHN2Zy5zZWxlY3RBbGwoJy5yb3cnKVxuICAgICAgICAuZGF0YShtYXRyaXgpXG4gICAgICAgIC5lbnRlcigpLmFwcGVuZCgnZycpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdyb3cnKVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgwLCcgKyB4KGkpICsgJyknOyB9KVxuICAgICAgICAuZWFjaChwcm9jZXNzUm93KTtcblxuICAgIHJvdy5hcHBlbmQoJ2xpbmUnKS5hdHRyKCd4MicsIHdpZHRoKTtcblxuICAgIHJvdy5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cigneCcsIC02KVxuICAgICAgICAuYXR0cigneScsIHgucmFuZ2VCYW5kKCkgLyAyKVxuICAgICAgICAuYXR0cignZHknLCAnLjMyZW0nKVxuICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnZW5kJylcbiAgICAgICAgLmF0dHIoJ2lkJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ25vZGVfJytub2Rlc1tpXS5pbmRleDsgfSlcbiAgICAgICAgLmF0dHIoJ3RpdGxlJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gbm9kZXNbaV0udXJpOyB9KVxuICAgICAgICAudGV4dChmdW5jdGlvbihkLCBpKSB7IHJldHVybiBub2Rlc1tpXS5uYW1lOyB9KTtcblxuICAgIHZhciBjb2x1bW4gPSBzdmcuc2VsZWN0QWxsKCcuY29sdW1uJylcbiAgICAgICAgLmRhdGEobWF0cml4KVxuICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2cnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAnY29sdW1uJylcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuICd0cmFuc2xhdGUoJyArIHgoaSkgKyAnKXJvdGF0ZSgtOTApJzsgfSk7XG5cbiAgICBjb2x1bW4uYXBwZW5kKCdsaW5lJylcbiAgICAgICAgLmF0dHIoJ3gxJywgLXdpZHRoKTtcblxuICAgIGNvbHVtbi5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAuYXR0cigneCcsIDYpXG4gICAgICAgIC5hdHRyKCd5JywgeC5yYW5nZUJhbmQoKSAvIDIpXG4gICAgICAgIC5hdHRyKCdkeScsICcuMzJlbScpXG4gICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuICdub2RlXycrbm9kZXNbaV0uaW5kZXg7IH0pXG4gICAgICAgIC5hdHRyKCd0aXRsZScsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIG5vZGVzW2ldLnVyaTsgfSlcbiAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ3N0YXJ0JylcbiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gbm9kZXNbaV0ubmFtZTsgfSk7XG5cbiAgICAkKGNvbnRhaW5lcikuYXBwZW5kKCc8ZGl2IGNsYXNzPVwibWF0cml4LWNvbG9yLWxlZ2VuZFwiPjx0YWJsZSBjZWxscGFkZGluZz1cIjVcIiBjZWxsc3BhY2luZz1cIjNcIj48L3RhYmxlPjwvZGl2PicpO1xuICAgIHZhciBub3RfcmVwZWF0PVtdO1xuICAgICQuZWFjaChtaXNlcmFibGVzLm5vZGVzLGZ1bmN0aW9uKGksdil7XG4gICAgICAgIGlmKG5vdF9yZXBlYXQuaW5kZXhPZih2Lmdyb3VwKSA9PT0gLTEpe1xuICAgICAgICAgICAgbm90X3JlcGVhdC5wdXNoKHYuZ3JvdXApO1xuICAgICAgICAgICAgJChjb250YWluZXIrJyAubWF0cml4LWNvbG9yLWxlZ2VuZCB0YWJsZScpLmFwcGVuZCgnPHRyIHN0eWxlPVwiY29sb3I6I0ZGRjtiYWNrZ3JvdW5kLWNvbG9yOicrYyh2Lmdyb3VwKSsnXCI+PHRkPicrbWlzZXJhYmxlcy5ncm91cHNbdi5ncm91cF0rJzwvdGQ+PC90cj4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICQoY29udGFpbmVyKycgLm1hdHJpeC1jb2xvci1sZWdlbmQnKS5hdHRyKCdzdHlsZScsJ3Bvc2l0aW9uOmFic29sdXRlO3RvcDozMDBweDtyaWdodDoxMHB4O292ZXJmbG93OmhpZGRlbjsnKTtcblxuICAgIHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgbWF0cml4X29yZGVyKHN2ZyxvcmRlcnMseCwnZ3JvdXAnKTtcbiAgICB9LCA1MDApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBDb3JwdXNDb29jQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHNjZSkge1xuICAgIC8vIGdldCBkYXRhXG4gICAgJC5nZXRKU09OKCcvYXBpL2NvcnB1cy8nICsgJHNjb3BlLmN1cnJlbnRDb3JwdXMuX2lkICsgJy9jb29jJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgcHJvY2Vzc2VkRGF0YSA9IENvb2NQcm9jZXNzZXIucHJvY2Vzc0RhdGEoZGF0YSk7XG4gICAgICAgIGNyZWF0ZUNvb2NNYXRyaXgocHJvY2Vzc2VkRGF0YSwnI2Nvb2NDb250YWluZXInKTtcbiAgICB9KTtcbn07XG4iLCIvLyBpbmNsdWRlc1xudmFyIEZhY2V0c1Byb2Nlc3NlciA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvRmFjZXRzUHJvY2Vzc2VyJyk7XG5cbi8vIGRhdGFcbnZhciBmYWNldHNEYXRhO1xudmFyIHR5cGVzLCBlbnRpdGllcywgYXJ0aWNsZXM7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gQ29ycHVzRmFjZXRzQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHNjZSkge1xuICAgIC8vIGluaXQgZW1wdHkgZmFjZXQgZmlsdGVyc1xuICAgICRzY29wZS50eXBlRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICRzY29wZS5lbnRpdHlGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgJHNjb3BlLmFydGljbGVGaWx0ZXIgPSB1bmRlZmluZWQ7XG5cbiAgICAkc2NvcGUuc2V0RmlsdGVyID0gZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBzd2l0Y2goaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuYXJ0aWNsZUZpbHRlciA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXJ0aWNsZUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYXJ0aWNsZUZpbHRlciA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZW50aXR5JzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuZW50aXR5RmlsdGVyID09PSBpdGVtLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lbnRpdHlGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVudGl0eUZpbHRlciA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndHlwZSc6XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGVGaWx0ZXIgPT09IGl0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnR5cGVGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnR5cGVGaWx0ZXIgPSBpdGVtLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaXRlbUFjdGl2ZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgc3dpdGNoKGl0ZW0udHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnYXJ0aWNsZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5hcnRpY2xlRmlsdGVyID09PSBpdGVtLmlkO1xuICAgICAgICAgICAgY2FzZSAnZW50aXR5JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmVudGl0eUZpbHRlciA9PT0gaXRlbS5pZDtcbiAgICAgICAgICAgIGNhc2UgJ3R5cGUnOlxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudHlwZUZpbHRlciA9PT0gaXRlbS5pZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuZmFjZXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICB2YXIgZmlsdGVyQXJ0aWNsZSA9IGZhbHNlO1xuICAgICAgICB2YXIgZmlsdGVyRW50aXR5ID0gZmFsc2U7XG4gICAgICAgIHZhciBmaWx0ZXJUeXBlID0gZmFsc2U7XG5cbiAgICAgICAgc3dpdGNoKGl0ZW0udHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnYXJ0aWNsZSc6XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmVudGl0eUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckVudGl0eSA9IGl0ZW0uZW50aXRpZXMuaW5kZXhPZigkc2NvcGUuZW50aXR5RmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyRW50aXR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGVGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlID0gaXRlbS50eXBlcy5pbmRleE9mKCRzY29wZS50eXBlRmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJFbnRpdHkgJiYgZmlsdGVyVHlwZTtcbiAgICAgICAgICAgIGNhc2UgJ2VudGl0eSc6XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmFydGljbGVGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gaXRlbS5hcnRpY2xlcy5pbmRleE9mKCRzY29wZS5hcnRpY2xlRmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJ0aWNsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS50eXBlRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZSA9IGl0ZW0udHlwZXMuaW5kZXhPZigkc2NvcGUudHlwZUZpbHRlcikgIT09IC0xO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyQXJ0aWNsZSAmJiBmaWx0ZXJUeXBlO1xuICAgICAgICAgICAgY2FzZSAndHlwZSc6XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmFydGljbGVGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gaXRlbS5hcnRpY2xlcy5pbmRleE9mKCRzY29wZS5hcnRpY2xlRmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJ0aWNsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5lbnRpdHlGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJFbnRpdHkgPSBpdGVtLmVudGl0aWVzLmluZGV4T2YoJHNjb3BlLmVudGl0eUZpbHRlcikgIT09IC0xO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckVudGl0eSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJBcnRpY2xlICYmIGZpbHRlckVudGl0eTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBnZXQgZGF0YVxuICAgICQuZ2V0SlNPTignL2FwaS9jb3JwdXMvJyArICRzY29wZS5jdXJyZW50Q29ycHVzLl9pZCArICcvZmFjZXRzJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBmYWNldHNEYXRhID0gRmFjZXRzUHJvY2Vzc2VyLnByb2Nlc3NEYXRhKGRhdGEpO1xuXG4gICAgICAgIC8vIHR5cGVzXG4gICAgICAgIHR5cGVzID0gZmFjZXRzRGF0YS50eXBlcztcbiAgICAgICAgLy8gZW50aXRpZXNcbiAgICAgICAgZW50aXRpZXMgPSBmYWNldHNEYXRhLmVudGl0aWVzO1xuICAgICAgICAvLyBhcnRpY2xlc1xuICAgICAgICBhcnRpY2xlcyA9IGZhY2V0c0RhdGEuYXJ0aWNsZXM7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcnRpY2xlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgYXJ0aWNsZXNbaV0uc291cmNlU2FmZSA9ICRzY2UudHJ1c3RBc0h0bWwoYXJ0aWNsZXNbaV0uc291cmNlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgZGF0YSBpbiBzY29wZVxuICAgICAgICAkc2NvcGUuZGF0YSA9IFtcbiAgICAgICAgICAgIHtuYW1lOiAnQXJ0aWNsZXMnLCB2YWx1ZXM6IGFydGljbGVzfSxcbiAgICAgICAgICAgIHtuYW1lOiAnVHlwZXMnLCB2YWx1ZXM6IHR5cGVzfSxcbiAgICAgICAgICAgIHtuYW1lOiAnRW50aXRpZXMnLCB2YWx1ZXM6IGVudGl0aWVzfSxcbiAgICAgICAgXTtcblxuICAgICAgICAvLyByZWRyYXdcbiAgICAgICAgJHN0YXRlLnJlbG9hZCgpO1xuICAgIH0pO1xufTtcbiIsIi8vIGV4dGVudGlvbnNcbnZhciBleHRlbnRpb25zID0gcmVxdWlyZSgnLi4vLi4vZGF0YS9jb3JwdXNleHRlbnRpb25zJyk7XG5cbi8vIGNvcnB1cyBvYmplY3RcbnZhciBjdXJyZW50Q29ycHVzID0ge1xuICAgIHVyaTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpdCA9IHRoaXMuaW5wdXRfdHlwZTtcbiAgICAgICAgaWYoaXQgPT09ICd0d2l0dGVyJykge1xuICAgICAgICAgICAgcmV0dXJuICdodHRwOi8vdHdpdHRlci5jb20vJyArIHRoaXMuaW5wdXQ7XG4gICAgICAgIH0gZWxzZSBpZihpdCA9PT0gJ2RpcmVjdCcpIHtcbiAgICAgICAgICAgIHJldHVybiAnLSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnB1dDtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8vIHByb2dyZXNzIHdlYnNvY2tldFxudmFyIGluaXRQcm9ncmVzc1dlYnNvY2tldCA9IGZ1bmN0aW9uKCRzY29wZSkge1xuICAgIHZhciBsb2NhdGlvbiA9IGRvY3VtZW50LlVSTC5zcGxpdCgnOi8vJylbMV0ucmVwbGFjZSgnL292ZXJ2aWV3JywgJycpO1xuICAgIHZhciBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCd3czovLycgKyBsb2NhdGlvbik7XG4gICAgc29ja2V0Lm9uZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9O1xuICAgIHNvY2tldC5vbm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3Muc2hvdyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgc29ja2V0Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3MudHlwZSA9IGRhdGEudHlwZTtcbiAgICAgICAgICAgICRzY29wZS5wcm9ncmVzcy5wcm9ncmVzcyA9IGRhdGEucHJvZ3Jlc3M7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgc29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3Muc2hvdyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBNYWluQ29ycHVzQ29udHJvbGxlcigkc2NvcGUsICRsb2NhdGlvbiwgJHN0YXRlLCBjb3JwdXMpIHtcbiAgICAvLyBzZXQgY3VycmVudCBjb3JwdXMgZGF0YVxuICAgIGN1cnJlbnRDb3JwdXMgPSBfLmV4dGVuZChjdXJyZW50Q29ycHVzLCBjb3JwdXMuZGF0YSk7XG4gICAgLy8gZXhwb3NlIGNvcnB1cyB0byBzY29wZVxuICAgICRzY29wZS5jdXJyZW50Q29ycHVzID0gY3VycmVudENvcnB1cztcblxuICAgIC8vIGV4cG9zZSBtYXRoXG4gICAgJHNjb3BlLk1hdGggPSBNYXRoO1xuICAgIC8vIHNob3VsZCBzaG93IHByb2dyZXNzIGJhclxuICAgICRzY29wZS5wcm9ncmVzcyA9IHtcbiAgICAgICAgc2hvdzogZmFsc2UsXG4gICAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgICB0eXBlOiAnJ1xuICAgIH07XG5cbiAgICAvLyBpbml0IGV4dGVudGlvbnNcbiAgICAkc2NvcGUuZXh0ZW50aW9ucyA9IGV4dGVudGlvbnM7XG4gICAgLy8gZXhwb3NlIHN0YXRlXG4gICAgJHNjb3BlLiRzdGF0ZSA9ICRzdGF0ZTtcblxuICAgIC8vIHJlbmRlciBmaXJzdCB2aWV3IGlmIG5lZWRlZFxuICAgICRzY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsIGZ1bmN0aW9uIG9uUmVuZGVyKCkge1xuICAgICAgICAvLyBpbml0IHByb2dyZXNzIHdlYnNvY2tldCBpZiBjb3JwdXMgaXMgbm90IHByb2Nlc3NlZCB5ZXRcbiAgICAgICAgaWYoIWN1cnJlbnRDb3JwdXMucHJvY2Vzc2VkKSB7XG4gICAgICAgICAgICBpbml0UHJvZ3Jlc3NXZWJzb2NrZXQoJHNjb3BlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNlZSBpZiB3ZSBuZWVkIHRvIGNoYW5nZSBwYXRoXG4gICAgICAgIHZhciBsZW4gPSAkbG9jYXRpb24ucGF0aCgpLnNwbGl0KCcvJykubGVuZ3RoO1xuICAgICAgICAvLyBpZiBwYWdlIGlzIGp1c3QgbG9hZGVkXG4gICAgICAgIGlmKGxlbiA9PT0gMykge1xuICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gZmlyc3Qgc3Vidmlld1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdjb3JwdXMuJytleHRlbnRpb25zWzBdLm5hbWUpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBDb3JwdXNPdmVydmlld0NvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzY2UpIHtcbiAgICAvL2NvbnNvbGUubG9nKCdjb3JwdXMgb3ZlcnZpZXcnKTtcbn07XG4iLCIvLyBpbmNsdWRlc1xudmFyIFJlbGF0aW9uc1Byb2Nlc3NlciA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvUmVsYXRpb25zUHJvY2Vzc2VyJyk7XG52YXIgZDMgPSB3aW5kb3cuZDMgfHwgbnVsbDtcblxuLy8gZmFkZSBmb3IgZDNcbnZhciBmYWRlID0gZnVuY3Rpb24gKG9wYWNpdHksIHN2Zykge1xuICAgIHJldHVybiBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgIHN2Zy5zZWxlY3RBbGwoJ3BhdGguY2hvcmQnKVxuICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihkKSB7IHJldHVybiBkLnNvdXJjZS5pbmRleCAhPT0gaSAmJiBkLnRhcmdldC5pbmRleCAhPT0gaTsgfSlcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKCkuc3R5bGUoJ3N0cm9rZS1vcGFjaXR5Jywgb3BhY2l0eSlcbiAgICAgICAgICAgIC5zdHlsZSgnZmlsbC1vcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgfTtcbn07XG5cbi8vcmVuZGVycyB0aGUgZDMgZ3JhcGhcbnZhciBjcmVhdGVSZWxDaGFydCA9IGZ1bmN0aW9uIChkYXRhLCBjb250YWluZXIpe1xuICAgIHZhciBtYXRyaXg9ZGF0YS5yZWxhdGlvbnM7XG4gICAgdmFyIHNjb3Jlcz1kYXRhLnNjb3JlcztcbiAgICB2YXIgZW50aXR5TmFtZXM9ZGF0YS5lbnRpdHlOYW1lcztcbiAgICB2YXIgZW50aXR5VVJJcz1kYXRhLmVudGl0eVVSSXM7XG4gICAgLy9zdGFydCBkM1xuICAgIHZhciB3ID0gMTAwMCxcbiAgICBoID0gOTAwLFxuICAgIHIxID0gaCAvIDIsXG4gICAgcjAgPSByMSAtIDgwO1xuICAgIHZhciBmaWxsID0gZDMuc2NhbGUuY2F0ZWdvcnkyMGMoKTtcblxuICAgIHZhciBjaG9yZCA9IGQzLmxheW91dC5jaG9yZCgpXG4gICAgICAgIC5wYWRkaW5nKDAuMDQpXG4gICAgICAgIC5zb3J0U3ViZ3JvdXBzKGQzLmRlc2NlbmRpbmcpXG4gICAgICAgIC5zb3J0Q2hvcmRzKGQzLmRlc2NlbmRpbmcpO1xuXG4gICAgdmFyIGFyYyA9IGQzLnN2Zy5hcmMoKVxuICAgICAgICAuaW5uZXJSYWRpdXMocjApXG4gICAgICAgIC5vdXRlclJhZGl1cyhyMCArIDIwKTtcblxuICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoY29udGFpbmVyKS5hcHBlbmQoJ3N2ZzpzdmcnKVxuICAgICAgICAuYXR0cignd2lkdGgnLCB3KVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgaClcbiAgICAgICAgLmFwcGVuZCgnc3ZnOmcnKVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgdyAvIDIgKyAnLCcgKyBoIC8gMiArICcpJyk7XG5cbiAgICBjaG9yZC5tYXRyaXgobWF0cml4KTtcblxuICAgIHZhciBnID0gc3ZnLnNlbGVjdEFsbCgnZy5ncm91cCcpXG4gICAgICAgIC5kYXRhKGNob3JkLmdyb3VwcylcbiAgICAgICAgLmVudGVyKCkuYXBwZW5kKCdzdmc6ZycpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdncm91cCcpXG4gICAgICAgIC5vbignbW91c2VvdmVyJywgZmFkZSgwLjAyLCBzdmcpKVxuICAgICAgICAub24oJ21vdXNlb3V0JywgZmFkZSgwLjgwLCBzdmcpKTtcbiAgICBnLmFwcGVuZCgnc3ZnOnBhdGgnKVxuICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGZpbGwoZC5pbmRleCk7IH0pXG4gICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGZpbGwoZC5pbmRleCk7IH0pXG4gICAgICAgIC5hdHRyKCdpZCcsZnVuY3Rpb24oZCkgeyByZXR1cm4gJ3BhdGhfJytkLmluZGV4OyB9KVxuICAgICAgICAuYXR0cignZCcsIGFyYyk7XG5cbiAgICBnLmFwcGVuZCgnc3ZnOnRleHQnKVxuICAgICAgICAuZWFjaChmdW5jdGlvbihkKSB7IGQuYW5nbGUgPSAoZC5zdGFydEFuZ2xlICsgZC5lbmRBbmdsZSkgLyAyOyB9KVxuICAgICAgICAuYXR0cignZHknLCAnLjM1ZW0nKVxuICAgICAgICAuYXR0cignaWQnLGZ1bmN0aW9uKGQpIHsgcmV0dXJuICdsYWJlbF8nK2QuaW5kZXg7IH0pXG4gICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuYW5nbGUgPiBNYXRoLlBJID8gJ2VuZCcgOiBudWxsOyB9KVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgcmV0dXJuICdyb3RhdGUoJyArIChkLmFuZ2xlICogMTgwIC8gTWF0aC5QSSAtIDkwKSArICcpJyArXG4gICAgICAgICAgICAgICAgJ3RyYW5zbGF0ZSgnICsgKHIwICsgMjYpICsgJyknICtcbiAgICAgICAgICAgICAgICAoZC5hbmdsZSA+IE1hdGguUEkgPyAncm90YXRlKDE4MCknIDogJycpO1xuICAgICAgICB9KVxuICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBlbnRpdHlOYW1lc1tkLmluZGV4XTsgfSk7XG5cbiAgICBzdmcuc2VsZWN0QWxsKCdwYXRoLmNob3JkJylcbiAgICAgICAgLmRhdGEoY2hvcmQuY2hvcmRzKVxuICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ3N2ZzpwYXRoJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2Nob3JkJylcbiAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7IHJldHVybiBkMy5yZ2IoZmlsbChkLnNvdXJjZS5pbmRleCkpLmRhcmtlcigpOyB9KVxuICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7IHJldHVybiBmaWxsKGQuc291cmNlLmluZGV4KTsgfSlcbiAgICAgICAgLmF0dHIoJ2QnLCBkMy5zdmcuY2hvcmQoKS5yYWRpdXMocjApKTtcblxuICAgICQuZWFjaChlbnRpdHlOYW1lcyxmdW5jdGlvbihpLHYpe1xuICAgICAgICAkKCcjbGFiZWxfJytpKS5tb3VzZW92ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSAkKCcjbGFiZWxfJytpKS5wb3NpdGlvbigpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh2KTtcbiAgICAgICAgICAgICQoJyNyZWxhdGlvbnMnKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJkMy1yZWwtdG9vbHRpcFwiIHN0eWxlPVwidG9wOicrKHBvc2l0aW9uLnRvcCszMCkrJ3B4O2xlZnQ6Jytwb3NpdGlvbi5sZWZ0KydweFwiPicrdisnPC9kaXY+Jyk7XG4gICAgICAgICAgICAkKCcjbGFiZWxfJytpKS5jc3MoJ2ZpbGwnLGQzLnNlbGVjdCgnI3BhdGhfJytpKS5zdHlsZSgnZmlsbCcpKTtcbiAgICAgICAgICAgICQoJyNsYWJlbF8nK2kpLmNzcygnY3Vyc29yJywncG9pbnRlcicpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnI2xhYmVsXycraSkubW91c2VvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcjbGFiZWxfJytpKS5jc3MoJ2ZpbGwnLCcjMDAwJyk7XG4gICAgICAgICAgICAkKCcjcmVsYXRpb25zIC5kMy1yZWwtdG9vbHRpcCcpLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gQ29ycHVzUmVsYXRpb25zQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHNjZSkge1xuICAgIC8vIGdldCBkYXRhXG4gICAgJC5nZXRKU09OKCcvYXBpL2NvcnB1cy8nICsgJHNjb3BlLmN1cnJlbnRDb3JwdXMuX2lkICsgJy9yZWxhdGlvbnMnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBwcm9jZXNzZWREYXRhID0gUmVsYXRpb25zUHJvY2Vzc2VyLnByb2Nlc3NEYXRhKGRhdGEpO1xuICAgICAgICBjcmVhdGVSZWxDaGFydChwcm9jZXNzZWREYXRhLCAnI3JlbGF0aW9uc0NvbnRhaW5lcicpO1xuICAgIH0pO1xufTtcbiIsInZhciBjb3JwdXNUeXBlcyA9IHJlcXVpcmUoJy4uL2RhdGEvY29ycHVzVHlwZXMuanMnKTtcbnZhciBubHBBcGlzID0gcmVxdWlyZSgnLi4vZGF0YS9ubHBBcGlzLmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gQ3JlYXRlQ29ycHVzQ29udHJvbGxlcigkc2NvcGUpIHtcbiAgICAvLyBjb2xsZWN0aW9uIG9mIGNvcnB1cyB0eXBlc1xuICAgICRzY29wZS5jb3JwdXNUeXBlcyA9IGNvcnB1c1R5cGVzO1xuICAgIC8vIGNvbGxlY3Rpb24gb2YgbmxwIGFwaXNcbiAgICAkc2NvcGUubmxwQXBpcyA9IG5scEFwaXM7XG5cbiAgICAvLyBjdXJyZW50IGNvcnB1c1xuICAgICRzY29wZS5jb3JwdXNTZWxlY3Rpb24gPSB7aW5kZXg6IDB9O1xuICAgICRzY29wZS5jdXJyZW50Q29ycHVzID0gJHNjb3BlLmNvcnB1c1R5cGVzWzBdO1xuXG4gICAgLy8gaW5wdXQgc2xpZGVyIHJlZmVyZW5jZVxuICAgIHZhciAkaW5wdXRDb3VudCwgJHNsaWRlckNvbnRhaW5lcjtcbiAgICAvLyB1cGRhdGUgdmlldyBzbGlkZXJcbiAgICB2YXIgdXBkYXRlVmlldyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuY3VycmVudENvcnB1cyA9ICRzY29wZS5jb3JwdXNUeXBlc1skc2NvcGUuY29ycHVzU2VsZWN0aW9uLmluZGV4XTtcbiAgICAgICAgaWYoJHNjb3BlLmN1cnJlbnRDb3JwdXMuaGF2ZUl0ZW1zKSB7XG4gICAgICAgICAgICBpZighJGlucHV0Q291bnQpIHtcbiAgICAgICAgICAgICAgICAkc2xpZGVyQ29udGFpbmVyID0gJCgnI3NsaWRlcl9jb250YWluZXInKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRDb3VudCA9ICQoJyNpbnB1dF9jb3VudCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaW5wdXRDb3VudC5zbGlkZXIoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzbGlkZXJDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgJGlucHV0Q291bnQuc2xpZGVyKHtcbiAgICAgICAgICAgICAgICBtaW46ICRzY29wZS5jdXJyZW50Q29ycHVzLml0ZW1zTWluLFxuICAgICAgICAgICAgICAgIG1heDogJHNjb3BlLmN1cnJlbnRDb3JwdXMuaXRlbXNNYXgsXG4gICAgICAgICAgICAgICAgc3RlcDogNTAsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICRzY29wZS5jdXJyZW50Q29ycHVzLml0ZW1zRGVmYXVsdCxcbiAgICAgICAgICAgICAgICB0b29sdGlwOiAnYWx3YXlzJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2xpZGVyQ29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyB1cGRhdGUgdmlldyBvbiBtb2RlbCBjaGFuZ2VcbiAgICAkc2NvcGUuJHdhdGNoKCdjb3JwdXNTZWxlY3Rpb24nLCB1cGRhdGVWaWV3LCB0cnVlKTtcblxuICAgIC8vIHVwZGF0ZSBzbGlkZXJcbiAgICAkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCB1cGRhdGVWaWV3KTtcblxuICAgIC8vIGFuYWx5c2lzIHN0YXJ0IGZ1bmN0aW9uXG4gICAgJHNjb3BlLnN0YXJ0QW5hbHlzaXMgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAvLyBwcmV2ZW50IGV2ZW50XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy8gZ2V0IGZpZWxkc1xuICAgICAgICB2YXIgJGlucHV0SXRlbSA9ICQoJyNpbnB1dF9pdGVtJyk7XG4gICAgICAgIHZhciAkaW5wdXRJdGVtQXJlYSA9ICQoJyNpbnB1dF9pdGVtX2FyZWEnKTtcbiAgICAgICAgdmFyICRpbnB1dEl0ZW1GaWxlID0gJCgnI2lucHV0X2l0ZW1fZmlsZScpO1xuICAgICAgICB2YXIgJGlucHV0Q291bnRGaWVsZCA9ICQoJ2lucHV0I2lucHV0X2NvdW50Jyk7XG4gICAgICAgIHZhciAkbmV3Q29ycHVzRm9ybSA9ICQoJyNuZXdjb3JwdXNfZm9ybScpO1xuICAgICAgICB2YXIgJGlucHV0VHlwZSA9ICQoJ2lucHV0W25hbWU9aW5wdXRfdHlwZV06Y2hlY2tlZCcpO1xuXG4gICAgICAgIC8vIHJlbW92ZSBvbGQgd2FybmluZ1xuICAgICAgICAkaW5wdXRJdGVtLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdoYXMtd2FybmluZycpO1xuXG4gICAgICAgIC8vIHZhbGlkYXRlIGlucHV0XG4gICAgICAgIHZhciBpbnB1dCA9IG51bGw7XG4gICAgICAgIHZhciBjb3JwdXNUeXBlID0gJHNjb3BlLmN1cnJlbnRDb3JwdXMubmFtZTtcbiAgICAgICAgdmFyIGlucHV0VHlwZSA9ICRzY29wZS5jdXJyZW50Q29ycHVzLmlucHV0VHlwZTtcbiAgICAgICAgc3dpdGNoKGlucHV0VHlwZSkge1xuICAgICAgICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAkaW5wdXRJdGVtLnZhbCgpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgICAgICAgICAgICBpbnB1dCA9ICRpbnB1dEl0ZW1BcmVhLnZhbCgpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZpbGUnOlxuICAgICAgICAgICAgICAgIGlucHV0ID0gJGlucHV0SXRlbUZpbGUudmFsKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgICAgICAkaW5wdXRJdGVtLnBhcmVudCgpLmFkZENsYXNzKCdoYXMtd2FybmluZycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYXBwZW5kIGNzcmYgdG9rZW4gdG8gZm9ybSB1cmxcbiAgICAgICAgJG5ld0NvcnB1c0Zvcm0uYXR0cignYWN0aW9uJywgJy9hcGkvY29ycHVzP19jc3JmPScgKyBlbmNvZGVVUklDb21wb25lbnQoJHNjb3BlLmNzcmYpKTtcblxuICAgICAgICAvLyBhc3NpZ24gY291bnQgdG8gaW5wdXQgZmllbGRcbiAgICAgICAgdmFyIGl0ZW1Db3VudCA9ICRpbnB1dENvdW50LnNsaWRlcignZ2V0VmFsdWUnKTtcbiAgICAgICAgJGlucHV0Q291bnRGaWVsZC52YWwoaXRlbUNvdW50KTtcblxuICAgICAgICAvLyByZW1vdmUgdW5uZWVkZWQgaW5wdXRzICYgcmVuYW1lIGxhc3Qgb25lXG4gICAgICAgIHN3aXRjaChpbnB1dFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW0uYXR0cignbmFtZScsICdpbnB1dCcpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1BcmVhLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1GaWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndGV4dGFyZWEnOlxuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbUFyZWEuYXR0cignbmFtZScsICdpbnB1dCcpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1GaWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZmlsZSc6XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtQXJlYS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRDb3VudEZpZWxkLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1GaWxlLmF0dHIoJ25hbWUnLCAnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHN3YXAgaW5wdXQgdHlwZSB2YWx1ZVxuICAgICAgICAkaW5wdXRUeXBlLnZhbChjb3JwdXNUeXBlKTtcblxuICAgICAgICAvLyBzZW5kIHRvIHNlcnZlclxuICAgICAgICAkbmV3Q29ycHVzRm9ybS5zdWJtaXQoKTtcbiAgICB9O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy8gY29ycHVzIG1vZGVsXG4gICAgJHNjb3BlLmNvcnB1cyA9ICcwJztcbiAgICAvLyBvbiBjb3JwdXMgc2VsZWN0IGV2ZW50XG4gICAgJHNjb3BlLmNvcnB1c1NlbGVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBkbyBub3QgZG8gYW55dGhpbmcgaWYgaXQncyBkdW1teSBlbnRyeVxuICAgICAgICBpZigkc2NvcGUuY29ycHVzID09PSAnMCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyByZWRpcmVjdCB0byBjb3JwdXNcbiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9jb3JwdXMvJyArICRzY29wZS5jb3JwdXM7XG4gICAgfTtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSkge1xuICAgIC8vXG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBSZWdpc3RlckNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy9cbn07XG4iLCIvLyBidWlsZCBjb2xsZWN0aW9uIG9mIGl0ZW1zXG52YXIgY29sbGVjdGlvbiA9IFtdO1xuLy8gcnNzXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdmZWVkJyxcbiAgICBkZXNjcmlwdGlvbjogJ1JTUy9SREYvQVRPTSBGZWVkJyxcbiAgICBpbnB1dFR5cGU6ICd0ZXh0JyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnVVJMIG9mIHRoZSBSU1MvUkRGL0FUT00gZmVlZCcsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ1VSTCBvZiB5b3VyIGZlZWQnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogNTAsXG4gICAgaXRlbXNNYXg6IDYwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDUwLFxufSk7XG4vLyB3b3JkcHJlc3NcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ3dvcmRwcmVzcycsXG4gICAgZGVzY3JpcHRpb246ICdXb3JkUHJlc3MgQmxvZycsXG4gICAgaW5wdXRUeXBlOiAndGV4dCcsXG4gICAgaW5wdXREZXNjcmlwdGlvbjogJ1dlYmxvZyBVUkwnLFxuICAgIGlucHV0UGxhY2Vob2xkZXI6ICdVUkwgb2YgdGhlIGJsb2cnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogNTAsXG4gICAgaXRlbXNNYXg6IDQwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDQwMCxcbn0pO1xuLy8gYmxvZ2dlclxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnYmxvZ2dlcicsXG4gICAgZGVzY3JpcHRpb246ICdCbG9nZ2VyIEJsb2cnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdXZWJsb2cgVVJMJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVVJMIG9mIHRoZSBibG9nJyxcbiAgICBoYXZlSXRlbXM6IHRydWUsXG4gICAgaXRlbXNNaW46IDUwLFxuICAgIGl0ZW1zTWF4OiA0MDAsXG4gICAgaXRlbXNEZWZhdWx0OiA0MDAsXG59KTtcbi8vIHB1YmxpYyB0d2l0dGVyXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICd0d2l0dGVyJyxcbiAgICBkZXNjcmlwdGlvbjogJ1B1YmxpYyBUd2l0dGVyIGFjY291bnQnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdUd2l0dGVyIHVzZXJuYW1lJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVXNlcm5hbWUnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogMjAwLFxuICAgIGl0ZW1zTWF4OiAxNTAwLFxuICAgIGl0ZW1zRGVmYXVsdDogMTAwMCxcbn0pO1xuLy8gc2xpZGV3aWtpXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdzbGlkZXdpa2knLFxuICAgIGRlc2NyaXB0aW9uOiAnU2xpZGVXaWtpIERlY2snLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdEZWNrIElEJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnRGVjayBJRCcsXG4gICAgaGF2ZUl0ZW1zOiB0cnVlLFxuICAgIGl0ZW1zTWluOiA1MCxcbiAgICBpdGVtc01heDogMTAwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDQwMCxcbn0pO1xuLy8gd2VicGFnZVxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnd2VicGFnZScsXG4gICAgZGVzY3JpcHRpb246ICdXZWIgcGFnZScsXG4gICAgaW5wdXRUeXBlOiAndGV4dCcsXG4gICAgaW5wdXREZXNjcmlwdGlvbjogJ1dlYlBhZ2UgVVJMJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVVJMJyxcbiAgICBoYXZlSXRlbXM6IGZhbHNlLFxufSk7XG4vLyBkaXJlY3QgaW5wdXRcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ2RpcmVjdGlucHV0JyxcbiAgICBkZXNjcmlwdGlvbjogJ0RpcmVjdCBpbnB1dCcsXG4gICAgaW5wdXRUeXBlOiAndGV4dGFyZWEnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdZb3VyIHRleHQvaHRtbCcsXG4gICAgaGF2ZUl0ZW1zOiBmYWxzZSxcbn0pO1xuLy8gdXBsb2FkIGEgZG9jXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdkb2MnLFxuICAgIGRlc2NyaXB0aW9uOiAnVXBsb2FkIGEgZG9jdW1lbnQocyknLFxuICAgIGlucHV0VHlwZTogJ2ZpbGUnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdEb2N1bWVudCcsXG4gICAgaGF2ZUl0ZW1zOiBmYWxzZSxcbn0pO1xuXG4vLyBPdXIgbW9kdWxlIG5vdyByZXR1cm5zIG91ciB2aWV3XG5tb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb247XG4iLCJ2YXIgY29sbGVjdGlvbiA9IFtdO1xuLy8gb3ZlcnZpZXdcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ092ZXJ2aWV3JyxcbiAgICBwYXRoOiAnL292ZXJ2aWV3JyxcbiAgICBjb250cm9sbGVyOiAnQ29ycHVzT3ZlcnZpZXdDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzT3ZlcnZpZXcuaHRtbCcsXG4gICAganM6IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL2NvcnB1cy9vdmVydmlldy5qcycpLFxufSk7XG4vLyBmYWNldHNcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ0ZhY2V0cycsXG4gICAgcGF0aDogJy9mYWNldHMnLFxuICAgIGNvbnRyb2xsZXI6ICdDb3JwdXNGYWNldHNDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzRmFjZXRzLmh0bWwnLFxuICAgIGpzOiByZXF1aXJlKCcuLi9jb250cm9sbGVycy9jb3JwdXMvZmFjZXRzLmpzJyksXG59KTtcbi8vIHJlbGF0aW9uc1xuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnRW50aXR5IHJlbGF0aW9ucycsXG4gICAgcGF0aDogJy9yZWxhdGlvbnMnLFxuICAgIGNvbnRyb2xsZXI6ICdDb3JwdXNSZWxhdGlvbnNDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzRW50aXR5UmVsYXRpb25zLmh0bWwnLFxuICAgIGpzOiByZXF1aXJlKCcuLi9jb250cm9sbGVycy9jb3JwdXMvcmVsYXRpb25zLmpzJyksXG59KTtcbi8vIGNvLW9jY3VyYW5jZVxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnQ28tb2NjdXJyZW5jZSBtYXRyaXgnLFxuICAgIHBhdGg6ICcvY29vYycsXG4gICAgY29udHJvbGxlcjogJ0NvcnB1c0Nvb2NDb250cm9sbGVyJyxcbiAgICB0ZW1wbGF0ZTogJy90ZW1wbGF0ZXMvY29ycHVzQ29vYy5odG1sJyxcbiAgICBqczogcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvY29ycHVzL2Nvb2MuanMnKSxcbn0pO1xuXG4vLyBPdXIgbW9kdWxlIG5vdyByZXR1cm5zIG91ciB2aWV3XG5tb2R1bGUuZXhwb3J0cyA9IGNvbGxlY3Rpb247IiwiLy8gYnVpbGQgY29sbGVjdGlvbiBvZiBpdGVtc1xudmFyIGNvbGxlY3Rpb24gPSBbXTtcbi8vIHNwb3RsaWdodFxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBpZDogJ0RCcGVkaWEtU3BvdGxpZ2h0JyxcbiAgICBuYW1lOiAnREJwZWRpYSBTcG90bGlnaHQnLFxufSk7XG4vLyBmb3hcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgaWQ6ICdGT1gnLFxuICAgIG5hbWU6ICdGT1gnLFxufSk7XG4vLyBnZXJtYW4gc3BvdGxpZ2h0XG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIGlkOiAnREJwZWRpYS1TcG90bGlnaHQtREUnLFxuICAgIG5hbWU6ICdEQnBlZGlhIFNwb3RsaWdodCAoR2VybWFuKScsXG59KTtcblxuLy8gT3VyIG1vZHVsZSBub3cgcmV0dXJucyBvdXIgdmlld1xubW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseURpcmVjdGl2ZXMgKGFwcCkge1xufTsiLCIvLyBsb2FkIG1vZHVsZXNcbnZhciBDb3JwdXNNb2R1bGUgPSByZXF1aXJlKCcuL21vZHVsZXMvY29ycHVzJyk7XG5cbi8vIGluaXQgYXBwXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2NvbnRleHQtYXBwJywgWyduZ1JvdXRlJywgJ25nQW5pbWF0ZScsICdtZ2NyZWEubmdTdHJhcCcsICdDb3JwdXNNb2R1bGUnXSk7XG5cbi8vIGNvbmZpZyBhcHAgcm91dGVzXG5yZXF1aXJlKCcuL3JvdXRlcycpKGFwcCk7XG5cbi8vIGNvbmZpZyBhcHAgc2VydmljZXNcbnJlcXVpcmUoJy4vc2VydmljZXMnKShhcHApO1xuXG4vLyBpbml0IGNvbnRyb2xsZXJzXG5yZXF1aXJlKCcuL2NvbnRyb2xsZXJzJykoYXBwKTtcblxuLy8gY29uZmlnIGFwcCBkaXJlY3RpdmVzXG5yZXF1aXJlKCcuL2RpcmVjdGl2ZXMnKShhcHApO1xuXG4vLyBjb25maWcgYXBwIGZpbHRlcnNcbnJlcXVpcmUoJy4vZmlsdGVycycpKGFwcCk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFwcGx5RmlsdGVycyAoYXBwKSB7XG59OyIsInZhciBkaWNlTWV0cmljID0gZnVuY3Rpb24gKHgsIHksIHh5KSB7XG4gICAgcmV0dXJuIDIgKiB4eSAvICh4ICsgeSk7XG59O1xuXG52YXIgZ2V0Q29tbW9uQXJ0aWNsZXMgPSBmdW5jdGlvbihlbnRpdHksIGVudGl0eURvdWJsZSkge1xuICAgIHJldHVybiBfLmludGVyc2VjdGlvbihlbnRpdHkuYXJ0aWNsZXMsIGVudGl0eURvdWJsZS5hcnRpY2xlcyk7XG59O1xuXG52YXIgcHJvY2Vzc0RhdGEgPSBmdW5jdGlvbihjb3JwdXMpIHtcbiAgICAvLyBlbnRpdGllcyBhcnJheVxuICAgIHZhciBlbnRpdGllcyA9IHt9O1xuICAgIHZhciB0eXBlcyA9IFtdO1xuICAgIC8vIGZpbmQgbWluLCBtYXgsIGF2ZyBvZiBlbnRpdGllc1xuICAgIHZhciBlbnRpdGllc01pbiwgZW50aXRpZXNNYXgsIGVudGl0aWVzQXZnO1xuICAgIHZhciBlbnRpdGllc1RvdGFsID0gMDtcbiAgICAvLyBnbyB0aHJvdWdoIGFsbCBhcnRpY2xlc1xuICAgIGNvcnB1cy5hcnRpY2xlcy5mb3JFYWNoKGZ1bmN0aW9uKGFydGljbGUpIHtcbiAgICAgICAgLy8gY2FsY3VsYXRlIHN0dWZmXG4gICAgICAgIHZhciBjb3VudCA9IGFydGljbGUuZW50aXRpZXMubGVuZ3RoO1xuICAgICAgICBlbnRpdGllc1RvdGFsICs9IGNvdW50O1xuICAgICAgICBlbnRpdGllc01pbiA9IF8ubWluKFtlbnRpdGllc01pbiwgY291bnRdKTtcbiAgICAgICAgZW50aXRpZXNNYXggPSBfLm1heChbZW50aXRpZXNNaW4sIGNvdW50XSk7XG4gICAgICAgIC8vIGFkZCBlbnRpdGllcyB0byBhbGwgYXJyYXlcbiAgICAgICAgYXJ0aWNsZS5lbnRpdGllcy5mb3JFYWNoKGZ1bmN0aW9uKGVudGl0eSkge1xuICAgICAgICAgICAgaWYoZW50aXRpZXNbZW50aXR5LnVyaV0pIHtcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXS5jb3VudCsrO1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldLmFydGljbGVzLnB1c2goYXJ0aWNsZS5faWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXSA9IGVudGl0eTtcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXS5jb3VudCA9IDE7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uYXJ0aWNsZXMgPSBbYXJ0aWNsZS5faWRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZmlsbCB0eXBlc1xuICAgICAgICAgICAgZW50aXR5LnR5cGVzLmZvckVhY2goZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgICAgIGlmKHR5cGVzLmluZGV4T2YodHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIGNvdW50IGF2ZXJhZ2VcbiAgICBlbnRpdGllc0F2ZyA9IE1hdGguZmxvb3IoZW50aXRpZXNUb3RhbCAvIGNvcnB1cy5hcnRpY2xlcy5sZW5ndGgpO1xuXG4gICAgLy8gcHJlcGFyZSB2YXJzIGZvciBmaW5hbCBkYXRhXG4gICAgdmFyIG5vZGVzID0gW107XG4gICAgdmFyIGxpbmtzID0gW107XG4gICAgdmFyIGdyb3VwcyA9IFtdO1xuICAgIHZhciBzY29yZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5TmFtZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5VVJJcyA9IFtdO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgLy8gdGVtcCBhcnJheXNcbiAgICB2YXIgdG1wID0gW107XG5cbiAgICAvLyBwcm9jZXNzXG4gICAgdmFyIGVrZXksIGVudGl0eTtcbiAgICBmb3IoZWtleSBpbiBlbnRpdGllcykge1xuICAgICAgICBlbnRpdHkgPSBlbnRpdGllc1tla2V5XTtcbiAgICAgICAgLy8gcHVzaCB1cmlcbiAgICAgICAgZW50aXR5VVJJcy5wdXNoKGVudGl0eS51cmkpO1xuICAgICAgICAvLyBnZXQgdHlwZVxuICAgICAgICB2YXIgdHlwZSA9IGVudGl0eS50eXBlc1swXTtcbiAgICAgICAgdmFyIHR5cGVJZCA9IHR5cGVzLmluZGV4T2YodHlwZSk7XG4gICAgICAgIGdyb3Vwc1t0eXBlSWRdID0gdHlwZTtcbiAgICAgICAgLy8gcHVzaCBkYXRhXG4gICAgICAgIGlmIChlbnRpdHlOYW1lcy5pbmRleE9mKGVudGl0eS5uYW1lKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIGVudGl0eU5hbWVzLnB1c2goZW50aXR5Lm5hbWUpO1xuICAgICAgICAgICAgbm9kZXMucHVzaCh7bmFtZTogZW50aXR5Lm5hbWUsIHVyaTogZW50aXR5LnVyaSwgZ3JvdXA6IHR5cGVJZH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIGVudGl0eU5hbWVzLnB1c2goZW50aXR5Lm5hbWUgKyAnIycgKyBpbmRleCk7XG4gICAgICAgICAgICBub2Rlcy5wdXNoKHtuYW1lOiBlbnRpdHkubmFtZSArICcjJyArIGluZGV4LCB1cmk6IGVudGl0eS51cmksIGdyb3VwOiB0eXBlSWR9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHByb2Nlc3NcbiAgICBmb3IoZWtleSBpbiBlbnRpdGllcykge1xuICAgICAgICBlbnRpdHkgPSBlbnRpdGllc1tla2V5XTtcbiAgICAgICAgLy8gcHJlcGFyZSByb3cgZGF0YVxuICAgICAgICB2YXIgc2NvcmUgPSBbXTtcblxuICAgICAgICAvLyBnbyB0aHJvdWdoIGVudGl0aWVzIGFnYWluXG4gICAgICAgIGZvcih2YXIgZWtleTIgaW4gZW50aXRpZXMpIHtcbiAgICAgICAgICAgIHZhciBlbnRpdHlEb3VibGUgPSBlbnRpdGllc1tla2V5Ml07XG4gICAgICAgICAgICBpZiAoZW50aXR5LnVyaSAhPT0gZW50aXR5RG91YmxlLnVyaSkge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBlbnRpdHkuX2lkICsgJy0nICsgZW50aXR5RG91YmxlLl9pZDtcbiAgICAgICAgICAgICAgICB2YXIgcmV2ZXJzZUtleSA9IGVudGl0eURvdWJsZS5faWQgKyAnLScgKyBlbnRpdHkuX2lkO1xuICAgICAgICAgICAgICAgIGlmICh0bXAuaW5kZXhPZihrZXkpID09PSAtMSAmJiB0bXAuaW5kZXhPZihyZXZlcnNlS2V5KSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9naXZlIG1lIHRoZSBudW1iZXIgb2YgYXJ0aWNsZXMgdGhhdCBoYXZlIGJvdGggICRpIFsndXJpJ10gYW5kICRqIFsndXJpJ10gZW50aXRpZXNcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1vbiA9IGdldENvbW1vbkFydGljbGVzKGVudGl0eSwgZW50aXR5RG91YmxlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3JlVmFsdWUgPSBbZGljZU1ldHJpYyhlbnRpdHkuYXJ0aWNsZXMubGVuZ3RoLCBlbnRpdHlEb3VibGUuYXJ0aWNsZXMubGVuZ3RoLCBjb21tb24ubGVuZ3RoKV07XG4gICAgICAgICAgICAgICAgICAgIHNjb3JlLnB1c2goc2NvcmVWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxpbmtzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBlbnRpdHlVUklzLmluZGV4T2YoZW50aXR5LnVyaSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IGVudGl0eVVSSXMuaW5kZXhPZihlbnRpdHlEb3VibGUudXJpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjb21tb24gPyBjb21tb24ubGVuZ3RoIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFydGljbGVzOiBjb21tb25cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcHVzaCBzY29yZXNcbiAgICAgICAgc2NvcmVzLnB1c2goc2NvcmUpO1xuICAgIH1cblxuICAgIC8vIGdldCB0aHJlc2hvbGQgZnJvbSBtaWRkbGUgb2Ygc2NvcmVzXG4gICAgdmFyIHNvcnRlZFNjb3JlcyA9IFtdO1xuICAgIC8vIGdldCBzY29yZXNcbiAgICBzY29yZXMuZm9yRWFjaChmdW5jdGlvbihzY29yZSkge1xuICAgICAgICBzY29yZS5mb3JFYWNoKGZ1bmN0aW9uKG51bSkge1xuICAgICAgICAgICAgaWYobnVtID4gMCkge1xuICAgICAgICAgICAgICAgIHNvcnRlZFNjb3Jlcy5wdXNoKG51bVswXSk7XG4gICAgICAgICAgICAgICAgdGhyZXNob2xkICs9IG51bTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8gc29ydFxuICAgIHNvcnRlZFNjb3JlcyA9IHNvcnRlZFNjb3Jlcy5zb3J0KCk7XG4gICAgLy8gZ2V0IHRocmVzaG9sZFxuICAgIHZhciBjZW50ZXIgPSBNYXRoLmZsb29yKHNvcnRlZFNjb3Jlcy5sZW5ndGggLyAyKTtcbiAgICB2YXIgdGhyZXNob2xkID0gc29ydGVkU2NvcmVzW2NlbnRlcl07XG5cbiAgICAvL3JlbW92ZSBub2lzZXNcbiAgICBzY29yZXMuZm9yRWFjaChmdW5jdGlvbihyb3csIGluZGV4KXtcbiAgICAgICAgaWYoc2NvcmUgPCB0aHJlc2hvbGQpIHtcbiAgICAgICAgICAgIGxpbmtzW2luZGV4XS52YWx1ZT0wO1xuICAgICAgICAgICAgbGlua3NbaW5kZXhdLmFydGljbGVzPScnO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBub2Rlczogbm9kZXMsXG4gICAgICAgIGxpbmtzOiBsaW5rcyxcbiAgICAgICAgZ3JvdXBzOiBncm91cHNcbiAgICB9O1xufTtcblxuZXhwb3J0cy5wcm9jZXNzRGF0YSA9IHByb2Nlc3NEYXRhOyIsInZhciBlc2NhcGVSZWdFeHAgPSBmdW5jdGlvbihzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXC1cXFtcXF1cXC9cXHtcXH1cXChcXClcXCpcXCtcXD9cXC5cXFxcXFxeXFwkXFx8XS9nLCAnXFxcXCQmJyk7XG59O1xuXG52YXIgcHJvY2Vzc0RhdGEgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgLy8gYXJ0aWNsZXNcbiAgICB2YXIgYXJ0aWNsZXMgPSBbXTtcbiAgICAvLyB0eXBlc1xuICAgIHZhciB0eXBlcyA9IFtdO1xuICAgIHZhciB0eXBlTmFtZXMgPSBbXTtcbiAgICAvLyBlbnRpdGllc1xuICAgIHZhciBlbnRpdGllcyA9IFtdO1xuICAgIHZhciBlbnRpdHlOYW1lcyA9IFtdO1xuXG4gICAgLy8gZXh0cmFjdCBkYXRhXG4gICAgZGF0YS5hcnRpY2xlcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgLy8gZ2V0IGFydGljbGUgZGF0YVxuICAgICAgICB2YXIgdGl0bGUgPSAnJztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBkb20gPSAkKGl0ZW0uc291cmNlKTtcbiAgICAgICAgICAgIHRpdGxlID0gJCgnZXh0cmFjdGVkLXRpdGxlJywgZG9tKS50ZXh0KCkgfHwgZG9tLnRleHQoKTtcbiAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICB0aXRsZSA9IGl0ZW0uc291cmNlO1xuICAgICAgICB9XG4gICAgICAgIHRpdGxlID0gdGl0bGUuc2xpY2UoMCwgMzApICsgJy4uLic7XG4gICAgICAgIHZhciBhcnRpY2xlID0ge1xuICAgICAgICAgICAgaWQ6IGl0ZW0uX2lkLFxuICAgICAgICAgICAgbmFtZTogdGl0bGUsXG4gICAgICAgICAgICB0eXBlOiAnYXJ0aWNsZScsXG4gICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgIGVudGl0aWVzOiBbXSxcbiAgICAgICAgICAgIHR5cGVzOiBbXSxcbiAgICAgICAgICAgIHNvdXJjZTogaXRlbS5zb3VyY2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gZ2V0IGFydGljbGUgcGxhaW4gdGV4dFxuICAgICAgICB2YXIgc291cmNlVGV4dCA9IFMoaXRlbS5zb3VyY2UpLnN0cmlwVGFncygpLnM7XG4gICAgICAgIC8vIHNwbGl0IHBsYWluIHRleHQgYW5kIGZ1bGwgc291cmNlIGludG8gd29yZHNcbiAgICAgICAgdmFyIHNyY1RleHQgPSBzb3VyY2VUZXh0LnNwbGl0KC9cXHMvKTtcbiAgICAgICAgdmFyIHNyYyA9IGl0ZW0uc291cmNlLnNwbGl0KC9cXHMvKTtcbiAgICAgICAgLy8gc3BsaXQgdXNpbmcgYWRkaXRpb25hbCBjaGFyYWN0ZXJzIGZvciBiZXR0ZXIgcHJvY2Vzc2luZ1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgc3JjVGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ID0gc3JjVGV4dFtpXTtcbiAgICAgICAgICAgIGl0ID0gaXQuc3BsaXQoJy8nKTtcbiAgICAgICAgICAgIHNyY1RleHRbaV0gPSBpdDtcbiAgICAgICAgfVxuICAgICAgICAvLyBmbGF0dGVuIGFycmF5c1xuICAgICAgICBzcmNUZXh0ID0gXy5mbGF0dGVuKHNyY1RleHQpO1xuXG4gICAgICAgIHZhciBmaW5kU291cmNlSW5kZXggPSBmdW5jdGlvbih3b3JkLCBjbGVhbldvcmQsIGVudGl0eU5hbWUsIHN0YXJ0SW5kZXgpIHtcbiAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBzdGFydEluZGV4IHx8IC0xO1xuICAgICAgICAgICAgLy8gdHJ5IHRvIGdldCBwbGFpbiBtYXRjaCBmcm9tIG9yaWdpbmFsIHNvdXJjZVxuICAgICAgICAgICAgdmFyIHNvdXJjZUluZGV4ID0gc3JjLmluZGV4T2Yod29yZCwgc3RhcnRJbmRleCk7XG4gICAgICAgICAgICAvLyBpZiBub3QgZm91bmQsIGZpbmQgYnkgc3RyaW5nXG4gICAgICAgICAgICBpZihzb3VyY2VJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAvL2lmKGVudGl0eU5hbWUgPT09IHRlc3RFbnRpdHkpIGNvbnNvbGUubG9nKCdzZWFyY2hpbmcgaW5kZXggaW4gYXJyYXknKTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgc3JjLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNyY1dvcmQgPSBzcmNbaV07XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsZWFuIGZyb20gaHJlZnNcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNyY1dvcmRDbGVhbiA9IHNyY1dvcmQucmVwbGFjZSgvaHJlZj1cIiguKz8pXCIoLio/Pj8pLywgJycpLnJlcGxhY2UoL3NyYz1cIiguKz8pXCIoLio/Pj8pLywgJycpLnJlcGxhY2UoL2FsdD1cIiguKz8pXCIoLio/Pj8pLywgJycpO1xuICAgICAgICAgICAgICAgICAgICAvLyBza2lwIGlmIGNvbnRhaW5lcyBtYXJraW5nIHBhcnRzXG4gICAgICAgICAgICAgICAgICAgIGlmKHNyY1dvcmRDbGVhbi5pbmRleE9mKCdzcGFuJW1hcmtlZCUnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgIGlmKHNyY1dvcmRDbGVhbi5tYXRjaChuZXcgUmVnRXhwKG1hdGNoUmVnU3RhcnQrZXNjYXBlUmVnRXhwKGNsZWFuV29yZCkrbWF0Y2hSZWcpKSAmJiBpID49IHN0YXJ0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc291cmNlSW5kZXg7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNsZWFuUmVnID0gLyheW1xcV10rKXwoW1xcV10rJCkvZztcbiAgICAgICAgdmFyIG1hdGNoUmVnU3RhcnQgPSAnJztcbiAgICAgICAgdmFyIG1hdGNoUmVnID0gJyhcXFxcVz8pJztcblxuICAgICAgICAvLyBnZXQgZW50aXRpZXNcbiAgICAgICAgaXRlbS5lbnRpdGllcy5mb3JFYWNoKGZ1bmN0aW9uKGVudGl0eSl7XG4gICAgICAgICAgICB2YXIgZW50aXR5UGFydHMgPSBlbnRpdHkubmFtZS5zcGxpdCgnICcpO1xuXG4gICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSB3b3JkXG4gICAgICAgICAgICBpZihlbnRpdHlQYXJ0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAvLyBmaW5kIHdvcmQgdGhhdCBtYXRjaGVzIGN1cnJlbnQgZW50aXR5XG4gICAgICAgICAgICAgICAgc3JjVGV4dC5mb3JFYWNoKGZ1bmN0aW9uKHdvcmQsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNsZWFuIHdvcmQgZnJvbSBjb21tYXMsIGRvdHMgYW5kIG90aGVyIHN1cGxlbWVudGFyeSBzdHVmZlxuICAgICAgICAgICAgICAgICAgICB2YXIgY2xlYW5Xb3JkID0gd29yZC5yZXBsYWNlKGNsZWFuUmVnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRpdHlDbGVhbiA9IGVudGl0eS5uYW1lLnJlcGxhY2UoY2xlYW5SZWcsICcnKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjZWhjayBtYXRjaFxuICAgICAgICAgICAgICAgICAgICBpZihjbGVhbldvcmQgPT09IGVudGl0eS5uYW1lIHx8IHdvcmQgPT09IGVudGl0eS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbWF0Y2ggZnJvbSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VJbmRleCA9IGZpbmRTb3VyY2VJbmRleCh3b3JkLCBjbGVhbldvcmQsIGVudGl0eS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdvcmQgd2FzIGZvdW5kXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2VJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ1NyYyA9IHNyY1tzb3VyY2VJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmsgPSBvcmlnU3JjLm1hdGNoKC9ocmVmPVwiKC4rPylcIi8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWcgPSBvcmlnU3JjLm1hdGNoKC9zcmM9XCIoLis/KVwiLyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsdCA9IG9yaWdTcmMubWF0Y2goL2FsdD1cIiguKz8pXCIvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihsaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgPSBsaW5rWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnU3JjID0gb3JpZ1NyYy5yZXBsYWNlKGxpbmssICclbGluayUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZyA9IGltZ1sxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NyYyA9IG9yaWdTcmMucmVwbGFjZShpbWcsICclaW1nJScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhbHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0ID0gYWx0WzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnU3JjID0gb3JpZ1NyYy5yZXBsYWNlKGFsdCwgJyVhbHQlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5yaWNoIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1tzb3VyY2VJbmRleF0gPSBvcmlnU3JjLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4lbWFya2VkJSBjbGFzcz1cImxhYmVsIGxhYmVsLXdhcm5pbmcgaGFzVG9vbHRpcFwiIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiIHRpdGxlPVwiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS50eXBlcy5qb2luKCcgJykgKyAnXCI+JyArIGVudGl0eS5uYW1lICsgJzwvc3BhbiVtYXJrZWQlPidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobGluaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gc3JjW3NvdXJjZUluZGV4XS5yZXBsYWNlKCclbGluayUnLCBsaW5rKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW1nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1tzb3VyY2VJbmRleF0gPSBzcmNbc291cmNlSW5kZXhdLnJlcGxhY2UoJyVpbWclJywgaW1nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1tzb3VyY2VJbmRleF0gPSBzcmNbc291cmNlSW5kZXhdLnJlcGxhY2UoJyVhbHQlJywgYWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBtYXRjaFxuICAgICAgICAgICAgICAgIHZhciBmaXJzdFdvcmQgPSBlbnRpdHlQYXJ0c1swXTtcbiAgICAgICAgICAgICAgICB2YXIgbGFzdFdvcmQgPSBlbnRpdHlQYXJ0c1tlbnRpdHlQYXJ0cy5sZW5ndGgtMV07XG4gICAgICAgICAgICAgICAgLy8gZmluZCB3b3JkIHRoYXQgbWF0Y2hlcyBjdXJyZW50IGVudGl0eVxuICAgICAgICAgICAgICAgIHNyY1RleHQuZm9yRWFjaChmdW5jdGlvbih3b3JkLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhbiB3b3JkIGZyb20gY29tbWFzLCBkb3RzIGFuZCBvdGhlciBzdXBsZW1lbnRhcnkgc3R1ZmZcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNsZWFuV29yZCA9IHdvcmQucmVwbGFjZShjbGVhblJlZywgJycpO1xuICAgICAgICAgICAgICAgICAgICBpZihjbGVhbldvcmQuaW5kZXhPZignc3BhbiVtYXJrZWQlJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gdGVzdCBtYXRjaFxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBmaXJzdFdvcmQubWF0Y2gobmV3IFJlZ0V4cChtYXRjaFJlZ1N0YXJ0K2VzY2FwZVJlZ0V4cChjbGVhbldvcmQpK21hdGNoUmVnKSkgIT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IoaSA9IDE7IGkgPCBlbnRpdHlQYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGluZGV4K2kgPj0gc3JjVGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRDbGVhbldvcmQgPSBzcmNUZXh0W2luZGV4K2ldLnJlcGxhY2UoY2xlYW5SZWcsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihuZXh0Q2xlYW5Xb3JkLmluZGV4T2YoJ3NwYW4lbWFya2VkJScpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaCAmJiBlbnRpdHlQYXJ0c1tpXS5tYXRjaChuZXcgUmVnRXhwKG1hdGNoUmVnU3RhcnQrZXNjYXBlUmVnRXhwKG5leHRDbGVhbldvcmQpK21hdGNoUmVnKSkgIT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGNvbXBsZXRlIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgZmlyc3QgcGFydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBtYXRjaCBmcm9tIG9yaWdpbmFsIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VTdGFydEluZGV4ID0gZmluZFNvdXJjZUluZGV4KHdvcmQsIGNsZWFuV29yZCwgZmlyc3RXb3JkLCBpbmRleCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGVuZCBwYXJ0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZEluZGV4ID0gaW5kZXgrZW50aXR5UGFydHMubGVuZ3RoLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZW5kSW5kZXggPj0gc3JjVGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5kV29yZCA9IHNyY1RleHRbZW5kSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmRDbGVhbldvcmQgPSBlbmRXb3JkLnJlcGxhY2UoL1teXFx3XS8sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0cnkgdG8gZ2V0IHBsYWluIG1hdGNoIGZyb20gb3JpZ2luYWwgc291cmNlIGZvciBzdGFydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRJbmRleCA9IGZpbmRTb3VyY2VJbmRleChlbmRXb3JkLCBlbmRDbGVhbldvcmQsIGxhc3RXb3JkLCBlbmRJbmRleCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3b3JkIHdhcyBmb3VuZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNvdXJjZVN0YXJ0SW5kZXggIT09IC0xICYmIHNvdXJjZUVuZEluZGV4ICE9PSAtMSAmJiBNYXRoLmFicyhzb3VyY2VTdGFydEluZGV4IC0gc291cmNlRW5kSW5kZXgpIDwgNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnJpY2ggc291cmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY1tzb3VyY2VTdGFydEluZGV4XSA9IHNyY1tzb3VyY2VTdGFydEluZGV4XS5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJlZ0V4cChlc2NhcGVSZWdFeHAoZmlyc3RXb3JkKSsnJCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuJW1hcmtlZCUgY2xhc3M9XCJsYWJlbCBsYWJlbC13YXJuaW5nIGhhc1Rvb2x0aXBcIiBkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIiB0aXRsZT1cIicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5LnR5cGVzLmpvaW4oJyAnKSArICdcIj4nICsgZmlyc3RXb3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5yaWNoIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlRW5kSW5kZXhdID0gc3JjW3NvdXJjZUVuZEluZGV4XS5yZXBsYWNlKGxhc3RXb3JkLCBsYXN0V29yZCArICc8L3NwYW4lbWFya2VkJT4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2V0IGVudGl0eSBkYXRhXG4gICAgICAgICAgICB2YXIgaW5kID0gZW50aXR5TmFtZXMuaW5kZXhPZihlbnRpdHkubmFtZSk7XG4gICAgICAgICAgICB2YXIgbmV3RW50aXR5O1xuICAgICAgICAgICAgaWYoaW5kICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIG5ld0VudGl0eSA9IGVudGl0aWVzW2luZF07XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbaW5kXS5jb3VudCArPSAxO1xuICAgICAgICAgICAgICAgIGlmKGVudGl0aWVzW2luZF0uYXJ0aWNsZXMuaW5kZXhPZihhcnRpY2xlLmlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgZW50aXRpZXNbaW5kXS5hcnRpY2xlcy5wdXNoKGFydGljbGUuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihhcnRpY2xlLmVudGl0aWVzLmluZGV4T2YobmV3RW50aXR5LmlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZS5lbnRpdGllcy5wdXNoKG5ld0VudGl0eS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdFbnRpdHkgPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBlbnRpdHkuX2lkLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBlbnRpdHkubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2VudGl0eScsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICAgICAgICAgICAgICBhcnRpY2xlczogW2FydGljbGUuaWRdLFxuICAgICAgICAgICAgICAgICAgICB0eXBlczogW11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGFydGljbGUuZW50aXRpZXMucHVzaChuZXdFbnRpdHkuaWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBnZXQgdHlwZXNcbiAgICAgICAgICAgIGVudGl0eS50eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpe1xuICAgICAgICAgICAgICAgIC8vIGdldCB0eXBlIGRhdGFcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IHR5cGUuc3BsaXQoJzonKVsxXTtcbiAgICAgICAgICAgICAgICB2YXIgdGlkID0gJ3R5cGVfJytuYW1lO1xuICAgICAgICAgICAgICAgIHZhciBpbmQgPSB0eXBlTmFtZXMuaW5kZXhPZihuYW1lKTtcbiAgICAgICAgICAgICAgICBpZihpbmQgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzW2luZF0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgdHlwZXNbaW5kXS5lbnRpdGllcy5wdXNoKG5ld0VudGl0eS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzW2luZF0uYXJ0aWNsZXMucHVzaChhcnRpY2xlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYobmV3RW50aXR5LnR5cGVzLmluZGV4T2YodGlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VudGl0eS50eXBlcy5wdXNoKHRpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoYXJ0aWNsZS50eXBlcy5pbmRleE9mKHRpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlLnR5cGVzLnB1c2godGlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndHlwZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0aWVzOiBbbmV3RW50aXR5LmlkXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFydGljbGVzOiBbYXJ0aWNsZS5pZF0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZihuZXdFbnRpdHkudHlwZXMuaW5kZXhPZih0aWQpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RW50aXR5LnR5cGVzLnB1c2goJ3R5cGVfJytuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZihhcnRpY2xlLnR5cGVzLmluZGV4T2YodGlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFydGljbGUudHlwZXMucHVzaCgndHlwZV8nK25hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHR5cGVOYW1lcy5wdXNoKG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihpbmQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgZW50aXRpZXMucHVzaChuZXdFbnRpdHkpO1xuICAgICAgICAgICAgICAgIGVudGl0eU5hbWVzLnB1c2gobmV3RW50aXR5Lm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBqb2luIHNvdXJjZSBiYWNrXG4gICAgICAgIGl0ZW0uc291cmNlID0gc3JjLmpvaW4oJyAnKS5yZXBsYWNlKC9zcGFuJW1hcmtlZCUvZywgJ3NwYW4nKTtcbiAgICAgICAgYXJ0aWNsZS5zb3VyY2UgPSBpdGVtLnNvdXJjZTtcblxuICAgICAgICAvLyBwdXNoIHRvIGFycmF5XG4gICAgICAgIGFydGljbGVzLnB1c2goYXJ0aWNsZSk7XG4gICAgfSk7XG5cbiAgICAvLyBzb3J0IGFycmF5cyBieSBjb3VudFxuICAgIHZhciBzb3J0RnVuY3Rpb24gPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHJldHVybiBiLmNvdW50IC0gYS5jb3VudDtcbiAgICB9O1xuICAgIGVudGl0aWVzID0gZW50aXRpZXMuc29ydChzb3J0RnVuY3Rpb24pO1xuICAgIHR5cGVzID0gdHlwZXMuc29ydChzb3J0RnVuY3Rpb24pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgYXJ0aWNsZXM6IGFydGljbGVzLFxuICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgIGVudGl0aWVzOiBlbnRpdGllc1xuICAgIH07XG59O1xuXG4vLyBleHBvc2VcbmV4cG9ydHMucHJvY2Vzc0RhdGEgPSBwcm9jZXNzRGF0YTtcbiIsInZhciBkaWNlTWV0cmljID0gZnVuY3Rpb24gKHgsIHksIHh5KSB7XG4gICAgcmV0dXJuIDIgKiB4eSAvICh4ICsgeSk7XG59O1xuXG52YXIgZ2V0Q29tbW9uQXJ0aWNsZXMgPSBmdW5jdGlvbihlbnRpdHksIGVudGl0eURvdWJsZSkge1xuICAgIHZhciBjb21tb24gPSBfLmludGVyc2VjdGlvbihlbnRpdHkuYXJ0aWNsZXMsIGVudGl0eURvdWJsZS5hcnRpY2xlcyk7XG4gICAgcmV0dXJuIGNvbW1vbiA/IGNvbW1vbi5sZW5ndGggOiAwO1xufTtcblxudmFyIHByb2Nlc3NEYXRhID0gZnVuY3Rpb24oY29ycHVzKSB7XG4gICAgLy8gZW50aXRpZXMgYXJyYXlcbiAgICB2YXIgZW50aXRpZXMgPSB7fTtcbiAgICAvLyBmaW5kIG1pbiwgbWF4LCBhdmcgb2YgZW50aXRpZXNcbiAgICB2YXIgZW50aXRpZXNNaW4sIGVudGl0aWVzTWF4LCBlbnRpdGllc0F2ZztcbiAgICB2YXIgZW50aXRpZXNUb3RhbCA9IDA7XG4gICAgLy8gZ28gdGhyb3VnaCBhbGwgYXJ0aWNsZXNcbiAgICBjb3JwdXMuYXJ0aWNsZXMuZm9yRWFjaChmdW5jdGlvbihhcnRpY2xlKSB7XG4gICAgICAgIC8vIGNhbGN1bGF0ZSBzdHVmZlxuICAgICAgICB2YXIgY291bnQgPSBhcnRpY2xlLmVudGl0aWVzLmxlbmd0aDtcbiAgICAgICAgZW50aXRpZXNUb3RhbCArPSBjb3VudDtcbiAgICAgICAgZW50aXRpZXNNaW4gPSBfLm1pbihbZW50aXRpZXNNaW4sIGNvdW50XSk7XG4gICAgICAgIGVudGl0aWVzTWF4ID0gXy5tYXgoW2VudGl0aWVzTWluLCBjb3VudF0pO1xuICAgICAgICAvLyBhZGQgZW50aXRpZXMgdG8gYWxsIGFycmF5XG4gICAgICAgIGFydGljbGUuZW50aXRpZXMuZm9yRWFjaChmdW5jdGlvbihlbnRpdHkpIHtcbiAgICAgICAgICAgIGlmKGVudGl0aWVzW2VudGl0eS51cmldKSB7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uY291bnQrKztcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXS5hcnRpY2xlcy5wdXNoKGFydGljbGUuX2lkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0gPSBlbnRpdHk7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uY291bnQgPSAxO1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldLmFydGljbGVzID0gW2FydGljbGUuX2lkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8gY291bnQgYXZlcmFnZVxuICAgIGVudGl0aWVzQXZnID0gTWF0aC5mbG9vcihlbnRpdGllc1RvdGFsIC8gY29ycHVzLmFydGljbGVzLmxlbmd0aCk7XG5cbiAgICAvLyBwcmVwYXJlIHZhcnMgZm9yIGZpbmFsIGRhdGFcbiAgICB2YXIgcmVsYXRpb25zID0gW107XG4gICAgdmFyIHNjb3JlcyA9IFtdO1xuICAgIHZhciBlbnRpdHlOYW1lcyA9IFtdO1xuICAgIHZhciBlbnRpdHlVUklzID0gW107XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICAvLyB0ZW1wIGFycmF5c1xuICAgIHZhciB0bXAgPSBbXTtcbiAgICB2YXIgdG1wNCA9IFtdO1xuXG4gICAgLy8gcHJvY2Vzc1xuICAgIGZvcih2YXIgZWtleSBpbiBlbnRpdGllcykge1xuICAgICAgICB2YXIgZW50aXR5ID0gZW50aXRpZXNbZWtleV07XG4gICAgICAgIC8vIHByZXBhcmUgcm93IGRhdGFcbiAgICAgICAgdmFyIHJvdyA9IFtdO1xuICAgICAgICB2YXIgc2NvcmUgPSBbXTtcblxuICAgICAgICAvLyBnbyB0aHJvdWdoIGVudGl0aWVzIGFnYWluXG4gICAgICAgIGZvcih2YXIgZWtleTIgaW4gZW50aXRpZXMpIHtcbiAgICAgICAgICAgIHZhciBlbnRpdHlEb3VibGUgPSBlbnRpdGllc1tla2V5Ml07XG4gICAgICAgICAgICBpZiAoZW50aXR5LnVyaSA9PT0gZW50aXR5RG91YmxlLnVyaSkge1xuICAgICAgICAgICAgICAgIHJvdy5wdXNoKDApO1xuICAgICAgICAgICAgICAgIHNjb3JlLnB1c2goMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBlbnRpdHkuX2lkICsgJy0nICsgZW50aXR5RG91YmxlLl9pZDtcbiAgICAgICAgICAgICAgICB2YXIgcmV2ZXJzZUtleSA9IGVudGl0eURvdWJsZS5faWQgKyAnLScgKyBlbnRpdHkuX2lkO1xuICAgICAgICAgICAgICAgIGlmICh0bXAuaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaCh0bXBba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3JlLnB1c2godG1wNFtrZXldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRtcC5pbmRleE9mKHJldmVyc2VLZXkpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaCh0bXBbcmV2ZXJzZUtleV0pO1xuICAgICAgICAgICAgICAgICAgICBzY29yZS5wdXNoKHRtcDRbcmV2ZXJzZUtleV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZ2l2ZSBtZSB0aGUgbnVtYmVyIG9mIGFydGljbGVzIHRoYXQgaGF2ZSBib3RoICAkaSBbJ3VyaSddIGFuZCAkaiBbJ3VyaSddIGVudGl0aWVzXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb21tb25Db3VudCA9IGdldENvbW1vbkFydGljbGVzKGVudGl0eSwgZW50aXR5RG91YmxlKTtcbiAgICAgICAgICAgICAgICAgICAgdG1wW2tleV0gPSBjb21tb25Db3VudDtcbiAgICAgICAgICAgICAgICAgICAgcm93LnB1c2godG1wW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICB0bXA0W2tleV0gPSBbZGljZU1ldHJpYyhlbnRpdHkuYXJ0aWNsZXMubGVuZ3RoLCBlbnRpdHlEb3VibGUuYXJ0aWNsZXMubGVuZ3RoLCBjb21tb25Db3VudCldO1xuICAgICAgICAgICAgICAgICAgICBzY29yZS5wdXNoKHRtcDRba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcHVzaCBkYXRhIGlmIG5lZWRlZFxuICAgICAgICAvLyBwdXNoIG5hbWVcbiAgICAgICAgaWYgKGVudGl0eU5hbWVzLmluZGV4T2YoZW50aXR5Lm5hbWUpID09PSAtMSkge1xuICAgICAgICAgICAgZW50aXR5TmFtZXMucHVzaChlbnRpdHkubmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgZW50aXR5TmFtZXMucHVzaChlbnRpdHkubmFtZSArICcjJyArIGluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBwdXNoIHVyaVxuICAgICAgICBlbnRpdHlVUklzLnB1c2goZW50aXR5LnVyaSk7XG4gICAgICAgIC8vIHJlbGF0aW9uc1xuICAgICAgICByZWxhdGlvbnMucHVzaChyb3cpO1xuICAgICAgICAvLyBzY29yZXNcbiAgICAgICAgc2NvcmVzLnB1c2goc2NvcmUpO1xuICAgIH1cblxuICAgIC8vIGdldCB0aHJlc2hvbGQgZnJvbSBtaWRkbGUgb2Ygc2NvcmVzXG4gICAgdmFyIHNvcnRlZFNjb3JlcyA9IFtdO1xuICAgIC8vIGdldCBzY29yZXNcbiAgICBzY29yZXMuZm9yRWFjaChmdW5jdGlvbihzY29yZSkge1xuICAgICAgICBzY29yZS5mb3JFYWNoKGZ1bmN0aW9uKG51bSkge1xuICAgICAgICAgICAgaWYobnVtID4gMCkge1xuICAgICAgICAgICAgICAgIHNvcnRlZFNjb3Jlcy5wdXNoKG51bVswXSk7XG4gICAgICAgICAgICAgICAgdGhyZXNob2xkICs9IG51bTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy8gc29ydFxuICAgIHNvcnRlZFNjb3JlcyA9IHNvcnRlZFNjb3Jlcy5zb3J0KCk7XG4gICAgLy8gZ2V0IHRocmVzaG9sZFxuICAgIHZhciBjZW50ZXIgPSBNYXRoLmZsb29yKHNvcnRlZFNjb3Jlcy5sZW5ndGggLyAyKTtcbiAgICB2YXIgdGhyZXNob2xkID0gc29ydGVkU2NvcmVzW2NlbnRlcl07XG5cbiAgICAvL3JlbW92ZSBub2lzZXNcbiAgICBzY29yZXMuZm9yRWFjaChmdW5jdGlvbihyb3csIGluZGV4KXtcbiAgICAgICAgcm93LmZvckVhY2goZnVuY3Rpb24oc2NvcmUsIHN1YmluZGV4KXtcbiAgICAgICAgICAgIGlmKHNjb3JlIDwgdGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgcmVsYXRpb25zW2luZGV4XVtzdWJpbmRleF0gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlbGF0aW9uczogcmVsYXRpb25zLFxuICAgICAgICBzY29yZXM6IHNjb3JlcyxcbiAgICAgICAgZW50aXR5TmFtZXM6IGVudGl0eU5hbWVzLFxuICAgICAgICBlbnRpdHlVUklzOiBlbnRpdHlVUklzXG4gICAgfTtcbn07XG5cbmV4cG9ydHMucHJvY2Vzc0RhdGEgPSBwcm9jZXNzRGF0YTsiLCIvLyBnZXQgZXh0ZW50aW9uc1xudmFyIGV4dGVudGlvbnMgPSByZXF1aXJlKCcuLi9kYXRhL2NvcnB1c2V4dGVudGlvbnMnKTtcblxuLy8gaW5pdCBtb2R1bGVcbnZhciBjb3JwdXNNb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnQ29ycHVzTW9kdWxlJywgWyd1aS5yb3V0ZXInXSk7XG5cbi8vIGNvbmZpZyByb3V0ZXNcbmNvcnB1c01vZHVsZS5jb25maWcoZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAvLyBtYWluIHZpZXdcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29ycHVzJywge1xuICAgICAgICB1cmw6ICcvY29ycHVzLzppZCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL2NvcnB1cy9tYWluJyksXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3RlbXBsYXRlcy9jb3JwdXNWaWV3Lmh0bWwnLFxuICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICBjb3JwdXM6IFsnJGh0dHAnLCAnJHN0YXRlUGFyYW1zJywgZnVuY3Rpb24oJGh0dHAsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cCh7bWV0aG9kOiAnR0VUJywgdXJsOiAnL2FwaS9jb3JwdXMvJyArICRzdGF0ZVBhcmFtcy5pZH0pO1xuICAgICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gbWFrZSB2aWV3IHJvdXRlcyBmb3IgZXh0ZW50aW9uc1xuICAgIGV4dGVudGlvbnMuZm9yRWFjaChmdW5jdGlvbihleCkge1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29ycHVzLicgKyBleC5uYW1lLCB7XG4gICAgICAgICAgICB1cmw6IGV4LnBhdGgsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZXgudGVtcGxhdGUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBleC5jb250cm9sbGVyLFxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vLyByZWdpc3RlciBjb250cm9sbGVyc1xuZXh0ZW50aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGV4KSB7XG4gICAgY29ycHVzTW9kdWxlLmNvbnRyb2xsZXIoZXguY29udHJvbGxlciwgWyckc2NvcGUnLCAnJHN0YXRlJywgJyRzY2UnLCBleC5qc10pO1xufSk7XG5cbi8vIGV4cG9ydFxubW9kdWxlLmV4cG9ydHMgPSBjb3JwdXNNb2R1bGU7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGFwcGx5Um91dGVzIChhcHApIHtcbiAgICBhcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHsgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJywgdGVtcGxhdGU6ICcnIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvYXV0aCcsIHsgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcicsIHRlbXBsYXRlOiAnJyB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL3JlZ2lzdGVyJywgeyBjb250cm9sbGVyOiAnUmVnaXN0ZXJDb250cm9sbGVyJywgdGVtcGxhdGU6ICcnIH0pO1xuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvY3JlYXRlQ29ycHVzJywgeyBjb250cm9sbGVyOiAnQ3JlYXRlQ29ycHVzQ29udHJvbGxlcicsIHRlbXBsYXRlVXJsOiAnL3RlbXBsYXRlcy9jcmVhdGVDb3JwdXMuaHRtbCcgfSk7XG5cbiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuICAgIH1dKTtcbn07IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseVNlcnZpY2VzIChhcHApIHtcbn07XG4iXX0=
