(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function applyControllers (app) {
    app.controller('HomeController', ['$scope', require('./controllers/home.js')]);
    app.controller('RegisterController', ['$scope', require('./controllers/register.js')]);
    app.controller('ProfileController', ['$scope', require('./controllers/profile.js')]);
    app.controller('CreateCorpusController', ['$scope', require('./controllers/createcorpus.js')]);
};
},{"./controllers/createcorpus.js":7,"./controllers/home.js":8,"./controllers/profile.js":9,"./controllers/register.js":10}],2:[function(require,module,exports){
// includes
var CoocProcesser = require('../../modules/CoocProcesser');
var d3 = window.d3 || null;

var matrix_mouseover = function (p) {
    var g = d3.select(this).node();
    $('#'+g.id).css('cursor','pointer');
    d3.selectAll('.row text').classed('active', function(d, i) { return i === p.y; });
    d3.selectAll('.column text').classed('active', function(d, i) { return i === p.x; });
};

var matrix_mouseout = function () {
    d3.selectAll('text').classed('active', false);
};

var matrix_order = function (svg,orders,x,value) {
    x.domain(orders[value]);

    var t = svg.transition().duration(1500);
    t.selectAll('.row')
        .delay(function(d, i) { return x(i) * 4; })
        .attr('transform', function(d, i) { return 'translate(0,' + x(i) + ')'; })
        .selectAll('.cell')
        .delay(function(d) { return x(d.x) * 4; })
        .attr('x', function(d) { return x(d.x); });

    t.selectAll('.column')
        .delay(function(d, i) { return x(i) * 4; })
        .attr('transform', function(d, i) { return 'translate(' + x(i) + ')rotate(-90)'; });
};

 //renders the d3 graph
var createCoocMatrix = function (miserables, container) {
    var margin = {top: 80, right: 0, bottom: 10, left: 80};
    var width = 1000;
    var height = 1000;

    var x = d3.scale.ordinal().rangeBands([0, width]);
    var z = d3.scale.linear().domain([0, 4]).clamp(true);
    var c = d3.scale.category20().domain(d3.range(20));

    var svg = d3.select(container).append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .style('margin-left', -margin.left + 'px')
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    var matrix = [];
    var nodes = miserables.nodes;
    var n = nodes.length;

    // Compute index per node.
    nodes.forEach(function(node, i) {
        node.index = i;
        node.count = 0;
        matrix[i] = d3.range(n).map(function(j) { return {x: j, y: i, z: 0}; });
    });

    // Convert links to matrix; count character occurrences.
    miserables.links.forEach(function(link) {
        matrix[link.source][link.target].z += link.value;
        matrix[link.target][link.source].z += link.value;
        matrix[link.source][link.source].z += link.value;
        matrix[link.target][link.target].z += link.value;
        nodes[link.source].count += link.value;
        nodes[link.target].count += link.value;
    });
    // Precompute the orders.
    var orders = {
        name: d3.range(n).sort(function(a, b) { return d3.ascending(nodes[a].name, nodes[b].name); }),
        count: d3.range(n).sort(function(a, b) { return nodes[b].count - nodes[a].count; }),
        group: d3.range(n).sort(function(a, b) { return nodes[b].group - nodes[a].group; })
    };
    // The default sort order.
    x.domain(orders.name);
    svg.append('rect')
        .attr('class', 'cell-background')
        .attr('width', width)
        .attr('height', height);

    var processRow = function (row) {
        var cell = d3.select(this).selectAll('.cell')
            .data(row.filter(function(d) { return d.z; }))
            .enter().append('rect')
            .attr('class', 'cell')
            .attr('x', function(d) { return x(d.x); })
            .attr('width', x.rangeBand())
            .attr('height', x.rangeBand())
            .attr('id', function(d) { return 'rel_'+nodes[d.x].index+'_'+nodes[d.y].index; })
            .style('fill-opacity', function(d) { return z(d.z); })
            .style('fill', function(d) { return nodes[d.x].group === nodes[d.y].group ? c(nodes[d.x].group) : null; })
            .on('mouseover', matrix_mouseover)
            .on('mouseout', function(d) { matrix_mouseout(d); });
    };

    var row = svg.selectAll('.row')
        .data(matrix)
        .enter().append('g')
        .attr('class', 'row')
        .attr('transform', function(d, i) { return 'translate(0,' + x(i) + ')'; })
        .each(processRow);

    row.append('line').attr('x2', width);

    row.append('text')
        .attr('x', -6)
        .attr('y', x.rangeBand() / 2)
        .attr('dy', '.32em')
        .attr('text-anchor', 'end')
        .attr('id', function(d, i) { return 'node_'+nodes[i].index; })
        .attr('title', function(d, i) { return nodes[i].uri; })
        .text(function(d, i) { return nodes[i].name; });

    var column = svg.selectAll('.column')
        .data(matrix)
        .enter().append('g')
        .attr('class', 'column')
        .attr('transform', function(d, i) { return 'translate(' + x(i) + ')rotate(-90)'; });

    column.append('line')
        .attr('x1', -width);

    column.append('text')
        .attr('x', 6)
        .attr('y', x.rangeBand() / 2)
        .attr('dy', '.32em')
        .attr('id', function(d, i) { return 'node_'+nodes[i].index; })
        .attr('title', function(d, i) { return nodes[i].uri; })
        .attr('text-anchor', 'start')
        .text(function(d, i) { return nodes[i].name; });

    $(container).append('<div class="matrix-color-legend"><table cellpadding="5" cellspacing="3"></table></div>');
    var not_repeat=[];
    $.each(miserables.nodes,function(i,v){
        if(not_repeat.indexOf(v.group) === -1){
            not_repeat.push(v.group);
            $(container+' .matrix-color-legend table').append('<tr style="color:#FFF;background-color:'+c(v.group)+'"><td>'+miserables.groups[v.group]+'</td></tr>');
        }
    });
    $(container+' .matrix-color-legend').attr('style','position:absolute;top:300px;right:10px;overflow:hidden;');

    var timeout = setTimeout(function() {
        matrix_order(svg,orders,x,'group');
    }, 500);
};

module.exports = function CorpusCoocController($scope, $state, $sce) {
    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/cooc', function(data) {
        var processedData = CoocProcesser.processData(data);
        createCoocMatrix(processedData,'#coocContainer');
    });
};

},{"../../modules/CoocProcesser":17}],3:[function(require,module,exports){
// includes
var FacetsProcesser = require('../../modules/FacetsProcesser');

// data
var facetsData;
var types, entities, articles;

module.exports = function CorpusFacetsController($scope, $state, $sce) {
    // init empty facet filters
    $scope.typeFilter = undefined;
    $scope.entityFilter = undefined;
    $scope.articleFilter = undefined;

    $scope.setFilter = function(item) {
        switch(item.type) {
            case 'article':
                if($scope.articleFilter === item.id) {
                    $scope.articleFilter = undefined;
                } else {
                    $scope.articleFilter = item.id;
                }
                break;
            case 'entity':
                if($scope.entityFilter === item.id) {
                    $scope.entityFilter = undefined;
                } else {
                    $scope.entityFilter = item.id;
                }
                break;
            case 'type':
                if($scope.typeFilter === item.id) {
                    $scope.typeFilter = undefined;
                } else {
                    $scope.typeFilter = item.id;
                }
                break;
        }
    };

    $scope.itemActive = function(item) {
        switch(item.type) {
            case 'article':
                return $scope.articleFilter === item.id;
            case 'entity':
                return $scope.entityFilter === item.id;
            case 'type':
                return $scope.typeFilter === item.id;
        }
    };

    $scope.facetFilter = function (item) {
        var filterArticle = false;
        var filterEntity = false;
        var filterType = false;

        switch(item.type) {
            case 'article':
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterEntity && filterType;
            case 'entity':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.typeFilter !== undefined) {
                    filterType = item.types.indexOf($scope.typeFilter) !== -1;
                } else {
                    filterType = true;
                }
                return filterArticle && filterType;
            case 'type':
                if($scope.articleFilter !== undefined) {
                    filterArticle = item.articles.indexOf($scope.articleFilter) !== -1;
                } else {
                    filterArticle = true;
                }
                if($scope.entityFilter !== undefined) {
                    filterEntity = item.entities.indexOf($scope.entityFilter) !== -1;
                } else {
                    filterEntity = true;
                }
                return filterArticle && filterEntity;
        }
    };

    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/facets', function(data) {
        facetsData = FacetsProcesser.processData(data);

        // types
        types = facetsData.types;
        // entities
        entities = facetsData.entities;
        // articles
        articles = facetsData.articles;
        for(var i = 0; i < articles.length; i++) {
            articles[i].sourceSafe = $sce.trustAsHtml(articles[i].source);
        }
        // update data in scope
        $scope.data = [
            {name: 'Articles', values: articles},
            {name: 'Types', values: types},
            {name: 'Entities', values: entities},
        ];

        // redraw
        $state.reload();
    });
};

},{"../../modules/FacetsProcesser":18}],4:[function(require,module,exports){
// extentions
var extentions = require('../../data/corpusextentions');

// default socket port
var defaultPort = '8081';

// corpus object
var currentCorpus = {
    uri: function() {
        var it = this.input_type;
        if(it === 'twitter') {
            return 'http://twitter.com/' + this.input;
        } else if(it === 'direct') {
            return '-';
        } else {
            return this.input;
        }
    }
};

// progress websocket
var initProgressWebsocket = function($scope) {
    var location = document.location.hostname + ':' + defaultPort + document.location.pathname.replace('/overview', '');
    console.log('connecting to socket', location);
    var socket = new WebSocket('ws://' + location);
    socket.onerror = function(err) {
        console.log(err);
    };
    socket.onopen = function () {
        $scope.$apply(function() {
            $scope.progress.show = true;
        });
    };
    socket.onmessage = function (event) {
        var data = JSON.parse(event.data);
        $scope.$apply(function() {
            $scope.progress.type = data.type;
            $scope.progress.progress = data.progress;
        });
    };
    socket.onclose = function () {
        $scope.$apply(function() {
            $scope.progress.show = false;
        });
    };
};

module.exports = function MainCorpusController($scope, $location, $state, corpus) {
    // set current corpus data
    currentCorpus = _.extend(currentCorpus, corpus.data);
    // expose corpus to scope
    $scope.currentCorpus = currentCorpus;

    // expose math
    $scope.Math = Math;
    // should show progress bar
    $scope.progress = {
        show: false,
        progress: 0,
        type: ''
    };

    // init extentions
    $scope.extentions = extentions;
    // expose state
    $scope.$state = $state;

    // render first view if needed
    $scope.$on('$viewContentLoaded', function onRender() {
        // init progress websocket if corpus is not processed yet
        if(!currentCorpus.processed) {
            initProgressWebsocket($scope);
        }

        // see if we need to change path
        var len = $location.path().split('/').length;
        // if page is just loaded
        if(len === 3) {
            // redirect to first subview
            $state.go('corpus.'+extentions[0].name);
        }
    });
};

},{"../../data/corpusextentions":12}],5:[function(require,module,exports){
module.exports = function CorpusOverviewController($scope, $state, $sce) {
    //console.log('corpus overview');
};

},{}],6:[function(require,module,exports){
// includes
var RelationsProcesser = require('../../modules/RelationsProcesser');
var d3 = window.d3 || null;

// fade for d3
var fade = function (opacity, svg) {
    return function(d, i) {
        svg.selectAll('path.chord')
            .filter(function(d) { return d.source.index !== i && d.target.index !== i; })
            .transition().style('stroke-opacity', opacity)
            .style('fill-opacity', opacity);
    };
};

//renders the d3 graph
var createRelChart = function (data, container){
    var matrix=data.relations;
    var scores=data.scores;
    var entityNames=data.entityNames;
    var entityURIs=data.entityURIs;
    //start d3
    var w = 1000,
    h = 900,
    r1 = h / 2,
    r0 = r1 - 80;
    var fill = d3.scale.category20c();

    var chord = d3.layout.chord()
        .padding(0.04)
        .sortSubgroups(d3.descending)
        .sortChords(d3.descending);

    var arc = d3.svg.arc()
        .innerRadius(r0)
        .outerRadius(r0 + 20);

    var svg = d3.select(container).append('svg:svg')
        .attr('width', w)
        .attr('height', h)
        .append('svg:g')
        .attr('transform', 'translate(' + w / 2 + ',' + h / 2 + ')');

    chord.matrix(matrix);

    var g = svg.selectAll('g.group')
        .data(chord.groups)
        .enter().append('svg:g')
        .attr('class', 'group')
        .on('mouseover', fade(0.02, svg))
        .on('mouseout', fade(0.80, svg));
    g.append('svg:path')
        .style('stroke', function(d) { return fill(d.index); })
        .style('fill', function(d) { return fill(d.index); })
        .attr('id',function(d) { return 'path_'+d.index; })
        .attr('d', arc);

    g.append('svg:text')
        .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
        .attr('dy', '.35em')
        .attr('id',function(d) { return 'label_'+d.index; })
        .attr('text-anchor', function(d) { return d.angle > Math.PI ? 'end' : null; })
        .attr('transform', function(d) {
            return 'rotate(' + (d.angle * 180 / Math.PI - 90) + ')' +
                'translate(' + (r0 + 26) + ')' +
                (d.angle > Math.PI ? 'rotate(180)' : '');
        })
        .text(function(d) { return entityNames[d.index]; });

    svg.selectAll('path.chord')
        .data(chord.chords)
        .enter().append('svg:path')
        .attr('class', 'chord')
        .style('stroke', function(d) { return d3.rgb(fill(d.source.index)).darker(); })
        .style('fill', function(d) { return fill(d.source.index); })
        .attr('d', d3.svg.chord().radius(r0));

    $.each(entityNames,function(i,v){
        $('#label_'+i).mouseover(function() {
            var position = $('#label_'+i).position();
            //console.log(v);
            $('#relations').append('<div class="d3-rel-tooltip" style="top:'+(position.top+30)+'px;left:'+position.left+'px">'+v+'</div>');
            $('#label_'+i).css('fill',d3.select('#path_'+i).style('fill'));
            $('#label_'+i).css('cursor','pointer');
        });
        $('#label_'+i).mouseout(function() {
            $('#label_'+i).css('fill','#000');
            $('#relations .d3-rel-tooltip').remove();
        });
    });
};

module.exports = function CorpusRelationsController($scope, $state, $sce) {
    // get data
    $.getJSON('/api/corpus/' + $scope.currentCorpus._id + '/relations', function(data) {
        var processedData = RelationsProcesser.processData(data);
        createRelChart(processedData, '#relationsContainer');
    });
};

},{"../../modules/RelationsProcesser":19}],7:[function(require,module,exports){
var corpusTypes = require('../data/corpusTypes.js');
var nlpApis = require('../data/nlpApis.js');

module.exports = function CreateCorpusController($scope) {
    // collection of corpus types
    $scope.corpusTypes = corpusTypes;
    // collection of nlp apis
    $scope.nlpApis = nlpApis;

    // current corpus
    $scope.corpusSelection = {index: 0};
    $scope.currentCorpus = $scope.corpusTypes[0];

    // input slider reference
    var $inputCount, $sliderContainer;
    // update view slider
    var updateView = function() {
        $scope.currentCorpus = $scope.corpusTypes[$scope.corpusSelection.index];
        if($scope.currentCorpus.haveItems) {
            if(!$inputCount) {
                $sliderContainer = $('#slider_container');
                $inputCount = $('#input_count');
            } else {
                $inputCount.slider('destroy');
            }
            $sliderContainer.show();
            $inputCount.slider({
                min: $scope.currentCorpus.itemsMin,
                max: $scope.currentCorpus.itemsMax,
                step: 50,
                value: $scope.currentCorpus.itemsDefault,
                tooltip: 'always'
            });
        } else {
            $sliderContainer.hide();
        }
    };

    // update view on model change
    $scope.$watch('corpusSelection', updateView, true);

    // update slider
    $scope.$on('$viewContentLoaded', updateView);

    // analysis start function
    $scope.startAnalysis = function (e) {
        // prevent event
        e.preventDefault();
        // get fields
        var $inputItem = $('#input_item');
        var $inputItemArea = $('#input_item_area');
        var $inputItemFile = $('#input_item_file');
        var $inputCountField = $('input#input_count');
        var $newCorpusForm = $('#newcorpus_form');
        var $inputType = $('input[name=input_type]:checked');

        // remove old warning
        $inputItem.parent().removeClass('has-warning');

        // validate input
        var input = null;
        var corpusType = $scope.currentCorpus.name;
        var inputType = $scope.currentCorpus.inputType;
        switch(inputType) {
            case 'text':
                input = $inputItem.val().trim();
                break;
            case 'textarea':
                input = $inputItemArea.val().trim();
                break;
            case 'file':
                input = $inputItemFile.val();
                break;
        }

        if (!input) {
            $inputItem.parent().addClass('has-warning');
            return;
        }

        // append csrf token to form url
        $newCorpusForm.attr('action', '/api/corpus?_csrf=' + encodeURIComponent($scope.csrf));

        // assign count to input field
        var itemCount = $inputCount.slider('getValue');
        $inputCountField.val(itemCount);

        // remove unneeded inputs & rename last one
        switch(inputType) {
            case 'text':
                $inputItem.attr('name', 'input');
                $inputItemArea.remove();
                $inputItemFile.remove();
                break;
            case 'textarea':
                $inputItem.remove();
                $inputItemArea.attr('name', 'input');
                $inputItemFile.remove();
                break;
            case 'file':
                $inputItem.remove();
                $inputItemArea.remove();
                $inputCountField.remove();
                $inputItemFile.attr('name', 'input');
                break;
        }

        // swap input type value
        $inputType.val(corpusType);

        // send to server
        $newCorpusForm.submit();
    };
};

},{"../data/corpusTypes.js":11,"../data/nlpApis.js":13}],8:[function(require,module,exports){
module.exports = function HomeController($scope) {
    // corpus model
    $scope.corpus = '0';
    // on corpus select event
    $scope.corpusSelect = function() {
        // do not do anything if it's dummy entry
        if($scope.corpus === '0') {
            return;
        }
        // redirect to corpus
        window.location = '/corpus/' + $scope.corpus;
    };
};

},{}],9:[function(require,module,exports){
module.exports = function ProfileController($scope) {
    //
};

},{}],10:[function(require,module,exports){
module.exports = function RegisterController($scope) {
    //
};

},{}],11:[function(require,module,exports){
// build collection of items
var collection = [];
// rss
collection.push({
    name: 'feed',
    description: 'RSS/RDF/ATOM Feed',
    inputType: 'text',
    inputDescription: 'URL of the RSS/RDF/ATOM feed',
    inputPlaceholder: 'URL of your feed',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 600,
    itemsDefault: 50,
});
// wordpress
collection.push({
    name: 'wordpress',
    description: 'WordPress Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// blogger
collection.push({
    name: 'blogger',
    description: 'Blogger Blog',
    inputType: 'text',
    inputDescription: 'Weblog URL',
    inputPlaceholder: 'URL of the blog',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 400,
    itemsDefault: 400,
});
// public twitter
collection.push({
    name: 'twitter',
    description: 'Public Twitter account',
    inputType: 'text',
    inputDescription: 'Twitter username',
    inputPlaceholder: 'Username',
    haveItems: true,
    itemsMin: 200,
    itemsMax: 1500,
    itemsDefault: 1000,
});
// slidewiki
collection.push({
    name: 'slidewiki',
    description: 'SlideWiki Deck',
    inputType: 'text',
    inputDescription: 'Deck ID',
    inputPlaceholder: 'Deck ID',
    haveItems: true,
    itemsMin: 50,
    itemsMax: 1000,
    itemsDefault: 400,
});
// webpage
collection.push({
    name: 'webpage',
    description: 'Web page',
    inputType: 'text',
    inputDescription: 'WebPage URL',
    inputPlaceholder: 'URL',
    haveItems: false,
});
// direct input
collection.push({
    name: 'directinput',
    description: 'Direct input',
    inputType: 'textarea',
    inputDescription: 'Your text/html',
    haveItems: false,
});
// upload a doc
collection.push({
    name: 'doc',
    description: 'Upload a document(s)',
    inputType: 'file',
    inputDescription: 'Document',
    haveItems: false,
});

// Our module now returns our view
module.exports = collection;

},{}],12:[function(require,module,exports){
var collection = [];
// overview
collection.push({
    name: 'Overview',
    path: '/overview',
    controller: 'CorpusOverviewController',
    template: '/templates/corpusOverview.html',
    js: require('../controllers/corpus/overview.js'),
});
// facets
collection.push({
    name: 'Facets',
    path: '/facets',
    controller: 'CorpusFacetsController',
    template: '/templates/corpusFacets.html',
    js: require('../controllers/corpus/facets.js'),
});
// relations
collection.push({
    name: 'Entity relations',
    path: '/relations',
    controller: 'CorpusRelationsController',
    template: '/templates/corpusEntityRelations.html',
    js: require('../controllers/corpus/relations.js'),
});
// co-occurance
collection.push({
    name: 'Co-occurrence matrix',
    path: '/cooc',
    controller: 'CorpusCoocController',
    template: '/templates/corpusCooc.html',
    js: require('../controllers/corpus/cooc.js'),
});

// Our module now returns our view
module.exports = collection;
},{"../controllers/corpus/cooc.js":2,"../controllers/corpus/facets.js":3,"../controllers/corpus/overview.js":5,"../controllers/corpus/relations.js":6}],13:[function(require,module,exports){
// build collection of items
var collection = [];
// spotlight
collection.push({
    id: 'DBpedia-Spotlight',
    name: 'DBpedia Spotlight',
});
// fox
collection.push({
    id: 'FOX',
    name: 'FOX',
});
// german spotlight
collection.push({
    id: 'DBpedia-Spotlight-DE',
    name: 'DBpedia Spotlight (German)',
});

// Our module now returns our view
module.exports = collection;

},{}],14:[function(require,module,exports){
module.exports = function applyDirectives (app) {
};
},{}],15:[function(require,module,exports){
// load modules
var CorpusModule = require('./modules/corpus');

// init app
var app = angular.module('context-app', ['ngRoute', 'ngAnimate', 'mgcrea.ngStrap', 'CorpusModule']);

// config app routes
require('./routes')(app);

// config app services
require('./services')(app);

// init controllers
require('./controllers')(app);

// config app directives
require('./directives')(app);

// config app filters
require('./filters')(app);

},{"./controllers":1,"./directives":14,"./filters":16,"./modules/corpus":20,"./routes":21,"./services":22}],16:[function(require,module,exports){
module.exports = function applyFilters (app) {
};
},{}],17:[function(require,module,exports){
var diceMetric = function (x, y, xy) {
    return 2 * xy / (x + y);
};

var getCommonArticles = function(entity, entityDouble) {
    return _.intersection(entity.articles, entityDouble.articles);
};

var processData = function(corpus) {
    // entities array
    var entities = {};
    var types = [];
    // find min, max, avg of entities
    var entitiesMin, entitiesMax, entitiesAvg;
    var entitiesTotal = 0;
    // go through all articles
    corpus.articles.forEach(function(article) {
        // calculate stuff
        var count = article.entities.length;
        entitiesTotal += count;
        entitiesMin = _.min([entitiesMin, count]);
        entitiesMax = _.max([entitiesMin, count]);
        // add entities to all array
        article.entities.forEach(function(entity) {
            if(entities[entity.uri]) {
                entities[entity.uri].count++;
                entities[entity.uri].articles.push(article._id);
            } else {
                entities[entity.uri] = entity;
                entities[entity.uri].count = 1;
                entities[entity.uri].articles = [article._id];
            }
            // fill types
            entity.types.forEach(function(type) {
                if(types.indexOf(type) === -1) {
                    types.push(type);
                }
            });
        });
    });
    // count average
    entitiesAvg = Math.floor(entitiesTotal / corpus.articles.length);

    // prepare vars for final data
    var nodes = [];
    var links = [];
    var groups = [];
    var scores = [];
    var entityNames = [];
    var entityURIs = [];
    var index = 0;
    // temp arrays
    var tmp = [];

    // process
    var ekey, entity;
    for(ekey in entities) {
        entity = entities[ekey];
        // push uri
        entityURIs.push(entity.uri);
        // get type
        var type = entity.types[0];
        var typeId = types.indexOf(type);
        groups[typeId] = type;
        // push data
        if (entityNames.indexOf(entity.name) === -1) {
            entityNames.push(entity.name);
            nodes.push({name: entity.name, uri: entity.uri, group: typeId});
        } else {
            index++;
            entityNames.push(entity.name + '#' + index);
            nodes.push({name: entity.name + '#' + index, uri: entity.uri, group: typeId});
        }
    }

    // process
    for(ekey in entities) {
        entity = entities[ekey];
        // prepare row data
        var score = [];

        // go through entities again
        for(var ekey2 in entities) {
            var entityDouble = entities[ekey2];
            if (entity.uri !== entityDouble.uri) {
                var key = entity._id + '-' + entityDouble._id;
                var reverseKey = entityDouble._id + '-' + entity._id;
                if (tmp.indexOf(key) === -1 && tmp.indexOf(reverseKey) === -1) {
                    //give me the number of articles that have both  $i ['uri'] and $j ['uri'] entities
                    var common = getCommonArticles(entity, entityDouble);
                    var scoreValue = [diceMetric(entity.articles.length, entityDouble.articles.length, common.length)];
                    score.push(scoreValue);
                    links.push({
                        source: entityURIs.indexOf(entity.uri),
                        target: entityURIs.indexOf(entityDouble.uri),
                        value: common ? common.length : 0,
                        articles: common
                    });
                }
            }
        }

        // push scores
        scores.push(score);
    }

    // get threshold from middle of scores
    var sortedScores = [];
    // get scores
    scores.forEach(function(score) {
        score.forEach(function(num) {
            if(num > 0) {
                sortedScores.push(num[0]);
                threshold += num;
            }
        });
    });
    // sort
    sortedScores = sortedScores.sort();
    // get threshold
    var center = Math.floor(sortedScores.length / 2);
    var threshold = sortedScores[center];

    //remove noises
    scores.forEach(function(row, index){
        if(score < threshold) {
            links[index].value=0;
            links[index].articles='';
        }
    });

    return {
        nodes: nodes,
        links: links,
        groups: groups
    };
};

exports.processData = processData;
},{}],18:[function(require,module,exports){
var escapeRegExp = function(str) {
    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&');
};

var processData = function(data) {
    // articles
    var articles = [];
    // types
    var types = [];
    var typeNames = [];
    // entities
    var entities = [];
    var entityNames = [];

    // extract data
    data.articles.forEach(function(item) {
        // get article data
        var title = '';
        try {
            var dom = $(item.source);
            title = $('extracted-title', dom).text() || dom.text();
        } catch(e) {
            title = item.source;
        }
        title = title.slice(0, 30) + '...';
        var article = {
            id: item._id,
            name: title,
            type: 'article',
            count: 0,
            entities: [],
            types: [],
            source: item.source,
        };

        // get article plain text
        var sourceText = S(item.source).stripTags().s;
        // split plain text and full source into words
        var srcText = sourceText.split(/\s/);
        var src = item.source.split(/\s/);
        // split using additional characters for better processing
        for(var i = 0; i < srcText.length; i++) {
            var it = srcText[i];
            it = it.split('/');
            srcText[i] = it;
        }
        // flatten arrays
        srcText = _.flatten(srcText);

        var findSourceIndex = function(word, cleanWord, entityName, startIndex) {
            startIndex = startIndex || -1;
            // try to get plain match from original source
            var sourceIndex = src.indexOf(word, startIndex);
            // if not found, find by string
            if(sourceIndex === -1) {
                //if(entityName === testEntity) console.log('searching index in array');
                for(var i = 0; i < src.length; i++){
                    var srcWord = src[i];
                    // clean from hrefs
                    var srcWordClean = srcWord.replace(/href="(.+?)"(.*?>?)/, '').replace(/src="(.+?)"(.*?>?)/, '').replace(/alt="(.+?)"(.*?>?)/, '');
                    // skip if containes marking parts
                    if(srcWordClean.indexOf('span%marked%') !== -1) {
                        continue;
                    }

                    // check for match
                    if(srcWordClean.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) && i >= startIndex) {
                        sourceIndex = i;
                        break;
                    }
                }
            }

            return sourceIndex;
        };

        var cleanReg = /(^[\W]+)|([\W]+$)/g;
        var matchRegStart = '';
        var matchReg = '(\\W?)';

        // get entities
        item.entities.forEach(function(entity){
            var entityParts = entity.name.split(' ');

            // if only one word
            if(entityParts.length === 1) {
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    var entityClean = entity.name.replace(cleanReg, '');

                    // cehck match
                    if(cleanWord === entity.name || word === entity.name) {
                        // get match from original source
                        var sourceIndex = findSourceIndex(word, cleanWord, entity.name);
                        // if word was found
                        if(sourceIndex !== -1) {
                            var origSrc = src[sourceIndex];
                            var link = origSrc.match(/href="(.+?)"/);
                            var img = origSrc.match(/src="(.+?)"/);
                            var alt = origSrc.match(/alt="(.+?)"/);
                            if(link) {
                                link = link[1];
                                origSrc = origSrc.replace(link, '%link%');
                            }
                            if(img) {
                                img = img[1];
                                origSrc = origSrc.replace(img, '%img%');
                            }
                            if(alt) {
                                alt = alt[1];
                                origSrc = origSrc.replace(alt, '%alt%');
                            }

                            // enrich source
                            src[sourceIndex] = origSrc.replace(
                                entity.name,
                                '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                entity.types.join(' ') + '">' + entity.name + '</span%marked%>'
                            );

                            if(link) {
                                src[sourceIndex] = src[sourceIndex].replace('%link%', link);
                            }
                            if(img) {
                                src[sourceIndex] = src[sourceIndex].replace('%img%', img);
                            }
                            if(alt) {
                                src[sourceIndex] = src[sourceIndex].replace('%alt%', alt);
                            }
                        }

                        return;
                    }
                });
            } else {
                // check match
                var firstWord = entityParts[0];
                var lastWord = entityParts[entityParts.length-1];
                // find word that matches current entity
                srcText.forEach(function(word, index) {
                    // clean word from commas, dots and other suplementary stuff
                    var cleanWord = word.replace(cleanReg, '');
                    if(cleanWord.indexOf('span%marked%') !== -1) {
                        return;
                    }
                    // test match
                    var match = firstWord.match(new RegExp(matchRegStart+escapeRegExp(cleanWord)+matchReg)) !== null;
                    if(match) {
                        var i = 0;
                        for(i = 1; i < entityParts.length; i++) {
                            if(index+i >= srcText.length) {
                                continue;
                            }

                            var nextCleanWord = srcText[index+i].replace(cleanReg, '');
                            if(nextCleanWord.indexOf('span%marked%') !== -1) {
                                continue;
                            }
                            match = match && entityParts[i].match(new RegExp(matchRegStart+escapeRegExp(nextCleanWord)+matchReg)) !== null;
                        }

                        // check complete match
                        if(match) {
                            // Replace first part
                            // get match from original source
                            var sourceStartIndex = findSourceIndex(word, cleanWord, firstWord, index);

                            // Replace end part
                            var endIndex = index+entityParts.length-1;
                            if(endIndex >= srcText.length) {
                                return;
                            }
                            var endWord = srcText[endIndex];
                            var endCleanWord = endWord.replace(/[^\w]/, '');
                            // try to get plain match from original source for start
                            var sourceEndIndex = findSourceIndex(endWord, endCleanWord, lastWord, endIndex);

                            // if word was found
                            if(sourceStartIndex !== -1 && sourceEndIndex !== -1 && Math.abs(sourceStartIndex - sourceEndIndex) < 5) {
                                // enrich source
                                src[sourceStartIndex] = src[sourceStartIndex].replace(
                                    new RegExp(escapeRegExp(firstWord)+'$'),
                                    '<span%marked% class="label label-warning hasTooltip" data-toggle="tooltip" title="' +
                                    entity.types.join(' ') + '">' + firstWord
                                );

                                // enrich source
                                src[sourceEndIndex] = src[sourceEndIndex].replace(lastWord, lastWord + '</span%marked%>');
                            }
                        }
                        return;
                    }
                });
            }

            // get entity data
            var ind = entityNames.indexOf(entity.name);
            var newEntity;
            if(ind !== -1) {
                newEntity = entities[ind];
                entities[ind].count += 1;
                if(entities[ind].articles.indexOf(article.id) === -1) {
                    entities[ind].articles.push(article.id);
                }
                if(article.entities.indexOf(newEntity.id) === -1) {
                    article.entities.push(newEntity.id);
                }
            } else {
                newEntity = {
                    id: entity._id,
                    name: entity.name,
                    type: 'entity',
                    count: 1,
                    articles: [article.id],
                    types: []
                };
                article.entities.push(newEntity.id);
            }

            // get types
            entity.types.forEach(function(type){
                // get type data
                var name = type.split(':')[1];
                var tid = 'type_'+name;
                var ind = typeNames.indexOf(name);
                if(ind !== -1) {
                    types[ind].count += 1;
                    types[ind].entities.push(newEntity.id);
                    types[ind].articles.push(article.id);
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push(tid);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push(tid);
                    }
                } else {
                    types.push({
                        id: tid,
                        name: name,
                        type: 'type',
                        count: 1,
                        entities: [newEntity.id],
                        articles: [article.id],
                    });
                    if(newEntity.types.indexOf(tid) === -1) {
                        newEntity.types.push('type_'+name);
                    }
                    if(article.types.indexOf(tid) === -1) {
                        article.types.push('type_'+name);
                    }
                    typeNames.push(name);
                }
            });

            if(ind === -1) {
                entities.push(newEntity);
                entityNames.push(newEntity.name);
            }
        });

        // join source back
        item.source = src.join(' ').replace(/span%marked%/g, 'span');
        article.source = item.source;

        // push to array
        articles.push(article);
    });

    // sort arrays by count
    var sortFunction = function(a, b) {
        return b.count - a.count;
    };
    entities = entities.sort(sortFunction);
    types = types.sort(sortFunction);

    return {
        articles: articles,
        types: types,
        entities: entities
    };
};

// expose
exports.processData = processData;

},{}],19:[function(require,module,exports){
var diceMetric = function (x, y, xy) {
    return 2 * xy / (x + y);
};

var getCommonArticles = function(entity, entityDouble) {
    var common = _.intersection(entity.articles, entityDouble.articles);
    return common ? common.length : 0;
};

var processData = function(corpus) {
    // entities array
    var entities = {};
    // find min, max, avg of entities
    var entitiesMin, entitiesMax, entitiesAvg;
    var entitiesTotal = 0;
    // go through all articles
    corpus.articles.forEach(function(article) {
        // calculate stuff
        var count = article.entities.length;
        entitiesTotal += count;
        entitiesMin = _.min([entitiesMin, count]);
        entitiesMax = _.max([entitiesMin, count]);
        // add entities to all array
        article.entities.forEach(function(entity) {
            if(entities[entity.uri]) {
                entities[entity.uri].count++;
                entities[entity.uri].articles.push(article._id);
            } else {
                entities[entity.uri] = entity;
                entities[entity.uri].count = 1;
                entities[entity.uri].articles = [article._id];
            }
        });
    });
    // count average
    entitiesAvg = Math.floor(entitiesTotal / corpus.articles.length);

    // prepare vars for final data
    var relations = [];
    var scores = [];
    var entityNames = [];
    var entityURIs = [];
    var index = 0;
    // temp arrays
    var tmp = [];
    var tmp4 = [];

    // process
    for(var ekey in entities) {
        var entity = entities[ekey];
        // prepare row data
        var row = [];
        var score = [];

        // go through entities again
        for(var ekey2 in entities) {
            var entityDouble = entities[ekey2];
            if (entity.uri === entityDouble.uri) {
                row.push(0);
                score.push(0);
            } else {
                var key = entity._id + '-' + entityDouble._id;
                var reverseKey = entityDouble._id + '-' + entity._id;
                if (tmp.indexOf(key) !== -1) {
                    row.push(tmp[key]);
                    score.push(tmp4[key]);
                } else if (tmp.indexOf(reverseKey) !== -1) {
                    row.push(tmp[reverseKey]);
                    score.push(tmp4[reverseKey]);
                } else {
                    //give me the number of articles that have both  $i ['uri'] and $j ['uri'] entities
                    var commonCount = getCommonArticles(entity, entityDouble);
                    tmp[key] = commonCount;
                    row.push(tmp[key]);
                    tmp4[key] = [diceMetric(entity.articles.length, entityDouble.articles.length, commonCount)];
                    score.push(tmp4[key]);
                }
            }
        }

        // push data if needed
        // push name
        if (entityNames.indexOf(entity.name) === -1) {
            entityNames.push(entity.name);
        } else {
            index++;
            entityNames.push(entity.name + '#' + index);
        }
        // push uri
        entityURIs.push(entity.uri);
        // relations
        relations.push(row);
        // scores
        scores.push(score);
    }

    // get threshold from middle of scores
    var sortedScores = [];
    // get scores
    scores.forEach(function(score) {
        score.forEach(function(num) {
            if(num > 0) {
                sortedScores.push(num[0]);
                threshold += num;
            }
        });
    });
    // sort
    sortedScores = sortedScores.sort();
    // get threshold
    var center = Math.floor(sortedScores.length / 2);
    var threshold = sortedScores[center];

    //remove noises
    scores.forEach(function(row, index){
        row.forEach(function(score, subindex){
            if(score < threshold) {
                relations[index][subindex] = 0;
            }
        });
    });

    return {
        relations: relations,
        scores: scores,
        entityNames: entityNames,
        entityURIs: entityURIs
    };
};

exports.processData = processData;
},{}],20:[function(require,module,exports){
// get extentions
var extentions = require('../data/corpusextentions');

// init module
var corpusModule = angular.module('CorpusModule', ['ui.router']);

// config routes
corpusModule.config(function ($stateProvider, $urlRouterProvider) {
    // main view
    $stateProvider.state('corpus', {
        url: '/corpus/:id',
        controller: require('../controllers/corpus/main'),
        templateUrl: '/templates/corpusView.html',
        resolve: {
            corpus: ['$http', '$stateParams', function($http, $stateParams) {
                return $http({method: 'GET', url: '/api/corpus/' + $stateParams.id});
            }]
        }
    });

    // make view routes for extentions
    extentions.forEach(function(ex) {
        $stateProvider.state('corpus.' + ex.name, {
            url: ex.path,
            templateUrl: ex.template,
            controller: ex.controller,
        });
    });
});

// register controllers
extentions.forEach(function(ex) {
    corpusModule.controller(ex.controller, ['$scope', '$state', '$sce', ex.js]);
});

// export
module.exports = corpusModule;

},{"../controllers/corpus/main":4,"../data/corpusextentions":12}],21:[function(require,module,exports){
module.exports = function applyRoutes (app) {
    app.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
        $routeProvider.when('/', { controller: 'HomeController', template: '' });
        $routeProvider.when('/auth', { controller: 'LoginController', template: '' });
        $routeProvider.when('/register', { controller: 'RegisterController', template: '' });
        $routeProvider.when('/createCorpus', { controller: 'CreateCorpusController', templateUrl: '/templates/createCorpus.html' });

        $locationProvider.html5Mode(true);
    }]);
};
},{}],22:[function(require,module,exports){
module.exports = function applyServices (app) {
};

},{}]},{},[15])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY29ycHVzL2Nvb2MuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvZmFjZXRzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY29ycHVzL21haW4uanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvb3ZlcnZpZXcuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9jb3JwdXMvcmVsYXRpb25zLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvY3JlYXRlY29ycHVzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvY29udHJvbGxlcnMvaG9tZS5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2NvbnRyb2xsZXJzL3Byb2ZpbGUuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9jb250cm9sbGVycy9yZWdpc3Rlci5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2RhdGEvY29ycHVzVHlwZXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kYXRhL2NvcnB1c2V4dGVudGlvbnMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kYXRhL25scEFwaXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9kaXJlY3RpdmVzLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvZmFrZV9iNWUyYzNlNC5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL2ZpbHRlcnMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9tb2R1bGVzL0Nvb2NQcm9jZXNzZXIuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9tb2R1bGVzL0ZhY2V0c1Byb2Nlc3Nlci5qcyIsIi9Vc2Vycy95YW1hbGlnaHQvU2VydmVyL2NvbnRleHQvcHVibGljL2pzL21vZHVsZXMvUmVsYXRpb25zUHJvY2Vzc2VyLmpzIiwiL1VzZXJzL3lhbWFsaWdodC9TZXJ2ZXIvY29udGV4dC9wdWJsaWMvanMvbW9kdWxlcy9jb3JwdXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9yb3V0ZXMuanMiLCIvVXNlcnMveWFtYWxpZ2h0L1NlcnZlci9jb250ZXh0L3B1YmxpYy9qcy9zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7O0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYXBwbHlDb250cm9sbGVycyAoYXBwKSB7XG4gICAgYXBwLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgWyckc2NvcGUnLCByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL2hvbWUuanMnKV0pO1xuICAgIGFwcC5jb250cm9sbGVyKCdSZWdpc3RlckNvbnRyb2xsZXInLCBbJyRzY29wZScsIHJlcXVpcmUoJy4vY29udHJvbGxlcnMvcmVnaXN0ZXIuanMnKV0pO1xuICAgIGFwcC5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFsnJHNjb3BlJywgcmVxdWlyZSgnLi9jb250cm9sbGVycy9wcm9maWxlLmpzJyldKTtcbiAgICBhcHAuY29udHJvbGxlcignQ3JlYXRlQ29ycHVzQ29udHJvbGxlcicsIFsnJHNjb3BlJywgcmVxdWlyZSgnLi9jb250cm9sbGVycy9jcmVhdGVjb3JwdXMuanMnKV0pO1xufTsiLCIvLyBpbmNsdWRlc1xudmFyIENvb2NQcm9jZXNzZXIgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL0Nvb2NQcm9jZXNzZXInKTtcbnZhciBkMyA9IHdpbmRvdy5kMyB8fCBudWxsO1xuXG52YXIgbWF0cml4X21vdXNlb3ZlciA9IGZ1bmN0aW9uIChwKSB7XG4gICAgdmFyIGcgPSBkMy5zZWxlY3QodGhpcykubm9kZSgpO1xuICAgICQoJyMnK2cuaWQpLmNzcygnY3Vyc29yJywncG9pbnRlcicpO1xuICAgIGQzLnNlbGVjdEFsbCgnLnJvdyB0ZXh0JykuY2xhc3NlZCgnYWN0aXZlJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gaSA9PT0gcC55OyB9KTtcbiAgICBkMy5zZWxlY3RBbGwoJy5jb2x1bW4gdGV4dCcpLmNsYXNzZWQoJ2FjdGl2ZScsIGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIGkgPT09IHAueDsgfSk7XG59O1xuXG52YXIgbWF0cml4X21vdXNlb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgIGQzLnNlbGVjdEFsbCgndGV4dCcpLmNsYXNzZWQoJ2FjdGl2ZScsIGZhbHNlKTtcbn07XG5cbnZhciBtYXRyaXhfb3JkZXIgPSBmdW5jdGlvbiAoc3ZnLG9yZGVycyx4LHZhbHVlKSB7XG4gICAgeC5kb21haW4ob3JkZXJzW3ZhbHVlXSk7XG5cbiAgICB2YXIgdCA9IHN2Zy50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTUwMCk7XG4gICAgdC5zZWxlY3RBbGwoJy5yb3cnKVxuICAgICAgICAuZGVsYXkoZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4geChpKSAqIDQ7IH0pXG4gICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiAndHJhbnNsYXRlKDAsJyArIHgoaSkgKyAnKSc7IH0pXG4gICAgICAgIC5zZWxlY3RBbGwoJy5jZWxsJylcbiAgICAgICAgLmRlbGF5KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgoZC54KSAqIDQ7IH0pXG4gICAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24oZCkgeyByZXR1cm4geChkLngpOyB9KTtcblxuICAgIHQuc2VsZWN0QWxsKCcuY29sdW1uJylcbiAgICAgICAgLmRlbGF5KGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIHgoaSkgKiA0OyB9KVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgeChpKSArICcpcm90YXRlKC05MCknOyB9KTtcbn07XG5cbiAvL3JlbmRlcnMgdGhlIGQzIGdyYXBoXG52YXIgY3JlYXRlQ29vY01hdHJpeCA9IGZ1bmN0aW9uIChtaXNlcmFibGVzLCBjb250YWluZXIpIHtcbiAgICB2YXIgbWFyZ2luID0ge3RvcDogODAsIHJpZ2h0OiAwLCBib3R0b206IDEwLCBsZWZ0OiA4MH07XG4gICAgdmFyIHdpZHRoID0gMTAwMDtcbiAgICB2YXIgaGVpZ2h0ID0gMTAwMDtcblxuICAgIHZhciB4ID0gZDMuc2NhbGUub3JkaW5hbCgpLnJhbmdlQmFuZHMoWzAsIHdpZHRoXSk7XG4gICAgdmFyIHogPSBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4oWzAsIDRdKS5jbGFtcCh0cnVlKTtcbiAgICB2YXIgYyA9IGQzLnNjYWxlLmNhdGVnb3J5MjAoKS5kb21haW4oZDMucmFuZ2UoMjApKTtcblxuICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoY29udGFpbmVyKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcbiAgICAgICAgLnN0eWxlKCdtYXJnaW4tbGVmdCcsIC1tYXJnaW4ubGVmdCArICdweCcpXG4gICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgbWFyZ2luLmxlZnQgKyAnLCcgKyBtYXJnaW4udG9wICsgJyknKTtcblxuICAgIHZhciBtYXRyaXggPSBbXTtcbiAgICB2YXIgbm9kZXMgPSBtaXNlcmFibGVzLm5vZGVzO1xuICAgIHZhciBuID0gbm9kZXMubGVuZ3RoO1xuXG4gICAgLy8gQ29tcHV0ZSBpbmRleCBwZXIgbm9kZS5cbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsIGkpIHtcbiAgICAgICAgbm9kZS5pbmRleCA9IGk7XG4gICAgICAgIG5vZGUuY291bnQgPSAwO1xuICAgICAgICBtYXRyaXhbaV0gPSBkMy5yYW5nZShuKS5tYXAoZnVuY3Rpb24oaikgeyByZXR1cm4ge3g6IGosIHk6IGksIHo6IDB9OyB9KTtcbiAgICB9KTtcblxuICAgIC8vIENvbnZlcnQgbGlua3MgdG8gbWF0cml4OyBjb3VudCBjaGFyYWN0ZXIgb2NjdXJyZW5jZXMuXG4gICAgbWlzZXJhYmxlcy5saW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHtcbiAgICAgICAgbWF0cml4W2xpbmsuc291cmNlXVtsaW5rLnRhcmdldF0ueiArPSBsaW5rLnZhbHVlO1xuICAgICAgICBtYXRyaXhbbGluay50YXJnZXRdW2xpbmsuc291cmNlXS56ICs9IGxpbmsudmFsdWU7XG4gICAgICAgIG1hdHJpeFtsaW5rLnNvdXJjZV1bbGluay5zb3VyY2VdLnogKz0gbGluay52YWx1ZTtcbiAgICAgICAgbWF0cml4W2xpbmsudGFyZ2V0XVtsaW5rLnRhcmdldF0ueiArPSBsaW5rLnZhbHVlO1xuICAgICAgICBub2Rlc1tsaW5rLnNvdXJjZV0uY291bnQgKz0gbGluay52YWx1ZTtcbiAgICAgICAgbm9kZXNbbGluay50YXJnZXRdLmNvdW50ICs9IGxpbmsudmFsdWU7XG4gICAgfSk7XG4gICAgLy8gUHJlY29tcHV0ZSB0aGUgb3JkZXJzLlxuICAgIHZhciBvcmRlcnMgPSB7XG4gICAgICAgIG5hbWU6IGQzLnJhbmdlKG4pLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gZDMuYXNjZW5kaW5nKG5vZGVzW2FdLm5hbWUsIG5vZGVzW2JdLm5hbWUpOyB9KSxcbiAgICAgICAgY291bnQ6IGQzLnJhbmdlKG4pLnNvcnQoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gbm9kZXNbYl0uY291bnQgLSBub2Rlc1thXS5jb3VudDsgfSksXG4gICAgICAgIGdyb3VwOiBkMy5yYW5nZShuKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIG5vZGVzW2JdLmdyb3VwIC0gbm9kZXNbYV0uZ3JvdXA7IH0pXG4gICAgfTtcbiAgICAvLyBUaGUgZGVmYXVsdCBzb3J0IG9yZGVyLlxuICAgIHguZG9tYWluKG9yZGVycy5uYW1lKTtcbiAgICBzdmcuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtYmFja2dyb3VuZCcpXG4gICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KTtcblxuICAgIHZhciBwcm9jZXNzUm93ID0gZnVuY3Rpb24gKHJvdykge1xuICAgICAgICB2YXIgY2VsbCA9IGQzLnNlbGVjdCh0aGlzKS5zZWxlY3RBbGwoJy5jZWxsJylcbiAgICAgICAgICAgIC5kYXRhKHJvdy5maWx0ZXIoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC56OyB9KSlcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbCcpXG4gICAgICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIHgoZC54KTsgfSlcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHgucmFuZ2VCYW5kKCkpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgeC5yYW5nZUJhbmQoKSlcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICdyZWxfJytub2Rlc1tkLnhdLmluZGV4KydfJytub2Rlc1tkLnldLmluZGV4OyB9KVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsLW9wYWNpdHknLCBmdW5jdGlvbihkKSB7IHJldHVybiB6KGQueik7IH0pXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7IHJldHVybiBub2Rlc1tkLnhdLmdyb3VwID09PSBub2Rlc1tkLnldLmdyb3VwID8gYyhub2Rlc1tkLnhdLmdyb3VwKSA6IG51bGw7IH0pXG4gICAgICAgICAgICAub24oJ21vdXNlb3ZlcicsIG1hdHJpeF9tb3VzZW92ZXIpXG4gICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oZCkgeyBtYXRyaXhfbW91c2VvdXQoZCk7IH0pO1xuICAgIH07XG5cbiAgICB2YXIgcm93ID0gc3ZnLnNlbGVjdEFsbCgnLnJvdycpXG4gICAgICAgIC5kYXRhKG1hdHJpeClcbiAgICAgICAgLmVudGVyKCkuYXBwZW5kKCdnJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3JvdycpXG4gICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiAndHJhbnNsYXRlKDAsJyArIHgoaSkgKyAnKSc7IH0pXG4gICAgICAgIC5lYWNoKHByb2Nlc3NSb3cpO1xuXG4gICAgcm93LmFwcGVuZCgnbGluZScpLmF0dHIoJ3gyJywgd2lkdGgpO1xuXG4gICAgcm93LmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC5hdHRyKCd4JywgLTYpXG4gICAgICAgIC5hdHRyKCd5JywgeC5yYW5nZUJhbmQoKSAvIDIpXG4gICAgICAgIC5hdHRyKCdkeScsICcuMzJlbScpXG4gICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdlbmQnKVxuICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiAnbm9kZV8nK25vZGVzW2ldLmluZGV4OyB9KVxuICAgICAgICAuYXR0cigndGl0bGUnLCBmdW5jdGlvbihkLCBpKSB7IHJldHVybiBub2Rlc1tpXS51cmk7IH0pXG4gICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQsIGkpIHsgcmV0dXJuIG5vZGVzW2ldLm5hbWU7IH0pO1xuXG4gICAgdmFyIGNvbHVtbiA9IHN2Zy5zZWxlY3RBbGwoJy5jb2x1bW4nKVxuICAgICAgICAuZGF0YShtYXRyaXgpXG4gICAgICAgIC5lbnRlcigpLmFwcGVuZCgnZycpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdjb2x1bW4nKVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgeChpKSArICcpcm90YXRlKC05MCknOyB9KTtcblxuICAgIGNvbHVtbi5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cigneDEnLCAtd2lkdGgpO1xuXG4gICAgY29sdW1uLmFwcGVuZCgndGV4dCcpXG4gICAgICAgIC5hdHRyKCd4JywgNilcbiAgICAgICAgLmF0dHIoJ3knLCB4LnJhbmdlQmFuZCgpIC8gMilcbiAgICAgICAgLmF0dHIoJ2R5JywgJy4zMmVtJylcbiAgICAgICAgLmF0dHIoJ2lkJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gJ25vZGVfJytub2Rlc1tpXS5pbmRleDsgfSlcbiAgICAgICAgLmF0dHIoJ3RpdGxlJywgZnVuY3Rpb24oZCwgaSkgeyByZXR1cm4gbm9kZXNbaV0udXJpOyB9KVxuICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnc3RhcnQnKVxuICAgICAgICAudGV4dChmdW5jdGlvbihkLCBpKSB7IHJldHVybiBub2Rlc1tpXS5uYW1lOyB9KTtcblxuICAgICQoY29udGFpbmVyKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJtYXRyaXgtY29sb3ItbGVnZW5kXCI+PHRhYmxlIGNlbGxwYWRkaW5nPVwiNVwiIGNlbGxzcGFjaW5nPVwiM1wiPjwvdGFibGU+PC9kaXY+Jyk7XG4gICAgdmFyIG5vdF9yZXBlYXQ9W107XG4gICAgJC5lYWNoKG1pc2VyYWJsZXMubm9kZXMsZnVuY3Rpb24oaSx2KXtcbiAgICAgICAgaWYobm90X3JlcGVhdC5pbmRleE9mKHYuZ3JvdXApID09PSAtMSl7XG4gICAgICAgICAgICBub3RfcmVwZWF0LnB1c2godi5ncm91cCk7XG4gICAgICAgICAgICAkKGNvbnRhaW5lcisnIC5tYXRyaXgtY29sb3ItbGVnZW5kIHRhYmxlJykuYXBwZW5kKCc8dHIgc3R5bGU9XCJjb2xvcjojRkZGO2JhY2tncm91bmQtY29sb3I6JytjKHYuZ3JvdXApKydcIj48dGQ+JyttaXNlcmFibGVzLmdyb3Vwc1t2Lmdyb3VwXSsnPC90ZD48L3RyPicpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgJChjb250YWluZXIrJyAubWF0cml4LWNvbG9yLWxlZ2VuZCcpLmF0dHIoJ3N0eWxlJywncG9zaXRpb246YWJzb2x1dGU7dG9wOjMwMHB4O3JpZ2h0OjEwcHg7b3ZlcmZsb3c6aGlkZGVuOycpO1xuXG4gICAgdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBtYXRyaXhfb3JkZXIoc3ZnLG9yZGVycyx4LCdncm91cCcpO1xuICAgIH0sIDUwMCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIENvcnB1c0Nvb2NDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc2NlKSB7XG4gICAgLy8gZ2V0IGRhdGFcbiAgICAkLmdldEpTT04oJy9hcGkvY29ycHVzLycgKyAkc2NvcGUuY3VycmVudENvcnB1cy5faWQgKyAnL2Nvb2MnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBwcm9jZXNzZWREYXRhID0gQ29vY1Byb2Nlc3Nlci5wcm9jZXNzRGF0YShkYXRhKTtcbiAgICAgICAgY3JlYXRlQ29vY01hdHJpeChwcm9jZXNzZWREYXRhLCcjY29vY0NvbnRhaW5lcicpO1xuICAgIH0pO1xufTtcbiIsIi8vIGluY2x1ZGVzXG52YXIgRmFjZXRzUHJvY2Vzc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9GYWNldHNQcm9jZXNzZXInKTtcblxuLy8gZGF0YVxudmFyIGZhY2V0c0RhdGE7XG52YXIgdHlwZXMsIGVudGl0aWVzLCBhcnRpY2xlcztcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBDb3JwdXNGYWNldHNDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc2NlKSB7XG4gICAgLy8gaW5pdCBlbXB0eSBmYWNldCBmaWx0ZXJzXG4gICAgJHNjb3BlLnR5cGVGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgJHNjb3BlLmVudGl0eUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAkc2NvcGUuYXJ0aWNsZUZpbHRlciA9IHVuZGVmaW5lZDtcblxuICAgICRzY29wZS5zZXRGaWx0ZXIgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIHN3aXRjaChpdGVtLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FydGljbGUnOlxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5hcnRpY2xlRmlsdGVyID09PSBpdGVtLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnRpY2xlRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hcnRpY2xlRmlsdGVyID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdlbnRpdHknOlxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5lbnRpdHlGaWx0ZXIgPT09IGl0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVudGl0eUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZW50aXR5RmlsdGVyID0gaXRlbS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0eXBlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUudHlwZUZpbHRlciA9PT0gaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHlwZUZpbHRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHlwZUZpbHRlciA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5pdGVtQWN0aXZlID0gZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBzd2l0Y2goaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmFydGljbGVGaWx0ZXIgPT09IGl0ZW0uaWQ7XG4gICAgICAgICAgICBjYXNlICdlbnRpdHknOlxuICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZW50aXR5RmlsdGVyID09PSBpdGVtLmlkO1xuICAgICAgICAgICAgY2FzZSAndHlwZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS50eXBlRmlsdGVyID09PSBpdGVtLmlkO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5mYWNldEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHZhciBmaWx0ZXJBcnRpY2xlID0gZmFsc2U7XG4gICAgICAgIHZhciBmaWx0ZXJFbnRpdHkgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZpbHRlclR5cGUgPSBmYWxzZTtcblxuICAgICAgICBzd2l0Y2goaXRlbS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhcnRpY2xlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuZW50aXR5RmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyRW50aXR5ID0gaXRlbS5lbnRpdGllcy5pbmRleE9mKCRzY29wZS5lbnRpdHlGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJFbnRpdHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZigkc2NvcGUudHlwZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclR5cGUgPSBpdGVtLnR5cGVzLmluZGV4T2YoJHNjb3BlLnR5cGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckVudGl0eSAmJiBmaWx0ZXJUeXBlO1xuICAgICAgICAgICAgY2FzZSAnZW50aXR5JzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuYXJ0aWNsZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFydGljbGUgPSBpdGVtLmFydGljbGVzLmluZGV4T2YoJHNjb3BlLmFydGljbGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnR5cGVGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJUeXBlID0gaXRlbS50eXBlcy5pbmRleE9mKCRzY29wZS50eXBlRmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVHlwZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXJBcnRpY2xlICYmIGZpbHRlclR5cGU7XG4gICAgICAgICAgICBjYXNlICd0eXBlJzpcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuYXJ0aWNsZUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckFydGljbGUgPSBpdGVtLmFydGljbGVzLmluZGV4T2YoJHNjb3BlLmFydGljbGVGaWx0ZXIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnRpY2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmVudGl0eUZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckVudGl0eSA9IGl0ZW0uZW50aXRpZXMuaW5kZXhPZigkc2NvcGUuZW50aXR5RmlsdGVyKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyRW50aXR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlckFydGljbGUgJiYgZmlsdGVyRW50aXR5O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIGdldCBkYXRhXG4gICAgJC5nZXRKU09OKCcvYXBpL2NvcnB1cy8nICsgJHNjb3BlLmN1cnJlbnRDb3JwdXMuX2lkICsgJy9mYWNldHMnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGZhY2V0c0RhdGEgPSBGYWNldHNQcm9jZXNzZXIucHJvY2Vzc0RhdGEoZGF0YSk7XG5cbiAgICAgICAgLy8gdHlwZXNcbiAgICAgICAgdHlwZXMgPSBmYWNldHNEYXRhLnR5cGVzO1xuICAgICAgICAvLyBlbnRpdGllc1xuICAgICAgICBlbnRpdGllcyA9IGZhY2V0c0RhdGEuZW50aXRpZXM7XG4gICAgICAgIC8vIGFydGljbGVzXG4gICAgICAgIGFydGljbGVzID0gZmFjZXRzRGF0YS5hcnRpY2xlcztcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGFydGljbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcnRpY2xlc1tpXS5zb3VyY2VTYWZlID0gJHNjZS50cnVzdEFzSHRtbChhcnRpY2xlc1tpXS5zb3VyY2UpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBkYXRhIGluIHNjb3BlXG4gICAgICAgICRzY29wZS5kYXRhID0gW1xuICAgICAgICAgICAge25hbWU6ICdBcnRpY2xlcycsIHZhbHVlczogYXJ0aWNsZXN9LFxuICAgICAgICAgICAge25hbWU6ICdUeXBlcycsIHZhbHVlczogdHlwZXN9LFxuICAgICAgICAgICAge25hbWU6ICdFbnRpdGllcycsIHZhbHVlczogZW50aXRpZXN9LFxuICAgICAgICBdO1xuXG4gICAgICAgIC8vIHJlZHJhd1xuICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgfSk7XG59O1xuIiwiLy8gZXh0ZW50aW9uc1xudmFyIGV4dGVudGlvbnMgPSByZXF1aXJlKCcuLi8uLi9kYXRhL2NvcnB1c2V4dGVudGlvbnMnKTtcblxuLy8gZGVmYXVsdCBzb2NrZXQgcG9ydFxudmFyIGRlZmF1bHRQb3J0ID0gJzgwODEnO1xuXG4vLyBjb3JwdXMgb2JqZWN0XG52YXIgY3VycmVudENvcnB1cyA9IHtcbiAgICB1cmk6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaXQgPSB0aGlzLmlucHV0X3R5cGU7XG4gICAgICAgIGlmKGl0ID09PSAndHdpdHRlcicpIHtcbiAgICAgICAgICAgIHJldHVybiAnaHR0cDovL3R3aXR0ZXIuY29tLycgKyB0aGlzLmlucHV0O1xuICAgICAgICB9IGVsc2UgaWYoaXQgPT09ICdkaXJlY3QnKSB7XG4gICAgICAgICAgICByZXR1cm4gJy0nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQ7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyBwcm9ncmVzcyB3ZWJzb2NrZXRcbnZhciBpbml0UHJvZ3Jlc3NXZWJzb2NrZXQgPSBmdW5jdGlvbigkc2NvcGUpIHtcbiAgICB2YXIgbG9jYXRpb24gPSBkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSArICc6JyArIGRlZmF1bHRQb3J0ICsgZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgnL292ZXJ2aWV3JywgJycpO1xuICAgIGNvbnNvbGUubG9nKCdjb25uZWN0aW5nIHRvIHNvY2tldCcsIGxvY2F0aW9uKTtcbiAgICB2YXIgc29ja2V0ID0gbmV3IFdlYlNvY2tldCgnd3M6Ly8nICsgbG9jYXRpb24pO1xuICAgIHNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfTtcbiAgICBzb2NrZXQub25vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzLnNob3cgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHNvY2tldC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzLnR5cGUgPSBkYXRhLnR5cGU7XG4gICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3MucHJvZ3Jlc3MgPSBkYXRhLnByb2dyZXNzO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHNvY2tldC5vbmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLnByb2dyZXNzLnNob3cgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gTWFpbkNvcnB1c0NvbnRyb2xsZXIoJHNjb3BlLCAkbG9jYXRpb24sICRzdGF0ZSwgY29ycHVzKSB7XG4gICAgLy8gc2V0IGN1cnJlbnQgY29ycHVzIGRhdGFcbiAgICBjdXJyZW50Q29ycHVzID0gXy5leHRlbmQoY3VycmVudENvcnB1cywgY29ycHVzLmRhdGEpO1xuICAgIC8vIGV4cG9zZSBjb3JwdXMgdG8gc2NvcGVcbiAgICAkc2NvcGUuY3VycmVudENvcnB1cyA9IGN1cnJlbnRDb3JwdXM7XG5cbiAgICAvLyBleHBvc2UgbWF0aFxuICAgICRzY29wZS5NYXRoID0gTWF0aDtcbiAgICAvLyBzaG91bGQgc2hvdyBwcm9ncmVzcyBiYXJcbiAgICAkc2NvcGUucHJvZ3Jlc3MgPSB7XG4gICAgICAgIHNob3c6IGZhbHNlLFxuICAgICAgICBwcm9ncmVzczogMCxcbiAgICAgICAgdHlwZTogJydcbiAgICB9O1xuXG4gICAgLy8gaW5pdCBleHRlbnRpb25zXG4gICAgJHNjb3BlLmV4dGVudGlvbnMgPSBleHRlbnRpb25zO1xuICAgIC8vIGV4cG9zZSBzdGF0ZVxuICAgICRzY29wZS4kc3RhdGUgPSAkc3RhdGU7XG5cbiAgICAvLyByZW5kZXIgZmlyc3QgdmlldyBpZiBuZWVkZWRcbiAgICAkc2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiBvblJlbmRlcigpIHtcbiAgICAgICAgLy8gaW5pdCBwcm9ncmVzcyB3ZWJzb2NrZXQgaWYgY29ycHVzIGlzIG5vdCBwcm9jZXNzZWQgeWV0XG4gICAgICAgIGlmKCFjdXJyZW50Q29ycHVzLnByb2Nlc3NlZCkge1xuICAgICAgICAgICAgaW5pdFByb2dyZXNzV2Vic29ja2V0KCRzY29wZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzZWUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgcGF0aFxuICAgICAgICB2YXIgbGVuID0gJGxvY2F0aW9uLnBhdGgoKS5zcGxpdCgnLycpLmxlbmd0aDtcbiAgICAgICAgLy8gaWYgcGFnZSBpcyBqdXN0IGxvYWRlZFxuICAgICAgICBpZihsZW4gPT09IDMpIHtcbiAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGZpcnN0IHN1YnZpZXdcbiAgICAgICAgICAgICRzdGF0ZS5nbygnY29ycHVzLicrZXh0ZW50aW9uc1swXS5uYW1lKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gQ29ycHVzT3ZlcnZpZXdDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc2NlKSB7XG4gICAgLy9jb25zb2xlLmxvZygnY29ycHVzIG92ZXJ2aWV3Jyk7XG59O1xuIiwiLy8gaW5jbHVkZXNcbnZhciBSZWxhdGlvbnNQcm9jZXNzZXIgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL1JlbGF0aW9uc1Byb2Nlc3NlcicpO1xudmFyIGQzID0gd2luZG93LmQzIHx8IG51bGw7XG5cbi8vIGZhZGUgZm9yIGQzXG52YXIgZmFkZSA9IGZ1bmN0aW9uIChvcGFjaXR5LCBzdmcpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICBzdmcuc2VsZWN0QWxsKCdwYXRoLmNob3JkJylcbiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zb3VyY2UuaW5kZXggIT09IGkgJiYgZC50YXJnZXQuaW5kZXggIT09IGk7IH0pXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIG9wYWNpdHkpXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsIG9wYWNpdHkpO1xuICAgIH07XG59O1xuXG4vL3JlbmRlcnMgdGhlIGQzIGdyYXBoXG52YXIgY3JlYXRlUmVsQ2hhcnQgPSBmdW5jdGlvbiAoZGF0YSwgY29udGFpbmVyKXtcbiAgICB2YXIgbWF0cml4PWRhdGEucmVsYXRpb25zO1xuICAgIHZhciBzY29yZXM9ZGF0YS5zY29yZXM7XG4gICAgdmFyIGVudGl0eU5hbWVzPWRhdGEuZW50aXR5TmFtZXM7XG4gICAgdmFyIGVudGl0eVVSSXM9ZGF0YS5lbnRpdHlVUklzO1xuICAgIC8vc3RhcnQgZDNcbiAgICB2YXIgdyA9IDEwMDAsXG4gICAgaCA9IDkwMCxcbiAgICByMSA9IGggLyAyLFxuICAgIHIwID0gcjEgLSA4MDtcbiAgICB2YXIgZmlsbCA9IGQzLnNjYWxlLmNhdGVnb3J5MjBjKCk7XG5cbiAgICB2YXIgY2hvcmQgPSBkMy5sYXlvdXQuY2hvcmQoKVxuICAgICAgICAucGFkZGluZygwLjA0KVxuICAgICAgICAuc29ydFN1Ymdyb3VwcyhkMy5kZXNjZW5kaW5nKVxuICAgICAgICAuc29ydENob3JkcyhkMy5kZXNjZW5kaW5nKTtcblxuICAgIHZhciBhcmMgPSBkMy5zdmcuYXJjKClcbiAgICAgICAgLmlubmVyUmFkaXVzKHIwKVxuICAgICAgICAub3V0ZXJSYWRpdXMocjAgKyAyMCk7XG5cbiAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KGNvbnRhaW5lcikuYXBwZW5kKCdzdmc6c3ZnJylcbiAgICAgICAgLmF0dHIoJ3dpZHRoJywgdylcbiAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGgpXG4gICAgICAgIC5hcHBlbmQoJ3N2ZzpnJylcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHcgLyAyICsgJywnICsgaCAvIDIgKyAnKScpO1xuXG4gICAgY2hvcmQubWF0cml4KG1hdHJpeCk7XG5cbiAgICB2YXIgZyA9IHN2Zy5zZWxlY3RBbGwoJ2cuZ3JvdXAnKVxuICAgICAgICAuZGF0YShjaG9yZC5ncm91cHMpXG4gICAgICAgIC5lbnRlcigpLmFwcGVuZCgnc3ZnOmcnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAnZ3JvdXAnKVxuICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZhZGUoMC4wMiwgc3ZnKSlcbiAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZhZGUoMC44MCwgc3ZnKSk7XG4gICAgZy5hcHBlbmQoJ3N2ZzpwYXRoJylcbiAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7IHJldHVybiBmaWxsKGQuaW5kZXgpOyB9KVxuICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7IHJldHVybiBmaWxsKGQuaW5kZXgpOyB9KVxuICAgICAgICAuYXR0cignaWQnLGZ1bmN0aW9uKGQpIHsgcmV0dXJuICdwYXRoXycrZC5pbmRleDsgfSlcbiAgICAgICAgLmF0dHIoJ2QnLCBhcmMpO1xuXG4gICAgZy5hcHBlbmQoJ3N2Zzp0ZXh0JylcbiAgICAgICAgLmVhY2goZnVuY3Rpb24oZCkgeyBkLmFuZ2xlID0gKGQuc3RhcnRBbmdsZSArIGQuZW5kQW5nbGUpIC8gMjsgfSlcbiAgICAgICAgLmF0dHIoJ2R5JywgJy4zNWVtJylcbiAgICAgICAgLmF0dHIoJ2lkJyxmdW5jdGlvbihkKSB7IHJldHVybiAnbGFiZWxfJytkLmluZGV4OyB9KVxuICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmFuZ2xlID4gTWF0aC5QSSA/ICdlbmQnIDogbnVsbDsgfSlcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgIHJldHVybiAncm90YXRlKCcgKyAoZC5hbmdsZSAqIDE4MCAvIE1hdGguUEkgLSA5MCkgKyAnKScgK1xuICAgICAgICAgICAgICAgICd0cmFuc2xhdGUoJyArIChyMCArIDI2KSArICcpJyArXG4gICAgICAgICAgICAgICAgKGQuYW5nbGUgPiBNYXRoLlBJID8gJ3JvdGF0ZSgxODApJyA6ICcnKTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZW50aXR5TmFtZXNbZC5pbmRleF07IH0pO1xuXG4gICAgc3ZnLnNlbGVjdEFsbCgncGF0aC5jaG9yZCcpXG4gICAgICAgIC5kYXRhKGNob3JkLmNob3JkcylcbiAgICAgICAgLmVudGVyKCkuYXBwZW5kKCdzdmc6cGF0aCcpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdjaG9yZCcpXG4gICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZDMucmdiKGZpbGwoZC5zb3VyY2UuaW5kZXgpKS5kYXJrZXIoKTsgfSlcbiAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZmlsbChkLnNvdXJjZS5pbmRleCk7IH0pXG4gICAgICAgIC5hdHRyKCdkJywgZDMuc3ZnLmNob3JkKCkucmFkaXVzKHIwKSk7XG5cbiAgICAkLmVhY2goZW50aXR5TmFtZXMsZnVuY3Rpb24oaSx2KXtcbiAgICAgICAgJCgnI2xhYmVsXycraSkubW91c2VvdmVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gJCgnI2xhYmVsXycraSkucG9zaXRpb24oKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2codik7XG4gICAgICAgICAgICAkKCcjcmVsYXRpb25zJykuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiZDMtcmVsLXRvb2x0aXBcIiBzdHlsZT1cInRvcDonKyhwb3NpdGlvbi50b3ArMzApKydweDtsZWZ0OicrcG9zaXRpb24ubGVmdCsncHhcIj4nK3YrJzwvZGl2PicpO1xuICAgICAgICAgICAgJCgnI2xhYmVsXycraSkuY3NzKCdmaWxsJyxkMy5zZWxlY3QoJyNwYXRoXycraSkuc3R5bGUoJ2ZpbGwnKSk7XG4gICAgICAgICAgICAkKCcjbGFiZWxfJytpKS5jc3MoJ2N1cnNvcicsJ3BvaW50ZXInKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJyNsYWJlbF8nK2kpLm1vdXNlb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnI2xhYmVsXycraSkuY3NzKCdmaWxsJywnIzAwMCcpO1xuICAgICAgICAgICAgJCgnI3JlbGF0aW9ucyAuZDMtcmVsLXRvb2x0aXAnKS5yZW1vdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIENvcnB1c1JlbGF0aW9uc0NvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzY2UpIHtcbiAgICAvLyBnZXQgZGF0YVxuICAgICQuZ2V0SlNPTignL2FwaS9jb3JwdXMvJyArICRzY29wZS5jdXJyZW50Q29ycHVzLl9pZCArICcvcmVsYXRpb25zJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgcHJvY2Vzc2VkRGF0YSA9IFJlbGF0aW9uc1Byb2Nlc3Nlci5wcm9jZXNzRGF0YShkYXRhKTtcbiAgICAgICAgY3JlYXRlUmVsQ2hhcnQocHJvY2Vzc2VkRGF0YSwgJyNyZWxhdGlvbnNDb250YWluZXInKTtcbiAgICB9KTtcbn07XG4iLCJ2YXIgY29ycHVzVHlwZXMgPSByZXF1aXJlKCcuLi9kYXRhL2NvcnB1c1R5cGVzLmpzJyk7XG52YXIgbmxwQXBpcyA9IHJlcXVpcmUoJy4uL2RhdGEvbmxwQXBpcy5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIENyZWF0ZUNvcnB1c0NvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgLy8gY29sbGVjdGlvbiBvZiBjb3JwdXMgdHlwZXNcbiAgICAkc2NvcGUuY29ycHVzVHlwZXMgPSBjb3JwdXNUeXBlcztcbiAgICAvLyBjb2xsZWN0aW9uIG9mIG5scCBhcGlzXG4gICAgJHNjb3BlLm5scEFwaXMgPSBubHBBcGlzO1xuXG4gICAgLy8gY3VycmVudCBjb3JwdXNcbiAgICAkc2NvcGUuY29ycHVzU2VsZWN0aW9uID0ge2luZGV4OiAwfTtcbiAgICAkc2NvcGUuY3VycmVudENvcnB1cyA9ICRzY29wZS5jb3JwdXNUeXBlc1swXTtcblxuICAgIC8vIGlucHV0IHNsaWRlciByZWZlcmVuY2VcbiAgICB2YXIgJGlucHV0Q291bnQsICRzbGlkZXJDb250YWluZXI7XG4gICAgLy8gdXBkYXRlIHZpZXcgc2xpZGVyXG4gICAgdmFyIHVwZGF0ZVZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRDb3JwdXMgPSAkc2NvcGUuY29ycHVzVHlwZXNbJHNjb3BlLmNvcnB1c1NlbGVjdGlvbi5pbmRleF07XG4gICAgICAgIGlmKCRzY29wZS5jdXJyZW50Q29ycHVzLmhhdmVJdGVtcykge1xuICAgICAgICAgICAgaWYoISRpbnB1dENvdW50KSB7XG4gICAgICAgICAgICAgICAgJHNsaWRlckNvbnRhaW5lciA9ICQoJyNzbGlkZXJfY29udGFpbmVyJyk7XG4gICAgICAgICAgICAgICAgJGlucHV0Q291bnQgPSAkKCcjaW5wdXRfY291bnQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGlucHV0Q291bnQuc2xpZGVyKCdkZXN0cm95Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2xpZGVyQ29udGFpbmVyLnNob3coKTtcbiAgICAgICAgICAgICRpbnB1dENvdW50LnNsaWRlcih7XG4gICAgICAgICAgICAgICAgbWluOiAkc2NvcGUuY3VycmVudENvcnB1cy5pdGVtc01pbixcbiAgICAgICAgICAgICAgICBtYXg6ICRzY29wZS5jdXJyZW50Q29ycHVzLml0ZW1zTWF4LFxuICAgICAgICAgICAgICAgIHN0ZXA6IDUwLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAkc2NvcGUuY3VycmVudENvcnB1cy5pdGVtc0RlZmF1bHQsXG4gICAgICAgICAgICAgICAgdG9vbHRpcDogJ2Fsd2F5cydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHNsaWRlckNvbnRhaW5lci5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gdXBkYXRlIHZpZXcgb24gbW9kZWwgY2hhbmdlXG4gICAgJHNjb3BlLiR3YXRjaCgnY29ycHVzU2VsZWN0aW9uJywgdXBkYXRlVmlldywgdHJ1ZSk7XG5cbiAgICAvLyB1cGRhdGUgc2xpZGVyXG4gICAgJHNjb3BlLiRvbignJHZpZXdDb250ZW50TG9hZGVkJywgdXBkYXRlVmlldyk7XG5cbiAgICAvLyBhbmFseXNpcyBzdGFydCBmdW5jdGlvblxuICAgICRzY29wZS5zdGFydEFuYWx5c2lzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgLy8gcHJldmVudCBldmVudFxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIGdldCBmaWVsZHNcbiAgICAgICAgdmFyICRpbnB1dEl0ZW0gPSAkKCcjaW5wdXRfaXRlbScpO1xuICAgICAgICB2YXIgJGlucHV0SXRlbUFyZWEgPSAkKCcjaW5wdXRfaXRlbV9hcmVhJyk7XG4gICAgICAgIHZhciAkaW5wdXRJdGVtRmlsZSA9ICQoJyNpbnB1dF9pdGVtX2ZpbGUnKTtcbiAgICAgICAgdmFyICRpbnB1dENvdW50RmllbGQgPSAkKCdpbnB1dCNpbnB1dF9jb3VudCcpO1xuICAgICAgICB2YXIgJG5ld0NvcnB1c0Zvcm0gPSAkKCcjbmV3Y29ycHVzX2Zvcm0nKTtcbiAgICAgICAgdmFyICRpbnB1dFR5cGUgPSAkKCdpbnB1dFtuYW1lPWlucHV0X3R5cGVdOmNoZWNrZWQnKTtcblxuICAgICAgICAvLyByZW1vdmUgb2xkIHdhcm5pbmdcbiAgICAgICAgJGlucHV0SXRlbS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLXdhcm5pbmcnKTtcblxuICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dFxuICAgICAgICB2YXIgaW5wdXQgPSBudWxsO1xuICAgICAgICB2YXIgY29ycHVzVHlwZSA9ICRzY29wZS5jdXJyZW50Q29ycHVzLm5hbWU7XG4gICAgICAgIHZhciBpbnB1dFR5cGUgPSAkc2NvcGUuY3VycmVudENvcnB1cy5pbnB1dFR5cGU7XG4gICAgICAgIHN3aXRjaChpbnB1dFR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgICAgIGlucHV0ID0gJGlucHV0SXRlbS52YWwoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZXh0YXJlYSc6XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAkaW5wdXRJdGVtQXJlYS52YWwoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICAgICAgICBpbnB1dCA9ICRpbnB1dEl0ZW1GaWxlLnZhbCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpbnB1dCkge1xuICAgICAgICAgICAgJGlucHV0SXRlbS5wYXJlbnQoKS5hZGRDbGFzcygnaGFzLXdhcm5pbmcnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFwcGVuZCBjc3JmIHRva2VuIHRvIGZvcm0gdXJsXG4gICAgICAgICRuZXdDb3JwdXNGb3JtLmF0dHIoJ2FjdGlvbicsICcvYXBpL2NvcnB1cz9fY3NyZj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KCRzY29wZS5jc3JmKSk7XG5cbiAgICAgICAgLy8gYXNzaWduIGNvdW50IHRvIGlucHV0IGZpZWxkXG4gICAgICAgIHZhciBpdGVtQ291bnQgPSAkaW5wdXRDb3VudC5zbGlkZXIoJ2dldFZhbHVlJyk7XG4gICAgICAgICRpbnB1dENvdW50RmllbGQudmFsKGl0ZW1Db3VudCk7XG5cbiAgICAgICAgLy8gcmVtb3ZlIHVubmVlZGVkIGlucHV0cyAmIHJlbmFtZSBsYXN0IG9uZVxuICAgICAgICBzd2l0Y2goaW5wdXRUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtLmF0dHIoJ25hbWUnLCAnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtQXJlYS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtRmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW1BcmVhLmF0dHIoJ25hbWUnLCAnaW5wdXQnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtRmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZpbGUnOlxuICAgICAgICAgICAgICAgICRpbnB1dEl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJGlucHV0SXRlbUFyZWEucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJGlucHV0Q291bnRGaWVsZC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRJdGVtRmlsZS5hdHRyKCduYW1lJywgJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzd2FwIGlucHV0IHR5cGUgdmFsdWVcbiAgICAgICAgJGlucHV0VHlwZS52YWwoY29ycHVzVHlwZSk7XG5cbiAgICAgICAgLy8gc2VuZCB0byBzZXJ2ZXJcbiAgICAgICAgJG5ld0NvcnB1c0Zvcm0uc3VibWl0KCk7XG4gICAgfTtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIEhvbWVDb250cm9sbGVyKCRzY29wZSkge1xuICAgIC8vIGNvcnB1cyBtb2RlbFxuICAgICRzY29wZS5jb3JwdXMgPSAnMCc7XG4gICAgLy8gb24gY29ycHVzIHNlbGVjdCBldmVudFxuICAgICRzY29wZS5jb3JwdXNTZWxlY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gZG8gbm90IGRvIGFueXRoaW5nIGlmIGl0J3MgZHVtbXkgZW50cnlcbiAgICAgICAgaWYoJHNjb3BlLmNvcnB1cyA9PT0gJzAnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVkaXJlY3QgdG8gY29ycHVzXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcvY29ycHVzLycgKyAkc2NvcGUuY29ycHVzO1xuICAgIH07XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBQcm9maWxlQ29udHJvbGxlcigkc2NvcGUpIHtcbiAgICAvL1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gUmVnaXN0ZXJDb250cm9sbGVyKCRzY29wZSkge1xuICAgIC8vXG59O1xuIiwiLy8gYnVpbGQgY29sbGVjdGlvbiBvZiBpdGVtc1xudmFyIGNvbGxlY3Rpb24gPSBbXTtcbi8vIHJzc1xuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnZmVlZCcsXG4gICAgZGVzY3JpcHRpb246ICdSU1MvUkRGL0FUT00gRmVlZCcsXG4gICAgaW5wdXRUeXBlOiAndGV4dCcsXG4gICAgaW5wdXREZXNjcmlwdGlvbjogJ1VSTCBvZiB0aGUgUlNTL1JERi9BVE9NIGZlZWQnLFxuICAgIGlucHV0UGxhY2Vob2xkZXI6ICdVUkwgb2YgeW91ciBmZWVkJyxcbiAgICBoYXZlSXRlbXM6IHRydWUsXG4gICAgaXRlbXNNaW46IDUwLFxuICAgIGl0ZW1zTWF4OiA2MDAsXG4gICAgaXRlbXNEZWZhdWx0OiA1MCxcbn0pO1xuLy8gd29yZHByZXNzXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICd3b3JkcHJlc3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnV29yZFByZXNzIEJsb2cnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdXZWJsb2cgVVJMJyxcbiAgICBpbnB1dFBsYWNlaG9sZGVyOiAnVVJMIG9mIHRoZSBibG9nJyxcbiAgICBoYXZlSXRlbXM6IHRydWUsXG4gICAgaXRlbXNNaW46IDUwLFxuICAgIGl0ZW1zTWF4OiA0MDAsXG4gICAgaXRlbXNEZWZhdWx0OiA0MDAsXG59KTtcbi8vIGJsb2dnZXJcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ2Jsb2dnZXInLFxuICAgIGRlc2NyaXB0aW9uOiAnQmxvZ2dlciBCbG9nJyxcbiAgICBpbnB1dFR5cGU6ICd0ZXh0JyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnV2VibG9nIFVSTCcsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ1VSTCBvZiB0aGUgYmxvZycsXG4gICAgaGF2ZUl0ZW1zOiB0cnVlLFxuICAgIGl0ZW1zTWluOiA1MCxcbiAgICBpdGVtc01heDogNDAwLFxuICAgIGl0ZW1zRGVmYXVsdDogNDAwLFxufSk7XG4vLyBwdWJsaWMgdHdpdHRlclxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAndHdpdHRlcicsXG4gICAgZGVzY3JpcHRpb246ICdQdWJsaWMgVHdpdHRlciBhY2NvdW50JyxcbiAgICBpbnB1dFR5cGU6ICd0ZXh0JyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnVHdpdHRlciB1c2VybmFtZScsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ1VzZXJuYW1lJyxcbiAgICBoYXZlSXRlbXM6IHRydWUsXG4gICAgaXRlbXNNaW46IDIwMCxcbiAgICBpdGVtc01heDogMTUwMCxcbiAgICBpdGVtc0RlZmF1bHQ6IDEwMDAsXG59KTtcbi8vIHNsaWRld2lraVxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnc2xpZGV3aWtpJyxcbiAgICBkZXNjcmlwdGlvbjogJ1NsaWRlV2lraSBEZWNrJyxcbiAgICBpbnB1dFR5cGU6ICd0ZXh0JyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnRGVjayBJRCcsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ0RlY2sgSUQnLFxuICAgIGhhdmVJdGVtczogdHJ1ZSxcbiAgICBpdGVtc01pbjogNTAsXG4gICAgaXRlbXNNYXg6IDEwMDAsXG4gICAgaXRlbXNEZWZhdWx0OiA0MDAsXG59KTtcbi8vIHdlYnBhZ2VcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ3dlYnBhZ2UnLFxuICAgIGRlc2NyaXB0aW9uOiAnV2ViIHBhZ2UnLFxuICAgIGlucHV0VHlwZTogJ3RleHQnLFxuICAgIGlucHV0RGVzY3JpcHRpb246ICdXZWJQYWdlIFVSTCcsXG4gICAgaW5wdXRQbGFjZWhvbGRlcjogJ1VSTCcsXG4gICAgaGF2ZUl0ZW1zOiBmYWxzZSxcbn0pO1xuLy8gZGlyZWN0IGlucHV0XG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdkaXJlY3RpbnB1dCcsXG4gICAgZGVzY3JpcHRpb246ICdEaXJlY3QgaW5wdXQnLFxuICAgIGlucHV0VHlwZTogJ3RleHRhcmVhJyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnWW91ciB0ZXh0L2h0bWwnLFxuICAgIGhhdmVJdGVtczogZmFsc2UsXG59KTtcbi8vIHVwbG9hZCBhIGRvY1xuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBuYW1lOiAnZG9jJyxcbiAgICBkZXNjcmlwdGlvbjogJ1VwbG9hZCBhIGRvY3VtZW50KHMpJyxcbiAgICBpbnB1dFR5cGU6ICdmaWxlJyxcbiAgICBpbnB1dERlc2NyaXB0aW9uOiAnRG9jdW1lbnQnLFxuICAgIGhhdmVJdGVtczogZmFsc2UsXG59KTtcblxuLy8gT3VyIG1vZHVsZSBub3cgcmV0dXJucyBvdXIgdmlld1xubW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uO1xuIiwidmFyIGNvbGxlY3Rpb24gPSBbXTtcbi8vIG92ZXJ2aWV3XG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdPdmVydmlldycsXG4gICAgcGF0aDogJy9vdmVydmlldycsXG4gICAgY29udHJvbGxlcjogJ0NvcnB1c092ZXJ2aWV3Q29udHJvbGxlcicsXG4gICAgdGVtcGxhdGU6ICcvdGVtcGxhdGVzL2NvcnB1c092ZXJ2aWV3Lmh0bWwnLFxuICAgIGpzOiByZXF1aXJlKCcuLi9jb250cm9sbGVycy9jb3JwdXMvb3ZlcnZpZXcuanMnKSxcbn0pO1xuLy8gZmFjZXRzXG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIG5hbWU6ICdGYWNldHMnLFxuICAgIHBhdGg6ICcvZmFjZXRzJyxcbiAgICBjb250cm9sbGVyOiAnQ29ycHVzRmFjZXRzQ29udHJvbGxlcicsXG4gICAgdGVtcGxhdGU6ICcvdGVtcGxhdGVzL2NvcnB1c0ZhY2V0cy5odG1sJyxcbiAgICBqczogcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvY29ycHVzL2ZhY2V0cy5qcycpLFxufSk7XG4vLyByZWxhdGlvbnNcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ0VudGl0eSByZWxhdGlvbnMnLFxuICAgIHBhdGg6ICcvcmVsYXRpb25zJyxcbiAgICBjb250cm9sbGVyOiAnQ29ycHVzUmVsYXRpb25zQ29udHJvbGxlcicsXG4gICAgdGVtcGxhdGU6ICcvdGVtcGxhdGVzL2NvcnB1c0VudGl0eVJlbGF0aW9ucy5odG1sJyxcbiAgICBqczogcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvY29ycHVzL3JlbGF0aW9ucy5qcycpLFxufSk7XG4vLyBjby1vY2N1cmFuY2VcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgbmFtZTogJ0NvLW9jY3VycmVuY2UgbWF0cml4JyxcbiAgICBwYXRoOiAnL2Nvb2MnLFxuICAgIGNvbnRyb2xsZXI6ICdDb3JwdXNDb29jQ29udHJvbGxlcicsXG4gICAgdGVtcGxhdGU6ICcvdGVtcGxhdGVzL2NvcnB1c0Nvb2MuaHRtbCcsXG4gICAganM6IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL2NvcnB1cy9jb29jLmpzJyksXG59KTtcblxuLy8gT3VyIG1vZHVsZSBub3cgcmV0dXJucyBvdXIgdmlld1xubW9kdWxlLmV4cG9ydHMgPSBjb2xsZWN0aW9uOyIsIi8vIGJ1aWxkIGNvbGxlY3Rpb24gb2YgaXRlbXNcbnZhciBjb2xsZWN0aW9uID0gW107XG4vLyBzcG90bGlnaHRcbmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgaWQ6ICdEQnBlZGlhLVNwb3RsaWdodCcsXG4gICAgbmFtZTogJ0RCcGVkaWEgU3BvdGxpZ2h0Jyxcbn0pO1xuLy8gZm94XG5jb2xsZWN0aW9uLnB1c2goe1xuICAgIGlkOiAnRk9YJyxcbiAgICBuYW1lOiAnRk9YJyxcbn0pO1xuLy8gZ2VybWFuIHNwb3RsaWdodFxuY29sbGVjdGlvbi5wdXNoKHtcbiAgICBpZDogJ0RCcGVkaWEtU3BvdGxpZ2h0LURFJyxcbiAgICBuYW1lOiAnREJwZWRpYSBTcG90bGlnaHQgKEdlcm1hbiknLFxufSk7XG5cbi8vIE91ciBtb2R1bGUgbm93IHJldHVybnMgb3VyIHZpZXdcbm1vZHVsZS5leHBvcnRzID0gY29sbGVjdGlvbjtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYXBwbHlEaXJlY3RpdmVzIChhcHApIHtcbn07IiwiLy8gbG9hZCBtb2R1bGVzXG52YXIgQ29ycHVzTW9kdWxlID0gcmVxdWlyZSgnLi9tb2R1bGVzL2NvcnB1cycpO1xuXG4vLyBpbml0IGFwcFxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdjb250ZXh0LWFwcCcsIFsnbmdSb3V0ZScsICduZ0FuaW1hdGUnLCAnbWdjcmVhLm5nU3RyYXAnLCAnQ29ycHVzTW9kdWxlJ10pO1xuXG4vLyBjb25maWcgYXBwIHJvdXRlc1xucmVxdWlyZSgnLi9yb3V0ZXMnKShhcHApO1xuXG4vLyBjb25maWcgYXBwIHNlcnZpY2VzXG5yZXF1aXJlKCcuL3NlcnZpY2VzJykoYXBwKTtcblxuLy8gaW5pdCBjb250cm9sbGVyc1xucmVxdWlyZSgnLi9jb250cm9sbGVycycpKGFwcCk7XG5cbi8vIGNvbmZpZyBhcHAgZGlyZWN0aXZlc1xucmVxdWlyZSgnLi9kaXJlY3RpdmVzJykoYXBwKTtcblxuLy8gY29uZmlnIGFwcCBmaWx0ZXJzXG5yZXF1aXJlKCcuL2ZpbHRlcnMnKShhcHApO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseUZpbHRlcnMgKGFwcCkge1xufTsiLCJ2YXIgZGljZU1ldHJpYyA9IGZ1bmN0aW9uICh4LCB5LCB4eSkge1xuICAgIHJldHVybiAyICogeHkgLyAoeCArIHkpO1xufTtcblxudmFyIGdldENvbW1vbkFydGljbGVzID0gZnVuY3Rpb24oZW50aXR5LCBlbnRpdHlEb3VibGUpIHtcbiAgICByZXR1cm4gXy5pbnRlcnNlY3Rpb24oZW50aXR5LmFydGljbGVzLCBlbnRpdHlEb3VibGUuYXJ0aWNsZXMpO1xufTtcblxudmFyIHByb2Nlc3NEYXRhID0gZnVuY3Rpb24oY29ycHVzKSB7XG4gICAgLy8gZW50aXRpZXMgYXJyYXlcbiAgICB2YXIgZW50aXRpZXMgPSB7fTtcbiAgICB2YXIgdHlwZXMgPSBbXTtcbiAgICAvLyBmaW5kIG1pbiwgbWF4LCBhdmcgb2YgZW50aXRpZXNcbiAgICB2YXIgZW50aXRpZXNNaW4sIGVudGl0aWVzTWF4LCBlbnRpdGllc0F2ZztcbiAgICB2YXIgZW50aXRpZXNUb3RhbCA9IDA7XG4gICAgLy8gZ28gdGhyb3VnaCBhbGwgYXJ0aWNsZXNcbiAgICBjb3JwdXMuYXJ0aWNsZXMuZm9yRWFjaChmdW5jdGlvbihhcnRpY2xlKSB7XG4gICAgICAgIC8vIGNhbGN1bGF0ZSBzdHVmZlxuICAgICAgICB2YXIgY291bnQgPSBhcnRpY2xlLmVudGl0aWVzLmxlbmd0aDtcbiAgICAgICAgZW50aXRpZXNUb3RhbCArPSBjb3VudDtcbiAgICAgICAgZW50aXRpZXNNaW4gPSBfLm1pbihbZW50aXRpZXNNaW4sIGNvdW50XSk7XG4gICAgICAgIGVudGl0aWVzTWF4ID0gXy5tYXgoW2VudGl0aWVzTWluLCBjb3VudF0pO1xuICAgICAgICAvLyBhZGQgZW50aXRpZXMgdG8gYWxsIGFycmF5XG4gICAgICAgIGFydGljbGUuZW50aXRpZXMuZm9yRWFjaChmdW5jdGlvbihlbnRpdHkpIHtcbiAgICAgICAgICAgIGlmKGVudGl0aWVzW2VudGl0eS51cmldKSB7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uY291bnQrKztcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXS5hcnRpY2xlcy5wdXNoKGFydGljbGUuX2lkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0gPSBlbnRpdHk7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uY291bnQgPSAxO1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldLmFydGljbGVzID0gW2FydGljbGUuX2lkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGZpbGwgdHlwZXNcbiAgICAgICAgICAgIGVudGl0eS50eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlcy5pbmRleE9mKHR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0eXBlcy5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyBjb3VudCBhdmVyYWdlXG4gICAgZW50aXRpZXNBdmcgPSBNYXRoLmZsb29yKGVudGl0aWVzVG90YWwgLyBjb3JwdXMuYXJ0aWNsZXMubGVuZ3RoKTtcblxuICAgIC8vIHByZXBhcmUgdmFycyBmb3IgZmluYWwgZGF0YVxuICAgIHZhciBub2RlcyA9IFtdO1xuICAgIHZhciBsaW5rcyA9IFtdO1xuICAgIHZhciBncm91cHMgPSBbXTtcbiAgICB2YXIgc2NvcmVzID0gW107XG4gICAgdmFyIGVudGl0eU5hbWVzID0gW107XG4gICAgdmFyIGVudGl0eVVSSXMgPSBbXTtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIC8vIHRlbXAgYXJyYXlzXG4gICAgdmFyIHRtcCA9IFtdO1xuXG4gICAgLy8gcHJvY2Vzc1xuICAgIHZhciBla2V5LCBlbnRpdHk7XG4gICAgZm9yKGVrZXkgaW4gZW50aXRpZXMpIHtcbiAgICAgICAgZW50aXR5ID0gZW50aXRpZXNbZWtleV07XG4gICAgICAgIC8vIHB1c2ggdXJpXG4gICAgICAgIGVudGl0eVVSSXMucHVzaChlbnRpdHkudXJpKTtcbiAgICAgICAgLy8gZ2V0IHR5cGVcbiAgICAgICAgdmFyIHR5cGUgPSBlbnRpdHkudHlwZXNbMF07XG4gICAgICAgIHZhciB0eXBlSWQgPSB0eXBlcy5pbmRleE9mKHR5cGUpO1xuICAgICAgICBncm91cHNbdHlwZUlkXSA9IHR5cGU7XG4gICAgICAgIC8vIHB1c2ggZGF0YVxuICAgICAgICBpZiAoZW50aXR5TmFtZXMuaW5kZXhPZihlbnRpdHkubmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgICBlbnRpdHlOYW1lcy5wdXNoKGVudGl0eS5uYW1lKTtcbiAgICAgICAgICAgIG5vZGVzLnB1c2goe25hbWU6IGVudGl0eS5uYW1lLCB1cmk6IGVudGl0eS51cmksIGdyb3VwOiB0eXBlSWR9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICBlbnRpdHlOYW1lcy5wdXNoKGVudGl0eS5uYW1lICsgJyMnICsgaW5kZXgpO1xuICAgICAgICAgICAgbm9kZXMucHVzaCh7bmFtZTogZW50aXR5Lm5hbWUgKyAnIycgKyBpbmRleCwgdXJpOiBlbnRpdHkudXJpLCBncm91cDogdHlwZUlkfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBwcm9jZXNzXG4gICAgZm9yKGVrZXkgaW4gZW50aXRpZXMpIHtcbiAgICAgICAgZW50aXR5ID0gZW50aXRpZXNbZWtleV07XG4gICAgICAgIC8vIHByZXBhcmUgcm93IGRhdGFcbiAgICAgICAgdmFyIHNjb3JlID0gW107XG5cbiAgICAgICAgLy8gZ28gdGhyb3VnaCBlbnRpdGllcyBhZ2FpblxuICAgICAgICBmb3IodmFyIGVrZXkyIGluIGVudGl0aWVzKSB7XG4gICAgICAgICAgICB2YXIgZW50aXR5RG91YmxlID0gZW50aXRpZXNbZWtleTJdO1xuICAgICAgICAgICAgaWYgKGVudGl0eS51cmkgIT09IGVudGl0eURvdWJsZS51cmkpIHtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZW50aXR5Ll9pZCArICctJyArIGVudGl0eURvdWJsZS5faWQ7XG4gICAgICAgICAgICAgICAgdmFyIHJldmVyc2VLZXkgPSBlbnRpdHlEb3VibGUuX2lkICsgJy0nICsgZW50aXR5Ll9pZDtcbiAgICAgICAgICAgICAgICBpZiAodG1wLmluZGV4T2Yoa2V5KSA9PT0gLTEgJiYgdG1wLmluZGV4T2YocmV2ZXJzZUtleSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZ2l2ZSBtZSB0aGUgbnVtYmVyIG9mIGFydGljbGVzIHRoYXQgaGF2ZSBib3RoICAkaSBbJ3VyaSddIGFuZCAkaiBbJ3VyaSddIGVudGl0aWVzXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb21tb24gPSBnZXRDb21tb25BcnRpY2xlcyhlbnRpdHksIGVudGl0eURvdWJsZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzY29yZVZhbHVlID0gW2RpY2VNZXRyaWMoZW50aXR5LmFydGljbGVzLmxlbmd0aCwgZW50aXR5RG91YmxlLmFydGljbGVzLmxlbmd0aCwgY29tbW9uLmxlbmd0aCldO1xuICAgICAgICAgICAgICAgICAgICBzY29yZS5wdXNoKHNjb3JlVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBsaW5rcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogZW50aXR5VVJJcy5pbmRleE9mKGVudGl0eS51cmkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBlbnRpdHlVUklzLmluZGV4T2YoZW50aXR5RG91YmxlLnVyaSksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY29tbW9uID8gY29tbW9uLmxlbmd0aCA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlczogY29tbW9uXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHB1c2ggc2NvcmVzXG4gICAgICAgIHNjb3Jlcy5wdXNoKHNjb3JlKTtcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhyZXNob2xkIGZyb20gbWlkZGxlIG9mIHNjb3Jlc1xuICAgIHZhciBzb3J0ZWRTY29yZXMgPSBbXTtcbiAgICAvLyBnZXQgc2NvcmVzXG4gICAgc2NvcmVzLmZvckVhY2goZnVuY3Rpb24oc2NvcmUpIHtcbiAgICAgICAgc2NvcmUuZm9yRWFjaChmdW5jdGlvbihudW0pIHtcbiAgICAgICAgICAgIGlmKG51bSA+IDApIHtcbiAgICAgICAgICAgICAgICBzb3J0ZWRTY29yZXMucHVzaChudW1bMF0pO1xuICAgICAgICAgICAgICAgIHRocmVzaG9sZCArPSBudW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIHNvcnRcbiAgICBzb3J0ZWRTY29yZXMgPSBzb3J0ZWRTY29yZXMuc29ydCgpO1xuICAgIC8vIGdldCB0aHJlc2hvbGRcbiAgICB2YXIgY2VudGVyID0gTWF0aC5mbG9vcihzb3J0ZWRTY29yZXMubGVuZ3RoIC8gMik7XG4gICAgdmFyIHRocmVzaG9sZCA9IHNvcnRlZFNjb3Jlc1tjZW50ZXJdO1xuXG4gICAgLy9yZW1vdmUgbm9pc2VzXG4gICAgc2NvcmVzLmZvckVhY2goZnVuY3Rpb24ocm93LCBpbmRleCl7XG4gICAgICAgIGlmKHNjb3JlIDwgdGhyZXNob2xkKSB7XG4gICAgICAgICAgICBsaW5rc1tpbmRleF0udmFsdWU9MDtcbiAgICAgICAgICAgIGxpbmtzW2luZGV4XS5hcnRpY2xlcz0nJztcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZXM6IG5vZGVzLFxuICAgICAgICBsaW5rczogbGlua3MsXG4gICAgICAgIGdyb3VwczogZ3JvdXBzXG4gICAgfTtcbn07XG5cbmV4cG9ydHMucHJvY2Vzc0RhdGEgPSBwcm9jZXNzRGF0YTsiLCJ2YXIgZXNjYXBlUmVnRXhwID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXFwtXFxbXFxdXFwvXFx7XFx9XFwoXFwpXFwqXFwrXFw/XFwuXFxcXFxcXlxcJFxcfF0vZywgJ1xcXFwkJicpO1xufTtcblxudmFyIHByb2Nlc3NEYXRhID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIC8vIGFydGljbGVzXG4gICAgdmFyIGFydGljbGVzID0gW107XG4gICAgLy8gdHlwZXNcbiAgICB2YXIgdHlwZXMgPSBbXTtcbiAgICB2YXIgdHlwZU5hbWVzID0gW107XG4gICAgLy8gZW50aXRpZXNcbiAgICB2YXIgZW50aXRpZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5TmFtZXMgPSBbXTtcblxuICAgIC8vIGV4dHJhY3QgZGF0YVxuICAgIGRhdGEuYXJ0aWNsZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIC8vIGdldCBhcnRpY2xlIGRhdGFcbiAgICAgICAgdmFyIHRpdGxlID0gJyc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgZG9tID0gJChpdGVtLnNvdXJjZSk7XG4gICAgICAgICAgICB0aXRsZSA9ICQoJ2V4dHJhY3RlZC10aXRsZScsIGRvbSkudGV4dCgpIHx8IGRvbS50ZXh0KCk7XG4gICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgdGl0bGUgPSBpdGVtLnNvdXJjZTtcbiAgICAgICAgfVxuICAgICAgICB0aXRsZSA9IHRpdGxlLnNsaWNlKDAsIDMwKSArICcuLi4nO1xuICAgICAgICB2YXIgYXJ0aWNsZSA9IHtcbiAgICAgICAgICAgIGlkOiBpdGVtLl9pZCxcbiAgICAgICAgICAgIG5hbWU6IHRpdGxlLFxuICAgICAgICAgICAgdHlwZTogJ2FydGljbGUnLFxuICAgICAgICAgICAgY291bnQ6IDAsXG4gICAgICAgICAgICBlbnRpdGllczogW10sXG4gICAgICAgICAgICB0eXBlczogW10sXG4gICAgICAgICAgICBzb3VyY2U6IGl0ZW0uc291cmNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGdldCBhcnRpY2xlIHBsYWluIHRleHRcbiAgICAgICAgdmFyIHNvdXJjZVRleHQgPSBTKGl0ZW0uc291cmNlKS5zdHJpcFRhZ3MoKS5zO1xuICAgICAgICAvLyBzcGxpdCBwbGFpbiB0ZXh0IGFuZCBmdWxsIHNvdXJjZSBpbnRvIHdvcmRzXG4gICAgICAgIHZhciBzcmNUZXh0ID0gc291cmNlVGV4dC5zcGxpdCgvXFxzLyk7XG4gICAgICAgIHZhciBzcmMgPSBpdGVtLnNvdXJjZS5zcGxpdCgvXFxzLyk7XG4gICAgICAgIC8vIHNwbGl0IHVzaW5nIGFkZGl0aW9uYWwgY2hhcmFjdGVycyBmb3IgYmV0dGVyIHByb2Nlc3NpbmdcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNyY1RleHQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpdCA9IHNyY1RleHRbaV07XG4gICAgICAgICAgICBpdCA9IGl0LnNwbGl0KCcvJyk7XG4gICAgICAgICAgICBzcmNUZXh0W2ldID0gaXQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZmxhdHRlbiBhcnJheXNcbiAgICAgICAgc3JjVGV4dCA9IF8uZmxhdHRlbihzcmNUZXh0KTtcblxuICAgICAgICB2YXIgZmluZFNvdXJjZUluZGV4ID0gZnVuY3Rpb24od29yZCwgY2xlYW5Xb3JkLCBlbnRpdHlOYW1lLCBzdGFydEluZGV4KSB7XG4gICAgICAgICAgICBzdGFydEluZGV4ID0gc3RhcnRJbmRleCB8fCAtMTtcbiAgICAgICAgICAgIC8vIHRyeSB0byBnZXQgcGxhaW4gbWF0Y2ggZnJvbSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgICAgICAgIHZhciBzb3VyY2VJbmRleCA9IHNyYy5pbmRleE9mKHdvcmQsIHN0YXJ0SW5kZXgpO1xuICAgICAgICAgICAgLy8gaWYgbm90IGZvdW5kLCBmaW5kIGJ5IHN0cmluZ1xuICAgICAgICAgICAgaWYoc291cmNlSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgLy9pZihlbnRpdHlOYW1lID09PSB0ZXN0RW50aXR5KSBjb25zb2xlLmxvZygnc2VhcmNoaW5nIGluZGV4IGluIGFycmF5Jyk7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNyYy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzcmNXb3JkID0gc3JjW2ldO1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhbiBmcm9tIGhyZWZzXG4gICAgICAgICAgICAgICAgICAgIHZhciBzcmNXb3JkQ2xlYW4gPSBzcmNXb3JkLnJlcGxhY2UoL2hyZWY9XCIoLis/KVwiKC4qPz4/KS8sICcnKS5yZXBsYWNlKC9zcmM9XCIoLis/KVwiKC4qPz4/KS8sICcnKS5yZXBsYWNlKC9hbHQ9XCIoLis/KVwiKC4qPz4/KS8sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2tpcCBpZiBjb250YWluZXMgbWFya2luZyBwYXJ0c1xuICAgICAgICAgICAgICAgICAgICBpZihzcmNXb3JkQ2xlYW4uaW5kZXhPZignc3BhbiVtYXJrZWQlJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBtYXRjaFxuICAgICAgICAgICAgICAgICAgICBpZihzcmNXb3JkQ2xlYW4ubWF0Y2gobmV3IFJlZ0V4cChtYXRjaFJlZ1N0YXJ0K2VzY2FwZVJlZ0V4cChjbGVhbldvcmQpK21hdGNoUmVnKSkgJiYgaSA+PSBzdGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VJbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHNvdXJjZUluZGV4O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjbGVhblJlZyA9IC8oXltcXFddKyl8KFtcXFddKyQpL2c7XG4gICAgICAgIHZhciBtYXRjaFJlZ1N0YXJ0ID0gJyc7XG4gICAgICAgIHZhciBtYXRjaFJlZyA9ICcoXFxcXFc/KSc7XG5cbiAgICAgICAgLy8gZ2V0IGVudGl0aWVzXG4gICAgICAgIGl0ZW0uZW50aXRpZXMuZm9yRWFjaChmdW5jdGlvbihlbnRpdHkpe1xuICAgICAgICAgICAgdmFyIGVudGl0eVBhcnRzID0gZW50aXR5Lm5hbWUuc3BsaXQoJyAnKTtcblxuICAgICAgICAgICAgLy8gaWYgb25seSBvbmUgd29yZFxuICAgICAgICAgICAgaWYoZW50aXR5UGFydHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gZmluZCB3b3JkIHRoYXQgbWF0Y2hlcyBjdXJyZW50IGVudGl0eVxuICAgICAgICAgICAgICAgIHNyY1RleHQuZm9yRWFjaChmdW5jdGlvbih3b3JkLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhbiB3b3JkIGZyb20gY29tbWFzLCBkb3RzIGFuZCBvdGhlciBzdXBsZW1lbnRhcnkgc3R1ZmZcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNsZWFuV29yZCA9IHdvcmQucmVwbGFjZShjbGVhblJlZywgJycpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW50aXR5Q2xlYW4gPSBlbnRpdHkubmFtZS5yZXBsYWNlKGNsZWFuUmVnLCAnJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2VoY2sgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgaWYoY2xlYW5Xb3JkID09PSBlbnRpdHkubmFtZSB8fCB3b3JkID09PSBlbnRpdHkubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IG1hdGNoIGZyb20gb3JpZ2luYWwgc291cmNlXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlSW5kZXggPSBmaW5kU291cmNlSW5kZXgod29yZCwgY2xlYW5Xb3JkLCBlbnRpdHkubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3b3JkIHdhcyBmb3VuZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc291cmNlSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdTcmMgPSBzcmNbc291cmNlSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5rID0gb3JpZ1NyYy5tYXRjaCgvaHJlZj1cIiguKz8pXCIvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gb3JpZ1NyYy5tYXRjaCgvc3JjPVwiKC4rPylcIi8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbHQgPSBvcmlnU3JjLm1hdGNoKC9hbHQ9XCIoLis/KVwiLyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobGluaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rID0gbGlua1sxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NyYyA9IG9yaWdTcmMucmVwbGFjZShsaW5rLCAnJWxpbmslJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSBpbWdbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdTcmMgPSBvcmlnU3JjLnJlcGxhY2UoaW1nLCAnJWltZyUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCA9IGFsdFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ1NyYyA9IG9yaWdTcmMucmVwbGFjZShhbHQsICclYWx0JScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVucmljaCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gb3JpZ1NyYy5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuJW1hcmtlZCUgY2xhc3M9XCJsYWJlbCBsYWJlbC13YXJuaW5nIGhhc1Rvb2x0aXBcIiBkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIiB0aXRsZT1cIicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRpdHkudHlwZXMuam9pbignICcpICsgJ1wiPicgKyBlbnRpdHkubmFtZSArICc8L3NwYW4lbWFya2VkJT4nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjW3NvdXJjZUluZGV4XSA9IHNyY1tzb3VyY2VJbmRleF0ucmVwbGFjZSgnJWxpbmslJywgbGluayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGltZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gc3JjW3NvdXJjZUluZGV4XS5yZXBsYWNlKCclaW1nJScsIGltZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlSW5kZXhdID0gc3JjW3NvdXJjZUluZGV4XS5yZXBsYWNlKCclYWx0JScsIGFsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgbWF0Y2hcbiAgICAgICAgICAgICAgICB2YXIgZmlyc3RXb3JkID0gZW50aXR5UGFydHNbMF07XG4gICAgICAgICAgICAgICAgdmFyIGxhc3RXb3JkID0gZW50aXR5UGFydHNbZW50aXR5UGFydHMubGVuZ3RoLTFdO1xuICAgICAgICAgICAgICAgIC8vIGZpbmQgd29yZCB0aGF0IG1hdGNoZXMgY3VycmVudCBlbnRpdHlcbiAgICAgICAgICAgICAgICBzcmNUZXh0LmZvckVhY2goZnVuY3Rpb24od29yZCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYW4gd29yZCBmcm9tIGNvbW1hcywgZG90cyBhbmQgb3RoZXIgc3VwbGVtZW50YXJ5IHN0dWZmXG4gICAgICAgICAgICAgICAgICAgIHZhciBjbGVhbldvcmQgPSB3b3JkLnJlcGxhY2UoY2xlYW5SZWcsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoY2xlYW5Xb3JkLmluZGV4T2YoJ3NwYW4lbWFya2VkJScpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHRlc3QgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gZmlyc3RXb3JkLm1hdGNoKG5ldyBSZWdFeHAobWF0Y2hSZWdTdGFydCtlc2NhcGVSZWdFeHAoY2xlYW5Xb3JkKSttYXRjaFJlZykpICE9PSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZihtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAxOyBpIDwgZW50aXR5UGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCtpID49IHNyY1RleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXh0Q2xlYW5Xb3JkID0gc3JjVGV4dFtpbmRleCtpXS5yZXBsYWNlKGNsZWFuUmVnLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobmV4dENsZWFuV29yZC5pbmRleE9mKCdzcGFuJW1hcmtlZCUnKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gbWF0Y2ggJiYgZW50aXR5UGFydHNbaV0ubWF0Y2gobmV3IFJlZ0V4cChtYXRjaFJlZ1N0YXJ0K2VzY2FwZVJlZ0V4cChuZXh0Q2xlYW5Xb3JkKSttYXRjaFJlZykpICE9PSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBjb21wbGV0ZSBtYXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGZpcnN0IHBhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgbWF0Y2ggZnJvbSBvcmlnaW5hbCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlU3RhcnRJbmRleCA9IGZpbmRTb3VyY2VJbmRleCh3b3JkLCBjbGVhbldvcmQsIGZpcnN0V29yZCwgaW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBlbmQgcGFydFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmRJbmRleCA9IGluZGV4K2VudGl0eVBhcnRzLmxlbmd0aC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVuZEluZGV4ID49IHNyY1RleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFdvcmQgPSBzcmNUZXh0W2VuZEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5kQ2xlYW5Xb3JkID0gZW5kV29yZC5yZXBsYWNlKC9bXlxcd10vLCAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRvIGdldCBwbGFpbiBtYXRjaCBmcm9tIG9yaWdpbmFsIHNvdXJjZSBmb3Igc3RhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kSW5kZXggPSBmaW5kU291cmNlSW5kZXgoZW5kV29yZCwgZW5kQ2xlYW5Xb3JkLCBsYXN0V29yZCwgZW5kSW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd29yZCB3YXMgZm91bmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2VTdGFydEluZGV4ICE9PSAtMSAmJiBzb3VyY2VFbmRJbmRleCAhPT0gLTEgJiYgTWF0aC5hYnMoc291cmNlU3RhcnRJbmRleCAtIHNvdXJjZUVuZEluZGV4KSA8IDUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5yaWNoIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNbc291cmNlU3RhcnRJbmRleF0gPSBzcmNbc291cmNlU3RhcnRJbmRleF0ucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKGZpcnN0V29yZCkrJyQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiVtYXJrZWQlIGNsYXNzPVwibGFiZWwgbGFiZWwtd2FybmluZyBoYXNUb29sdGlwXCIgZGF0YS10b2dnbGU9XCJ0b29sdGlwXCIgdGl0bGU9XCInICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0eS50eXBlcy5qb2luKCcgJykgKyAnXCI+JyArIGZpcnN0V29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVucmljaCBzb3VyY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjW3NvdXJjZUVuZEluZGV4XSA9IHNyY1tzb3VyY2VFbmRJbmRleF0ucmVwbGFjZShsYXN0V29yZCwgbGFzdFdvcmQgKyAnPC9zcGFuJW1hcmtlZCU+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGdldCBlbnRpdHkgZGF0YVxuICAgICAgICAgICAgdmFyIGluZCA9IGVudGl0eU5hbWVzLmluZGV4T2YoZW50aXR5Lm5hbWUpO1xuICAgICAgICAgICAgdmFyIG5ld0VudGl0eTtcbiAgICAgICAgICAgIGlmKGluZCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBuZXdFbnRpdHkgPSBlbnRpdGllc1tpbmRdO1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2luZF0uY291bnQgKz0gMTtcbiAgICAgICAgICAgICAgICBpZihlbnRpdGllc1tpbmRdLmFydGljbGVzLmluZGV4T2YoYXJ0aWNsZS5pZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGVudGl0aWVzW2luZF0uYXJ0aWNsZXMucHVzaChhcnRpY2xlLmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoYXJ0aWNsZS5lbnRpdGllcy5pbmRleE9mKG5ld0VudGl0eS5pZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGFydGljbGUuZW50aXRpZXMucHVzaChuZXdFbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3RW50aXR5ID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogZW50aXR5Ll9pZCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZW50aXR5Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbnRpdHknLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogMSxcbiAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZXM6IFthcnRpY2xlLmlkXSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZXM6IFtdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhcnRpY2xlLmVudGl0aWVzLnB1c2gobmV3RW50aXR5LmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2V0IHR5cGVzXG4gICAgICAgICAgICBlbnRpdHkudHlwZXMuZm9yRWFjaChmdW5jdGlvbih0eXBlKXtcbiAgICAgICAgICAgICAgICAvLyBnZXQgdHlwZSBkYXRhXG4gICAgICAgICAgICAgICAgdmFyIG5hbWUgPSB0eXBlLnNwbGl0KCc6JylbMV07XG4gICAgICAgICAgICAgICAgdmFyIHRpZCA9ICd0eXBlXycrbmFtZTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kID0gdHlwZU5hbWVzLmluZGV4T2YobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYoaW5kICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0eXBlc1tpbmRdLmNvdW50ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzW2luZF0uZW50aXRpZXMucHVzaChuZXdFbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgICAgICB0eXBlc1tpbmRdLmFydGljbGVzLnB1c2goYXJ0aWNsZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKG5ld0VudGl0eS50eXBlcy5pbmRleE9mKHRpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdFbnRpdHkudHlwZXMucHVzaCh0aWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKGFydGljbGUudHlwZXMuaW5kZXhPZih0aWQpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJ0aWNsZS50eXBlcy5wdXNoKHRpZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0eXBlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3R5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdGllczogW25ld0VudGl0eS5pZF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlczogW2FydGljbGUuaWRdLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYobmV3RW50aXR5LnR5cGVzLmluZGV4T2YodGlkKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VudGl0eS50eXBlcy5wdXNoKCd0eXBlXycrbmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoYXJ0aWNsZS50eXBlcy5pbmRleE9mKHRpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcnRpY2xlLnR5cGVzLnB1c2goJ3R5cGVfJytuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0eXBlTmFtZXMucHVzaChuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYoaW5kID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGVudGl0aWVzLnB1c2gobmV3RW50aXR5KTtcbiAgICAgICAgICAgICAgICBlbnRpdHlOYW1lcy5wdXNoKG5ld0VudGl0eS5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gam9pbiBzb3VyY2UgYmFja1xuICAgICAgICBpdGVtLnNvdXJjZSA9IHNyYy5qb2luKCcgJykucmVwbGFjZSgvc3BhbiVtYXJrZWQlL2csICdzcGFuJyk7XG4gICAgICAgIGFydGljbGUuc291cmNlID0gaXRlbS5zb3VyY2U7XG5cbiAgICAgICAgLy8gcHVzaCB0byBhcnJheVxuICAgICAgICBhcnRpY2xlcy5wdXNoKGFydGljbGUpO1xuICAgIH0pO1xuXG4gICAgLy8gc29ydCBhcnJheXMgYnkgY291bnRcbiAgICB2YXIgc29ydEZ1bmN0aW9uID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICByZXR1cm4gYi5jb3VudCAtIGEuY291bnQ7XG4gICAgfTtcbiAgICBlbnRpdGllcyA9IGVudGl0aWVzLnNvcnQoc29ydEZ1bmN0aW9uKTtcbiAgICB0eXBlcyA9IHR5cGVzLnNvcnQoc29ydEZ1bmN0aW9uKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGFydGljbGVzOiBhcnRpY2xlcyxcbiAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICBlbnRpdGllczogZW50aXRpZXNcbiAgICB9O1xufTtcblxuLy8gZXhwb3NlXG5leHBvcnRzLnByb2Nlc3NEYXRhID0gcHJvY2Vzc0RhdGE7XG4iLCJ2YXIgZGljZU1ldHJpYyA9IGZ1bmN0aW9uICh4LCB5LCB4eSkge1xuICAgIHJldHVybiAyICogeHkgLyAoeCArIHkpO1xufTtcblxudmFyIGdldENvbW1vbkFydGljbGVzID0gZnVuY3Rpb24oZW50aXR5LCBlbnRpdHlEb3VibGUpIHtcbiAgICB2YXIgY29tbW9uID0gXy5pbnRlcnNlY3Rpb24oZW50aXR5LmFydGljbGVzLCBlbnRpdHlEb3VibGUuYXJ0aWNsZXMpO1xuICAgIHJldHVybiBjb21tb24gPyBjb21tb24ubGVuZ3RoIDogMDtcbn07XG5cbnZhciBwcm9jZXNzRGF0YSA9IGZ1bmN0aW9uKGNvcnB1cykge1xuICAgIC8vIGVudGl0aWVzIGFycmF5XG4gICAgdmFyIGVudGl0aWVzID0ge307XG4gICAgLy8gZmluZCBtaW4sIG1heCwgYXZnIG9mIGVudGl0aWVzXG4gICAgdmFyIGVudGl0aWVzTWluLCBlbnRpdGllc01heCwgZW50aXRpZXNBdmc7XG4gICAgdmFyIGVudGl0aWVzVG90YWwgPSAwO1xuICAgIC8vIGdvIHRocm91Z2ggYWxsIGFydGljbGVzXG4gICAgY29ycHVzLmFydGljbGVzLmZvckVhY2goZnVuY3Rpb24oYXJ0aWNsZSkge1xuICAgICAgICAvLyBjYWxjdWxhdGUgc3R1ZmZcbiAgICAgICAgdmFyIGNvdW50ID0gYXJ0aWNsZS5lbnRpdGllcy5sZW5ndGg7XG4gICAgICAgIGVudGl0aWVzVG90YWwgKz0gY291bnQ7XG4gICAgICAgIGVudGl0aWVzTWluID0gXy5taW4oW2VudGl0aWVzTWluLCBjb3VudF0pO1xuICAgICAgICBlbnRpdGllc01heCA9IF8ubWF4KFtlbnRpdGllc01pbiwgY291bnRdKTtcbiAgICAgICAgLy8gYWRkIGVudGl0aWVzIHRvIGFsbCBhcnJheVxuICAgICAgICBhcnRpY2xlLmVudGl0aWVzLmZvckVhY2goZnVuY3Rpb24oZW50aXR5KSB7XG4gICAgICAgICAgICBpZihlbnRpdGllc1tlbnRpdHkudXJpXSkge1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldLmNvdW50Kys7XG4gICAgICAgICAgICAgICAgZW50aXRpZXNbZW50aXR5LnVyaV0uYXJ0aWNsZXMucHVzaChhcnRpY2xlLl9pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldID0gZW50aXR5O1xuICAgICAgICAgICAgICAgIGVudGl0aWVzW2VudGl0eS51cmldLmNvdW50ID0gMTtcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tlbnRpdHkudXJpXS5hcnRpY2xlcyA9IFthcnRpY2xlLl9pZF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIGNvdW50IGF2ZXJhZ2VcbiAgICBlbnRpdGllc0F2ZyA9IE1hdGguZmxvb3IoZW50aXRpZXNUb3RhbCAvIGNvcnB1cy5hcnRpY2xlcy5sZW5ndGgpO1xuXG4gICAgLy8gcHJlcGFyZSB2YXJzIGZvciBmaW5hbCBkYXRhXG4gICAgdmFyIHJlbGF0aW9ucyA9IFtdO1xuICAgIHZhciBzY29yZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5TmFtZXMgPSBbXTtcbiAgICB2YXIgZW50aXR5VVJJcyA9IFtdO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgLy8gdGVtcCBhcnJheXNcbiAgICB2YXIgdG1wID0gW107XG4gICAgdmFyIHRtcDQgPSBbXTtcblxuICAgIC8vIHByb2Nlc3NcbiAgICBmb3IodmFyIGVrZXkgaW4gZW50aXRpZXMpIHtcbiAgICAgICAgdmFyIGVudGl0eSA9IGVudGl0aWVzW2VrZXldO1xuICAgICAgICAvLyBwcmVwYXJlIHJvdyBkYXRhXG4gICAgICAgIHZhciByb3cgPSBbXTtcbiAgICAgICAgdmFyIHNjb3JlID0gW107XG5cbiAgICAgICAgLy8gZ28gdGhyb3VnaCBlbnRpdGllcyBhZ2FpblxuICAgICAgICBmb3IodmFyIGVrZXkyIGluIGVudGl0aWVzKSB7XG4gICAgICAgICAgICB2YXIgZW50aXR5RG91YmxlID0gZW50aXRpZXNbZWtleTJdO1xuICAgICAgICAgICAgaWYgKGVudGl0eS51cmkgPT09IGVudGl0eURvdWJsZS51cmkpIHtcbiAgICAgICAgICAgICAgICByb3cucHVzaCgwKTtcbiAgICAgICAgICAgICAgICBzY29yZS5wdXNoKDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZW50aXR5Ll9pZCArICctJyArIGVudGl0eURvdWJsZS5faWQ7XG4gICAgICAgICAgICAgICAgdmFyIHJldmVyc2VLZXkgPSBlbnRpdHlEb3VibGUuX2lkICsgJy0nICsgZW50aXR5Ll9pZDtcbiAgICAgICAgICAgICAgICBpZiAodG1wLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcm93LnB1c2godG1wW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICBzY29yZS5wdXNoKHRtcDRba2V5XSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0bXAuaW5kZXhPZihyZXZlcnNlS2V5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcm93LnB1c2godG1wW3JldmVyc2VLZXldKTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmUucHVzaCh0bXA0W3JldmVyc2VLZXldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvL2dpdmUgbWUgdGhlIG51bWJlciBvZiBhcnRpY2xlcyB0aGF0IGhhdmUgYm90aCAgJGkgWyd1cmknXSBhbmQgJGogWyd1cmknXSBlbnRpdGllc1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29tbW9uQ291bnQgPSBnZXRDb21tb25BcnRpY2xlcyhlbnRpdHksIGVudGl0eURvdWJsZSk7XG4gICAgICAgICAgICAgICAgICAgIHRtcFtrZXldID0gY29tbW9uQ291bnQ7XG4gICAgICAgICAgICAgICAgICAgIHJvdy5wdXNoKHRtcFtrZXldKTtcbiAgICAgICAgICAgICAgICAgICAgdG1wNFtrZXldID0gW2RpY2VNZXRyaWMoZW50aXR5LmFydGljbGVzLmxlbmd0aCwgZW50aXR5RG91YmxlLmFydGljbGVzLmxlbmd0aCwgY29tbW9uQ291bnQpXTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmUucHVzaCh0bXA0W2tleV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHB1c2ggZGF0YSBpZiBuZWVkZWRcbiAgICAgICAgLy8gcHVzaCBuYW1lXG4gICAgICAgIGlmIChlbnRpdHlOYW1lcy5pbmRleE9mKGVudGl0eS5uYW1lKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIGVudGl0eU5hbWVzLnB1c2goZW50aXR5Lm5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIGVudGl0eU5hbWVzLnB1c2goZW50aXR5Lm5hbWUgKyAnIycgKyBpbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcHVzaCB1cmlcbiAgICAgICAgZW50aXR5VVJJcy5wdXNoKGVudGl0eS51cmkpO1xuICAgICAgICAvLyByZWxhdGlvbnNcbiAgICAgICAgcmVsYXRpb25zLnB1c2gocm93KTtcbiAgICAgICAgLy8gc2NvcmVzXG4gICAgICAgIHNjb3Jlcy5wdXNoKHNjb3JlKTtcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhyZXNob2xkIGZyb20gbWlkZGxlIG9mIHNjb3Jlc1xuICAgIHZhciBzb3J0ZWRTY29yZXMgPSBbXTtcbiAgICAvLyBnZXQgc2NvcmVzXG4gICAgc2NvcmVzLmZvckVhY2goZnVuY3Rpb24oc2NvcmUpIHtcbiAgICAgICAgc2NvcmUuZm9yRWFjaChmdW5jdGlvbihudW0pIHtcbiAgICAgICAgICAgIGlmKG51bSA+IDApIHtcbiAgICAgICAgICAgICAgICBzb3J0ZWRTY29yZXMucHVzaChudW1bMF0pO1xuICAgICAgICAgICAgICAgIHRocmVzaG9sZCArPSBudW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIHNvcnRcbiAgICBzb3J0ZWRTY29yZXMgPSBzb3J0ZWRTY29yZXMuc29ydCgpO1xuICAgIC8vIGdldCB0aHJlc2hvbGRcbiAgICB2YXIgY2VudGVyID0gTWF0aC5mbG9vcihzb3J0ZWRTY29yZXMubGVuZ3RoIC8gMik7XG4gICAgdmFyIHRocmVzaG9sZCA9IHNvcnRlZFNjb3Jlc1tjZW50ZXJdO1xuXG4gICAgLy9yZW1vdmUgbm9pc2VzXG4gICAgc2NvcmVzLmZvckVhY2goZnVuY3Rpb24ocm93LCBpbmRleCl7XG4gICAgICAgIHJvdy5mb3JFYWNoKGZ1bmN0aW9uKHNjb3JlLCBzdWJpbmRleCl7XG4gICAgICAgICAgICBpZihzY29yZSA8IHRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIHJlbGF0aW9uc1tpbmRleF1bc3ViaW5kZXhdID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZWxhdGlvbnM6IHJlbGF0aW9ucyxcbiAgICAgICAgc2NvcmVzOiBzY29yZXMsXG4gICAgICAgIGVudGl0eU5hbWVzOiBlbnRpdHlOYW1lcyxcbiAgICAgICAgZW50aXR5VVJJczogZW50aXR5VVJJc1xuICAgIH07XG59O1xuXG5leHBvcnRzLnByb2Nlc3NEYXRhID0gcHJvY2Vzc0RhdGE7IiwiLy8gZ2V0IGV4dGVudGlvbnNcbnZhciBleHRlbnRpb25zID0gcmVxdWlyZSgnLi4vZGF0YS9jb3JwdXNleHRlbnRpb25zJyk7XG5cbi8vIGluaXQgbW9kdWxlXG52YXIgY29ycHVzTW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ0NvcnB1c01vZHVsZScsIFsndWkucm91dGVyJ10pO1xuXG4vLyBjb25maWcgcm91dGVzXG5jb3JwdXNNb2R1bGUuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgLy8gbWFpbiB2aWV3XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2NvcnB1cycsIHtcbiAgICAgICAgdXJsOiAnL2NvcnB1cy86aWQnLFxuICAgICAgICBjb250cm9sbGVyOiByZXF1aXJlKCcuLi9jb250cm9sbGVycy9jb3JwdXMvbWFpbicpLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJy90ZW1wbGF0ZXMvY29ycHVzVmlldy5odG1sJyxcbiAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgY29ycHVzOiBbJyRodHRwJywgJyRzdGF0ZVBhcmFtcycsIGZ1bmN0aW9uKCRodHRwLCAkc3RhdGVQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAoe21ldGhvZDogJ0dFVCcsIHVybDogJy9hcGkvY29ycHVzLycgKyAkc3RhdGVQYXJhbXMuaWR9KTtcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIG1ha2UgdmlldyByb3V0ZXMgZm9yIGV4dGVudGlvbnNcbiAgICBleHRlbnRpb25zLmZvckVhY2goZnVuY3Rpb24oZXgpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2NvcnB1cy4nICsgZXgubmFtZSwge1xuICAgICAgICAgICAgdXJsOiBleC5wYXRoLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGV4LnRlbXBsYXRlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogZXguY29udHJvbGxlcixcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuLy8gcmVnaXN0ZXIgY29udHJvbGxlcnNcbmV4dGVudGlvbnMuZm9yRWFjaChmdW5jdGlvbihleCkge1xuICAgIGNvcnB1c01vZHVsZS5jb250cm9sbGVyKGV4LmNvbnRyb2xsZXIsIFsnJHNjb3BlJywgJyRzdGF0ZScsICckc2NlJywgZXguanNdKTtcbn0pO1xuXG4vLyBleHBvcnRcbm1vZHVsZS5leHBvcnRzID0gY29ycHVzTW9kdWxlO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBhcHBseVJvdXRlcyAoYXBwKSB7XG4gICAgYXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7IGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicsIHRlbXBsYXRlOiAnJyB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL2F1dGgnLCB7IGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLCB0ZW1wbGF0ZTogJycgfSk7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy9yZWdpc3RlcicsIHsgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ29udHJvbGxlcicsIHRlbXBsYXRlOiAnJyB9KTtcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignL2NyZWF0ZUNvcnB1cycsIHsgY29udHJvbGxlcjogJ0NyZWF0ZUNvcnB1c0NvbnRyb2xsZXInLCB0ZW1wbGF0ZVVybDogJy90ZW1wbGF0ZXMvY3JlYXRlQ29ycHVzLmh0bWwnIH0pO1xuXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcbiAgICB9XSk7XG59OyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYXBwbHlTZXJ2aWNlcyAoYXBwKSB7XG59O1xuIl19
